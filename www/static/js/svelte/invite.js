!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/invite",e):(t=t||self).invite=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}function s(t){for(var s=1;s<arguments.length;s++){var o=null!=arguments[s]?arguments[s]:{};s%2?r(Object(o),!0).forEach((function(r){e(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function i(t,e,r){return(i=a()?Reflect.construct:function(t,e,r){var s=[null];s.push.apply(s,e);var o=new(Function.bind.apply(t,s));return r&&n(o,r.prototype),o}).apply(null,arguments)}function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,s)}function s(){return i(t,arguments,o(this).constructor)}return s.prototype=Object.create(t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),n(s,t)})(t)}function p(t,e){if(null==t)return{};var r,s,o=function(t,e){if(null==t)return{};var r,s,o={},n=Object.keys(t);for(s=0;s<n.length;s++)r=n[s],e.indexOf(r)>=0||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(s=0;s<n.length;s++)r=n[s],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(){}function f(t,e){for(var r in e)t[r]=e[r];return t}function l(t,e){t.appendChild(e)}function w(t,e,r){t.insertBefore(e,r)}function h(t){t.parentNode.removeChild(t)}function m(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function g(t,e,r,s){t.addEventListener(e,r,s)}function _(t,e,r,s){t.removeEventListener(e,r,s)}function b(t,e,r){null==r?t.removeAttribute(e):t.setAttribute(e,r)}function y(t,e,r){t.style.setProperty(e,r)}function E(t,e,r){t.classList[r?"add":"remove"](e)}function S(){return Object.create(null)}function O(e,r){return e!=e?r==r:e!==r||e&&"object"===t(e)||"function"==typeof e}function H(t,e){return t!=t?e==e:t!==e}function T(t,e){var r=t in this._handlers&&this._handlers[t].slice();if(r)for(var s=0;s<r.length;s+=1){var o=r[s];if(!o.__calling)try{o.__calling=!0,o.call(this,e)}finally{o.__calling=!1}}}function j(t){t._lock=!0,L(t._beforecreate),L(t._oncreate),L(t._aftercreate),t._lock=!1}function k(){return this._state}function R(t,e){t._handlers=S(),t._slots=S(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function x(t,e){var r=this._handlers[t]||(this._handlers[t]=[]);return r.push(e),{cancel:function(){var t=r.indexOf(e);~t&&r.splice(t,1)}}}function L(t){for(;t&&t.length;)t.shift()()}var N={destroy:function(t){this.destroy=u,this.fire("destroy"),this.set=u,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:k,fire:T,on:x,set:function(t){this._set(f({},t)),this.root._lock||j(this.root)},_recompute:u,_set:function(t){var e=this._state,r={},s=!1;for(var o in t=f(this._staged,t),this._staged={},t)this._differs(t[o],e[o])&&(r[o]=s=!0);s&&(this._state=f(f({},e),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:e}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:e})))},_stage:function(t){f(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:O},P={};function M(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"core";"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(P[t]=window.__dw.vis.meta.locale||{}):P[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function z(t){var e=arguments,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core";if(t=t.trim(),P[r]||M(r),!P[r][t])return"MISSING:"+t;var s=P[r][t];return"string"==typeof s&&arguments.length>2&&(s=s.replace(/\$(\d)/g,(function(t,r){return r=2+Number(r),void 0===e[r]?t:e[r]}))),s}function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s({payload:null,raw:!1,method:"GET",baseUrl:"//".concat(dw.backend.__api_domain),mode:"cors",credentials:"include"},e,{headers:s({"Content-Type":"application/json"},e.headers)}),o=r.payload,n=r.baseUrl,a=r.raw,i=p(r,["payload","baseUrl","raw"]),c="".concat(n.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));return o&&(i.body=JSON.stringify(o)),window.fetch(c,i).then((function(t){if(a)return t;if(!t.ok)throw new U(t);if(204!==t.status){var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}}))}C.get=D("GET"),C.patch=D("PATCH"),C.put=D("PUT"),C.post=D("POST"),C.head=D("HEAD");function D(t){return function(e,r){if(r&&r.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return C(e,s({},r,{method:t}))}}C.delete=D("DELETE");var A,U=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=d(this,o(e).call(this))).name="HttpReqError",r.status=t.status,r.statusText=t.statusText,r.message="[".concat(t.status,"] ").concat(t.statusText),r.response=t,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(e,t),e}(c(Error)),I=!1;function q(t){var e=t.password;return A?A(e):(!I&&e.length>4&&(I=!0,require(["zxcvbn"],(function(t){A=t}))),!1)}function $(t,e){var r,s=e.password.length>=8&&G();return{c:function(){s&&s.c(),r=document.createComment("")},m:function(t,e){s&&s.m(t,e),w(t,r,e)},p:function(t,e){e.password.length>=8?s||((s=G()).c(),s.m(r.parentNode,r)):s&&(s.d(1),s=null)},d:function(t){s&&s.d(t),t&&h(r)}}}function G(t,e){return{c:u,m:u,d:u}}function F(t){R(this,t),this._state=f({password:"",passwordRepeat:""},t.data),this._recompute({password:1,passwordRepeat:1,passwordStrength:1,passwordTooShort:1,passwordHelp:1,passwordMismatch:1},this._state),this._intro=!0,this._fragment=$(0,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function B(t,e,r){return r?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function J(){}f(F.prototype,N),F.prototype._recompute=function(t,e){var r,s,o;t.password&&this._differs(e.passwordTooShort,e.passwordTooShort=e.password.length<8)&&(t.passwordTooShort=!0),(t.password||t.passwordRepeat)&&this._differs(e.passwordMismatch,e.passwordMismatch=(s=(r=e).password,o=r.passwordRepeat,s&&s!==o))&&(t.passwordMismatch=!0),t.password&&this._differs(e.passwordStrength,e.passwordStrength=q(e))&&(t.passwordStrength=!0),(t.password||t.passwordStrength)&&this._differs(e.passwordHelp,e.passwordHelp=function(t){var e=t.password,r=t.passwordStrength;if(""===e||!r)return z("account / pwd-too-short").replace("%num",8);var s=["bad","weak","ok","good","excellent"][r.score];return z("account / password / ".concat(s))}(e))&&(t.passwordHelp=!0),(t.password||t.passwordTooShort||t.passwordStrength||t.passwordHelp)&&this._differs(e.passwordError,e.passwordError=function(t){var e=t.password,r=t.passwordTooShort,s=t.passwordStrength,o=t.passwordHelp;return!!e&&(r?z("account / pwd-too-short").replace("%num",8):!!(s&&s.score<2)&&o)}(e))&&(t.passwordError=!0),(t.passwordStrength||t.passwordHelp)&&this._differs(e.passwordSuccess,e.passwordSuccess=function(t){var e=t.passwordStrength,r=t.passwordHelp;return!!(e&&e.score>2)&&r}(e))&&(t.passwordSuccess=!0),t.passwordMismatch&&this._differs(e.passwordRepeatError,e.passwordRepeatError=!!e.passwordMismatch&&z("account / password / mismatch"))&&(t.passwordRepeatError=!0),(t.password||t.passwordMismatch||t.passwordTooShort)&&this._differs(e.passwordOk,e.passwordOk=function(t){var e=t.password,r=t.passwordMismatch,s=t.passwordTooShort;return e&&!r&&!s}(e))&&(t.passwordOk=!0)};var V={doSignUp:function(){try{var t=this,e=window.location.pathname.split("/").pop(),r=t.get(),s=r.password,o=r.redirect;return t.set({loggingIn:!0}),n=function(t,e){try{var r=t()}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}((function(){return B(C.post("/v3/auth/activate/".concat(e),{payload:{password:s}}),(function(){t.set({activateSuccess:"Password was set up successfully!"}),setTimeout((function(){window.location.href=o}),1e3)}))}),(function(e){return function(t){var e=t();if(e&&e.then)return e.then(J)}((function(){if("HttpReqError"===e.name)return B(e.response.json(),(function(r){t.set({activateError:r?r.message:e.message})}));t.set({activateError:e})}))})),a=function(){t.set({loggingIn:!1})},n&&n.then?n.then(a):a(n)}catch(t){return Promise.reject(t)}var n,a}};function K(t,e){var r,s,o,n,a,i,c,p,d,u,f,S,O,H,T,j,k,R,x,L,N,P,M,C,D,A,U,I,q,$,G,B=z("password"),J={},V=z("account / invite / password-clear-text"),K=z("account / invite / your-login-is").replace("%s",'<span class="email">'.concat(e.email,"</span>")),nt=z("account / invite / set-password");function at(e){t.set({windowHeight:this.innerHeight})}window.addEventListener("resize",at);var it=e.customLogo&&Q(t,e);function ct(t){return t.clearText?X:W}var pt=ct(e),dt=pt(t,e),ut={};void 0!==e.password&&(ut.password=e.password,J.password=!0),void 0!==e.password&&(ut.passwordRepeat=e.password,J.passwordRepeat=!0),void 0!==e.passwordHelp&&(ut.passwordHelp=e.passwordHelp,J.passwordHelp=!0),void 0!==e.passwordSuccess&&(ut.passwordSuccess=e.passwordSuccess,J.passwordSuccess=!0),void 0!==e.passwordError&&(ut.passwordError=e.passwordError,J.passwordError=!0),void 0!==e.passwordRepeatError&&(ut.passwordRepeatError=e.passwordRepeatError,J.passwordRepeatError=!0),void 0!==e.passwordOk&&(ut.passwordOk=e.passwordOk,J.passwordOk=!0);var ft=new F({root:t.root,store:t.store,data:ut,_bind:function(e,r){var s={};!J.password&&e.password&&(s.password=r.password),!J.passwordRepeat&&e.passwordRepeat&&(s.password=r.passwordRepeat),!J.passwordHelp&&e.passwordHelp&&(s.passwordHelp=r.passwordHelp),!J.passwordSuccess&&e.passwordSuccess&&(s.passwordSuccess=r.passwordSuccess),!J.passwordError&&e.passwordError&&(s.passwordError=r.passwordError),!J.passwordRepeatError&&e.passwordRepeatError&&(s.passwordRepeatError=r.passwordRepeatError),!J.passwordOk&&e.passwordOk&&(s.passwordOk=r.passwordOk),t._set(s),J={}}});function lt(t){return t.passwordError?tt:t.passwordSuccess?Z:t.passwordHelp?Y:void 0}t.root._beforecreate.push((function(){ft._bind({password:1,passwordRepeat:1,passwordHelp:1,passwordSuccess:1,passwordError:1,passwordRepeatError:1,passwordOk:1},ft.get())}));var wt=lt(e),ht=wt&&wt(t,e);function mt(){t.set({clearText:x.checked})}var vt=e.activateError&&et(t,e),gt=e.activateSuccess&&rt(t,e);function _t(t){return t.signingUp?ot:st}var bt=_t(e),yt=bt(t,e);function Et(e){t.doSignUp()}function St(){t.set({modalHeight:s.clientHeight})}return{c:function(){it&&it.c(),r=v("\n\n\n\n"),s=m("div"),o=m("div"),n=m("h3"),a=v("\n        "),i=m("p"),c=v("\n\n        "),p=m("div"),d=m("div"),u=m("div"),f=m("label"),S=v(B),O=v("\n                    "),dt.c(),H=v("\n                    "),ft._fragment.c(),T=v("\n                    "),ht&&ht.c(),j=v("\n            "),k=m("div"),R=m("label"),x=m("input"),L=v(" "),N=v(V),P=v("\n            "),vt&&vt.c(),M=v(" "),gt&&gt.c(),C=v("\n            "),D=m("div"),A=v("\n\n        "),U=m("button"),I=v(nt),q=v("   "),yt.c(),n.className="svelte-1gdbjzr",f.className="svelte-1gdbjzr",u.className="controls",d.className="control-group svelte-1gdbjzr",E(d,"warning",e.passwordError),E(d,"success",e.passwordSuccess),g(x,"change",mt),b(x,"type","checkbox"),x.className="pwd-clear",R.className="checkbox svelte-1gdbjzr",k.className="control-group svelte-1gdbjzr",D.className="control-group login-help svelte-1gdbjzr",p.className="login-form form-vertical",g(U,"click",Et),U.disabled=$=!e.passwordOk,U.className="btn btn-primary btn-large login",o.className="modal-body svelte-1gdbjzr",t.root._aftercreate.push(St),s.className="modal svelte-1gdbjzr",y(s,"margin-top",e.marginTop+"px")},m:function(t,h){it&&it.m(t,h),w(t,r,h),w(t,s,h),l(s,o),l(o,n),n.innerHTML=e.headline,l(o,a),l(o,i),i.innerHTML=e.intro,l(o,c),l(o,p),l(p,d),l(d,u),l(u,f),l(f,S),l(u,O),dt.m(u,null),l(u,H),ft._mount(u,null),l(u,T),ht&&ht.m(u,null),l(p,j),l(p,k),l(k,R),l(R,x),x.checked=e.clearText,l(R,L),l(R,N),l(p,P),vt&&vt.m(p,null),l(p,M),gt&&gt.m(p,null),l(p,C),l(p,D),D.innerHTML=K,l(o,A),l(o,U),l(U,I),l(U,q),yt.m(U,null),G=function(t,e){"static"===getComputedStyle(t).position&&(t.style.position="relative");var r,s=document.createElement("object");return s.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1;"),s.type="text/html",s.onload=function(){(r=s.contentDocument.defaultView).addEventListener("resize",e)},/Trident/.test(navigator.userAgent)?(t.appendChild(s),s.data="about:blank"):(s.data="about:blank",t.appendChild(s)),{cancel:function(){r&&r.removeEventListener&&r.removeEventListener("resize",e),t.removeChild(s)}}}(s,St)},p:function(o,a){(e=a).customLogo?it?it.p(o,e):((it=Q(t,e)).c(),it.m(r.parentNode,r)):it&&(it.d(1),it=null),o.headline&&(n.innerHTML=e.headline),o.intro&&(i.innerHTML=e.intro),pt===(pt=ct(e))&&dt?dt.p(o,e):(dt.d(1),(dt=pt(t,e)).c(),dt.m(u,H));var c={};!J.password&&o.password&&(c.password=e.password,J.password=void 0!==e.password),!J.passwordRepeat&&o.password&&(c.passwordRepeat=e.password,J.passwordRepeat=void 0!==e.password),!J.passwordHelp&&o.passwordHelp&&(c.passwordHelp=e.passwordHelp,J.passwordHelp=void 0!==e.passwordHelp),!J.passwordSuccess&&o.passwordSuccess&&(c.passwordSuccess=e.passwordSuccess,J.passwordSuccess=void 0!==e.passwordSuccess),!J.passwordError&&o.passwordError&&(c.passwordError=e.passwordError,J.passwordError=void 0!==e.passwordError),!J.passwordRepeatError&&o.passwordRepeatError&&(c.passwordRepeatError=e.passwordRepeatError,J.passwordRepeatError=void 0!==e.passwordRepeatError),!J.passwordOk&&o.passwordOk&&(c.passwordOk=e.passwordOk,J.passwordOk=void 0!==e.passwordOk),ft._set(c),J={},wt===(wt=lt(e))&&ht?ht.p(o,e):(ht&&ht.d(1),(ht=wt&&wt(t,e))&&ht.c(),ht&&ht.m(u,null)),o.passwordError&&E(d,"warning",e.passwordError),o.passwordSuccess&&E(d,"success",e.passwordSuccess),o.clearText&&(x.checked=e.clearText),e.activateError?vt?vt.p(o,e):((vt=et(t,e)).c(),vt.m(p,M)):vt&&(vt.d(1),vt=null),e.activateSuccess?gt?gt.p(o,e):((gt=rt(t,e)).c(),gt.m(p,C)):gt&&(gt.d(1),gt=null),o.email&&K!==(K=z("account / invite / your-login-is").replace("%s",'<span class="email">'.concat(e.email,"</span>")))&&(D.innerHTML=K),bt!==(bt=_t(e))&&(yt.d(1),(yt=bt(t,e)).c(),yt.m(U,null)),o.passwordOk&&$!==($=!e.passwordOk)&&(U.disabled=$),o.marginTop&&y(s,"margin-top",e.marginTop+"px")},d:function(t){window.removeEventListener("resize",at),it&&it.d(t),t&&(h(r),h(s)),dt.d(),ft.destroy(),ht&&ht.d(),_(x,"change",mt),vt&&vt.d(),gt&&gt.d(),yt.d(),_(U,"click",Et),G.cancel()}}}function Q(t,e){var r,s,o;return{c:function(){r=m("div"),(s=m("img")).src=o="/static/custom/"+{customLogo:e.customLogo}+"}",y(s,"height","50px"),s.alt="logo",r.className="brand"},m:function(t,e){w(t,r,e),l(r,s)},p:function(t,e){t.customLogo&&o!==(o="/static/custom/"+{customLogo:e.customLogo}+"}")&&(s.src=o)},d:function(t){t&&h(r)}}}function W(t,e){var r,s=!1;function o(){s=!0,t.set({password:r.value}),s=!1}return{c:function(){g(r=m("input"),"input",o),r.className="login-pwd input-xlarge span3 svelte-1gdbjzr",b(r,"type","password")},m:function(t,s){w(t,r,s),r.value=e.password},p:function(t,e){!s&&t.password&&(r.value=e.password)},d:function(t){t&&h(r),_(r,"input",o)}}}function X(t,e){var r,s=!1;function o(){s=!0,t.set({password:r.value}),s=!1}return{c:function(){g(r=m("input"),"input",o),r.className="login-pwd input-xlarge span3 svelte-1gdbjzr",b(r,"type","text")},m:function(t,s){w(t,r,s),r.value=e.password},p:function(t,e){!s&&t.password&&(r.value=e.password)},d:function(t){t&&h(r),_(r,"input",o)}}}function Y(t,e){var r;return{c:function(){(r=m("p")).className="help muted svelte-1gdbjzr"},m:function(t,s){w(t,r,s),r.innerHTML=e.passwordHelp},p:function(t,e){t.passwordHelp&&(r.innerHTML=e.passwordHelp)},d:function(t){t&&h(r)}}}function Z(t,e){var r;return{c:function(){(r=m("p")).className="help text-success svelte-1gdbjzr"},m:function(t,s){w(t,r,s),r.innerHTML=e.passwordSuccess},p:function(t,e){t.passwordSuccess&&(r.innerHTML=e.passwordSuccess)},d:function(t){t&&h(r)}}}function tt(t,e){var r;return{c:function(){(r=m("p")).className="help text-warning svelte-1gdbjzr"},m:function(t,s){w(t,r,s),r.innerHTML=e.passwordError},p:function(t,e){t.passwordError&&(r.innerHTML=e.passwordError)},d:function(t){t&&h(r)}}}function et(t,e){var r;return{c:function(){(r=m("div")).className="alert alert-warning"},m:function(t,s){w(t,r,s),r.innerHTML=e.activateError},p:function(t,e){t.activateError&&(r.innerHTML=e.activateError)},d:function(t){t&&h(r)}}}function rt(t,e){var r;return{c:function(){(r=m("div")).className="alert alert-success"},m:function(t,s){w(t,r,s),r.innerHTML=e.activateSuccess},p:function(t,e){t.activateSuccess&&(r.innerHTML=e.activateSuccess)},d:function(t){t&&h(r)}}}function st(t,e){var r;return{c:function(){(r=m("i")).className="fa fa-fw fa-chevron-right"},m:function(t,e){w(t,r,e)},d:function(t){t&&h(r)}}}function ot(t,e){var r;return{c:function(){(r=m("i")).className="fa fa-fw fa-spinner fa-pulse"},m:function(t,e){w(t,r,e)},d:function(t){t&&h(r)}}}function nt(t){R(this,t),this._state=f({redirect:"/",password:"",passwordOk:!1,passwordHelp:!1,passwordSuccess:!1,passwordError:!1,passwordRepeatError:!1,loggingIn:!1,activateSuccess:!1,activateError:!1,windowHeight:1e3,modalHeight:300,clearText:!1},t.data),this._state.windowHeight=window.innerHeight,this._recompute({windowHeight:1,modalHeight:1},this._state),this._intro=!0,this._fragment=K(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),j(this))}function at(t,e){this._handlers={},this._dependents=[],this._computed=S(),this._sortedComputedProperties=[],this._state=f({},t),this._differs=e&&e.immutable?H:O}f(nt.prototype,N),f(nt.prototype,V),nt.prototype._recompute=function(t,e){var r;(t.windowHeight||t.modalHeight)&&this._differs(e.marginTop,e.marginTop=.5*((r=e).windowHeight-r.modalHeight))&&(t.marginTop=!0)},f(at.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},r=0;r<t.length;r+=1){var s=t[r];e["$"+s]=this._state[s]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,e){var r=this,s=this._state;this._state=f(f({},s),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,e);this.fire("state",{changed:e,previous:s,current:this._state}),this._dependents.filter((function(t){for(var s={},o=!1,n=0;n<t.props.length;n+=1){var a=t.props[n];a in e&&(s["$"+a]=r._state[a],o=!0)}if(o)return t.component._stage(s),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:e,previous:s,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,r=this._sortedComputedProperties=[],s=S();function o(n){var a=e[n];a&&(a.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between ".concat(e," <-> ").concat(n));o(e)})),s[n]||(s[n]=!0,r.push(a)))}for(var n in this._computed)o(t=n)},compute:function(t,e,r){var s,o=this,n={deps:e,update:function(n,a,i){var c=e.map((function(t){return t in a&&(i=!0),n[t]}));if(i){var p=r.apply(null,c);o._differs(p,s)&&(s=p,a[t]=!0,n[t]=s)}}};this._computed[t]=n,this._sortComputedProperties();var a=f({},this._state),i={};n.update(a,i,!0),this._set(a,i)},fire:T,get:k,on:x,set:function(t){var e=this._state,r=this._changed={},s=!1;for(var o in t){if(this._computed[o])throw new Error("'".concat(o,"' is a read-only computed property"));this._differs(t[o],e[o])&&(r[o]=s=!0)}s&&this._set(t,r)}});return{App:nt,data:{},store:new at({}),init:function(t){}}}));
