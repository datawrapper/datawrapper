!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/editor",t):e.editor=t()}(this,function(){"use strict";function noop(){}function assign(e,t){for(var r in t)e[r]=t[r];return e}function insertNode(e,t,r){t.insertBefore(e,r)}function detachNode(e){e.parentNode.removeChild(e)}function createElement(e){return document.createElement(e)}function createText(e){return document.createTextNode(e)}function blankObject(){return Object.create(null)}function destroy(e){this.destroy=noop,this.fire("destroy"),this.set=this.get=noop,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function _differs(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function _differsImmutable(e,t){return e!=e?t==t:e!==t}function fire(e,t){var r=e in this._handlers&&this._handlers[e].slice();if(r)for(var n=0;n<r.length;n+=1){var a=r[n];a.__calling||(a.__calling=!0,a.call(this,t),a.__calling=!1)}}function get(e){return e?this._state[e]:this._state}function init(e,t){e._handlers=blankObject(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function observe(e,t,r){var n=t.bind(this);return r&&!1===r.init||n(this.get()[e],void 0),this.on(r&&r.defer?"update":"state",function(t){t.changed[e]&&n(t.current[e],t.previous&&t.previous[e])})}function on(e,t){if("teardown"===e)return this.on("destroy",t);var r=this._handlers[e]||(this._handlers[e]=[]);return r.push(t),{cancel:function(){var e=r.indexOf(t);~e&&r.splice(e,1)}}}function set(e){this._set(assign({},e)),this.root._lock||(this.root._lock=!0,callAll(this.root._beforecreate),callAll(this.root._oncreate),callAll(this.root._aftercreate),this.root._lock=!1)}function _set(e){var t=this._state,r={},n=!1;for(var a in e)this._differs(e[a],t[a])&&(r[a]=n=!0);n&&(this._state=assign(assign({},t),e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:t}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:t})))}function callAll(e){for(;e&&e.length;)e.shift()()}function _mount(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)}function _unmount(){this._fragment&&this._fragment.u()}function removeFromStore(){this.store._remove(this)}var proto={destroy:destroy,get:get,fire:fire,observe:observe,on:on,set:set,teardown:destroy,_recompute:noop,_set:_set,_mount:_mount,_unmount:_unmount,_differs:_differs};function __(e,t){var r=arguments;if(void 0===t&&(t="core"),e=e.trim(),!dw.backend.__messages[t])return"MISSING:"+e;var n=dw.backend.__messages[t][e]||dw.backend.__messages.core[e]||e;if(arguments.length>2)for(var a=2;a<arguments.length;a++){var i=a-1;n=n.replace("$"+i,r[a])}return n}var EditorNav="./EditorNav.html",PublishSidebar="../publish/PublishSidebar.html";function data(){return{datasets:[],steps:[{id:"upload",title:__("Upload Data")},{id:"describe",title:__("Check & Describe")},{id:"visualize",title:__("Visualize")},{id:"publish",title:__("Publish & Embed")}]}}function oncreate(){var e=this.store.get().chartJSON;console.log(e);var t=new Chart(e);t.set({writable:!0}),this.store.set({chart:t})}function create_main_fragment(e,t){var r,n,a={},i={};"step"in t&&(i.active=t.step,a.active=!0),"maxStep"in t&&(i.maxStep=t.maxStep,a.maxStep=!0),"steps"in t&&(i.steps=t.steps,a.steps=!0),"$chart"in t&&(i.chart=t.$chart,a.chart=!0);var o=new EditorNav({root:e.root,data:i,_bind:function(t,r){e.get();var n={},i={};!a.active&&t.active&&(n.step=r.active),!a.maxStep&&t.maxStep&&(n.maxStep=r.maxStep),!a.steps&&t.steps&&(n.steps=r.steps),!a.chart&&t.chart&&(i.chart=r.chart),e.store.set(i),e._set(n),a={}}});function s(e){return"upload"==e.step?create_if_block:"describe"==e.step?create_if_block_1:"visualize"==e.step?create_if_block_2:"publish"==e.step?create_if_block_3:create_if_block_4}e.root._beforecreate.push(function(){o._bind({active:1,maxStep:1,steps:1,chart:1},o.get())});var u=s(t),c=u(e,t);return{c:function(){o._fragment.c(),r=createText("\n\n"),n=createElement("div"),c.c()},m:function(e,t){o._mount(e,t),insertNode(r,e,t),insertNode(n,e,t),c.m(n,null)},p:function(t,r){var i={};!a.active&&t.step&&(i.active=r.step,a.active=!0),!a.maxStep&&t.maxStep&&(i.maxStep=r.maxStep,a.maxStep=!0),!a.steps&&t.steps&&(i.steps=r.steps,a.steps=!0),!a.chart&&t.$chart&&(i.chart=r.$chart,a.chart=!0),o._set(i),a={},u!==(u=s(r))&&(c.u(),c.d(),(c=u(e,r)).c(),c.m(n,null))},u:function(){o._unmount(),detachNode(r),detachNode(n),c.u()},d:function(){o.destroy(!1),c.d()}}}function create_if_block(e,t){var r;return{c:function(){r=createText("UPLOAD")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_1(e,t){var r;return{c:function(){r=createText("DESCRIBE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_2(e,t){var r;return{c:function(){r=createText("VISUALIZE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_3(e,t){var r=new PublishSidebar({root:e.root});return{c:function(){r._fragment.c()},m:function(e,t){r._mount(e,t)},u:function(){r._unmount()},d:function(){r.destroy(!1)}}}function create_if_block_4(e,t){var r;return{c:function(){r=createText(":(")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function ChartEditor(e){init(this,e),this._state=assign(assign(this.store._init(["chart"]),data()),e.data),this.store._add(this,["chart"]),this._handlers.destroy=[removeFromStore];var t=this;e.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(function(){oncreate.call(t),t.fire("update",{changed:{step:1,maxStep:1,steps:1,$chart:1},current:t._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),this._lock=!0,callAll(this._beforecreate),callAll(this._oncreate),callAll(this._aftercreate),this._lock=!1)}function Store(e,t){this._observers={pre:blankObject(),post:blankObject()},this._handlers={},this._dependents=[],this._computed=blankObject(),this._sortedComputedProperties=[],this._state=assign({},e),this._differs=t&&t.immutable?_differsImmutable:_differs}function _isObject(e){var t=typeof e;return"function"===t||"object"===t&&!!e}assign(ChartEditor.prototype,proto),assign(Store.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r];t["$"+n]=this._state[n]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_sortComputedProperties:function(){var e,t=this._computed,r=this._sortedComputedProperties=[],n=blankObject();function a(i){if(e[i])throw new Error("Cyclical dependency detected");if(!n[i]){n[i]=!0;var o=t[i];o&&(e[i]=!0,o.deps.forEach(a),r.push(o))}}for(var i in this._computed)e=blankObject(),a(i)},compute:function(e,t,r){var n,a=this,i={deps:t,update:function(i,o,s){var u=t.map(function(e){return e in o&&(s=!0),i[e]});if(s){var c=r.apply(null,u);a._differs(c,n)&&(n=c,o[e]=!0,i[e]=n)}}};i.update(this._state,{},!0),this._computed[e]=i,this._sortComputedProperties()},fire:fire,get:get,observe:observe,on:on,onchange:function(e){return console.warn("store.onchange is deprecated in favour of store.on('state', event => {...})"),this.on("state",function(t){e(t.current,t.changed)})},set:function(e){var t=this._state,r=this._changed={},n=!1;for(var a in e){if(this._computed[a])throw new Error("'"+a+"' is a read-only property");this._differs(e[a],t[a])&&(r[a]=n=!0)}if(n){this._state=assign(assign({},t),e);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,r);this.fire("state",{changed:r,current:this._state,previous:t});var o=this._dependents.slice();for(i=0;i<o.length;i+=1){var s=o[i],u={};n=!1;for(var c=0;c<s.props.length;c+=1){var l=s.props[c];l in r&&(u["$"+l]=this._state[l],n=!0)}n&&s.component.set(u)}this.fire("update",{changed:r,current:this._state,previous:t})}}});var ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys;function _has(e,t){return null!=e&&hasOwnProperty.call(e,t)}function _each(e,t,r){var n,a;if(t=optimizeCb(t,r),isArrayLike(e))for(n=0,a=e.length;n<a;n++)t(e[n],n,e);else{var i=_keys(e);for(n=0,a=i.length;n<a;n++)t(e[i[n]],i[n],e)}return e}var _findIndex=createPredicateIndexFinder(1);function _sortedIndex(e,t,r,n){for(var a=(r=cb(r,n,1))(t),i=0,o=getLength(e);i<o;){var s=Math.floor((i+o)/2);r(e[s])<a?i=s+1:o=s}return i}var _indexOf=createIndexFinder(1,_findIndex,_sortedIndex);function _values(e){for(var t=_keys(e),r=t.length,n=Array(r),a=0;a<r;a++)n[a]=e[t[a]];return n}function _contains(e,t,r,n){return isArrayLike(e)||(e=_values(e)),("number"!=typeof r||n)&&(r=0),_indexOf(e,t,r)>=0}var _isArray=nativeIsArray||function(e){return"[object Array]"===toString.call(e)};function customFunction(){return"function"!=typeof/./&&"object"!=typeof Int8Array&&"undefined"!=typeof document&&"function"!=typeof document.childNodes?function(e){return"function"==typeof e||!1}:null}var _isFunction=customFunction()||function(e){return"[object Function]"===toString.call(e)};function customArguments(){return"[object Arguments]"===toString.call(arguments)?null:function(e){return _has(e,"callee")}}var _isArguments=customArguments()||function(e){return"[object Arguments]"===toString.call(e)};function _isNumber(e){return"[object Number]"===toString.call(e)}function _isNaN(e){return _isNumber(e)&&isNaN(e)}function _invert(e){for(var t={},r=_keys(e),n=0,a=r.length;n<a;n++)t[e[r[n]]]=r[n];return t}var _iteratee=builtinIteratee;function _identity(e){return e}var _extendOwn=createAssigner(_keys);function _isMatch(e,t){var r=_keys(t),n=r.length;if(null==e)return!n;for(var a=Object(e),i=0;i<n;i++){var o=r[i];if(t[o]!==a[o]||!(o in a))return!1}return!0}function _matcher(e){return e=_extendOwn({},e),function(t){return _isMatch(t,e)}}function optimizeCb(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,a){return e.call(t,r,n,a)};case 4:return function(r,n,a,i){return e.call(t,r,n,a,i)}}return function(){return e.apply(t,arguments)}}function builtinIteratee(e,t){return cb(e,t,1/0)}function cb(e,t,r){return _iteratee!==builtinIteratee?_iteratee(e,t):null==e?_identity:_isFunction(e)?optimizeCb(e,t,r):_isObject(e)?_matcher(e):property(e)}function restArgs(e,t){return t=null==t?e.length-1:+t,function(){for(var r=arguments,n=Math.max(arguments.length-t,0),a=Array(n),i=0;i<n;i++)a[i]=r[i+t];switch(t){case 0:return e.call(this,a);case 1:return e.call(this,arguments[0],a);case 2:return e.call(this,arguments[0],arguments[1],a)}var o=Array(t+1);for(i=0;i<t;i++)o[i]=r[i];return o[t]=a,e.apply(this,o)}}function property(e){return function(t){return null==t?void 0:t[e]}}var MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(e){var t=getLength(e);return"number"==typeof t&&t>=0&&t<=MAX_ARRAY_INDEX};function flatten(e,t,r,n){for(var a=(n=n||[]).length,i=0,o=getLength(e);i<o;i++){var s=e[i];if(isArrayLike(s)&&(_isArray(s)||_isArguments(s)))if(t)for(var u=0,c=s.length;u<c;)n[a++]=s[u++];else flatten(s,t,r,n),a=n.length;else r||(n[a++]=s)}return n}function createPredicateIndexFinder(e){return function(t,r,n){r=cb(r,n);for(var a=getLength(t),i=e>0?0:a-1;i>=0&&i<a;i+=e)if(r(t[i],i,t))return i;return-1}}function createIndexFinder(e,t,r){return function(n,a,i){var o=0,s=getLength(n);if("number"==typeof i)e>0?o=i>=0?i:Math.max(i+s,o):s=i>=0?Math.min(i+1,s):i+s+1;else if(r&&i&&s)return n[i=r(n,a)]===a?i:-1;if(a!=a)return(i=t(slice.call(n,o,s),_isNaN))>=0?i+o:-1;for(i=e>0?o:s-1;i>=0&&i<s;i+=e)if(n[i]===a)return i;return-1}}var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(e,t){var r=nonEnumerableProps.length,n=e.constructor,a=_isFunction(n)&&n.prototype||ObjProto,i="constructor";for(_has(e,i)&&!_contains(t,i)&&t.push(i);r--;)(i=nonEnumerableProps[r])in e&&e[i]!==a[i]&&!_contains(t,i)&&t.push(i)}function createAssigner(e,t){return function(r){var n=arguments,a=arguments.length;if(t&&(r=Object(r)),a<2||null==r)return r;for(var i=1;i<a;i++)for(var o=n[i],s=e(o),u=s.length,c=0;c<u;c++){var l=s[c];!_isObject(r)||t&&void 0!==r[l]||(r[l]=o[l])}return r}}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_invert(escapeMap);function _keys(e){if(!_isObject(e))return[];if(nativeKeys)return nativeKeys(e);var t=[];for(var r in e)_has(e,r)&&t.push(r);return hasEnumBug&&collectNonEnumProps(e,t),t}function _some(e,t,r){t=cb(t,r);for(var n=!isArrayLike(e)&&_keys(e),a=(n||e).length,i=0;i<a;i++){var o=n?n[i]:i;if(t(e[o],o,e))return!0}return!1}function _isUndefined(e){return void 0===e}function _isNull(e){return null===e}var _delay=restArgs(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)});function _debounce(e,t,r){var n,a,i=function(t,r){n=null,r&&(a=e.apply(t,r))},o=restArgs(function(o){if(n&&clearTimeout(n),r){var s=!n;n=setTimeout(i,t),s&&(a=e.apply(this,o))}else n=_delay(i,t,this,o);return a});return o.cancel=function(){clearTimeout(n),n=null},o}function _range(e,t,r){null==t&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),a=Array(n),i=0;i<n;i++,e+=r)a[i]=e;return a}function _isString(e){return"[object String]"===toString.call(e)}function dataset(e){var t={},r=e.slice(0);function n(e){for(var r=e.name(),n=r,a=1;t.hasOwnProperty(n);)n=r+"."+a++;n!=r&&e.name(n)}e.forEach(function(e){n(e),t[e.name()]=e});var a={columns:function(){return e},column:function(r){if(_isString(r)){if(void 0!==t[r])return t[r];throw'No column found with that name: "'+r+'"'}if(!(r<0)){if(void 0!==e[r])return e[r];throw"No column found with that index: "+r}},numColumns:function(){return e.length},numRows:function(){return e[0].length},eachColumn:function(t){e.forEach(t)},hasColumn:function(r){return void 0!==(_isString(r)?t[r]:e[r])},indexOf:function(r){return a.hasColumn(r)?e.indexOf(t[r]):-1},list:function(){return _range(e[0].length).map(function(t){var r={};return e.forEach(function(e){r[e.name()]=e.val(t)}),r})},csv:function(){var t="";return e.forEach(function(e,r){var n=e.title();n.indexOf('"')>-1&&n.replace('"','\\"'),n.indexOf(",")>-1&&(n='"'+n+'"'),t+=(r>0?",":"")+n}),_range(a.numRows()).forEach(function(r){t+="\n",e.forEach(function(e,n){var a=""+("date"==e.type()?e.raw(r):e.val(r));a.indexOf('"')>-1&&a.replace('"','\\"'),a.indexOf(",")>-1&&(a='"'+a+'"'),t+=(n>0?",":"")+a})}),t},toCSV:function(){return this.csv()},filterColumns:function(r){return e=e.filter(function(e){return!r[e.name()]}),r.forEach(function(e,r){e&&t[r]&&delete t[r]}),a},eachRow:function(e){var t;for(t=0;t<a.numRows();t++)e(t);return a},add:function(i){return n(i),e.push(i),t[i.name()]=i,r.push(i),a},reset:function(){return e=r.slice(0),t={},e.forEach(function(e){t[e.name()]=e}),a},limitRows:function(t){return e.forEach(function(e){e.limitRows(t)}),a},limitColumns:function(t){return e.length>t&&(e.length=t,r.length=t),a},columnOrder:function(t){return arguments.length?(e.length=0,t.forEach(function(t){e.push(r[t])}),a):e.map(function(e){return r.indexOf(e)})}};return a}function _every(e,t,r){t=cb(t,r);for(var n=!isArrayLike(e)&&_keys(e),a=(n||e).length,i=0;i<a;i++){var o=n?n[i]:i;if(!t(e[o],o,e))return!1}return!0}function _findKey(e,t,r){t=cb(t,r);for(var n,a=_keys(e),i=0,o=a.length;i<o;i++)if(t(e[n=a[i]],n,e))return n}function _find(e,t,r){var n=(isArrayLike(e)?_findIndex:_findKey)(e,t,r);if(void 0!==n&&-1!==n)return e[n]}function _isDate(e){return"[object Date]"===toString.call(e)}function _random(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}function _allKeys(e){if(!_isObject(e))return[];var t=[];for(var r in e)t.push(r);return hasEnumBug&&collectNonEnumProps(e,t),t}var _extend=createAssigner(_allKeys);function _clone(e){return _isObject(e)?_isArray(e)?e.slice():_extend({},e):e}function _sample(e,t,r){if(null==t||r)return isArrayLike(e)||(e=_values(e)),e[_random(e.length-1)];var n=isArrayLike(e)?_clone(e):_values(e),a=getLength(n);t=Math.max(Math.min(t,a),0);for(var i=a-1,o=0;o<t;o++){var s=_random(o,i),u=n[o];n[o]=n[s],n[s]=u}return n.slice(0,t)}function _shuffle(e){return _sample(e,1/0)}function _map(e,t,r){t=cb(t,r);for(var n=!isArrayLike(e)&&_keys(e),a=(n||e).length,i=Array(a),o=0;o<a;o++){var s=n?n[o]:o;i[o]=t(e[s],s,e)}return i}function _flatten(e,t){return flatten(e,t,!1)}function _isRegExp(e){return"[object RegExp]"===toString.call(e)}function equalish(e,t){return e-t<1e-6}var columnTypes={},_identity$1=function(e){return e};columnTypes.text=function(){return{parse:_identity$1,errors:function(){return 0},name:function(){return"text"},formatter:function(){return _identity$1},isValid:function(){return!0},format:function(){}}},columnTypes.number=function(e){var t,r=0,n={"-.":/^ *[-–—−]?[0-9]*(\.[0-9]+)?(e[+-][0-9]+)?%? *$/,"-,":/^ *[-–—−]?[0-9]*(,[0-9]+)?%? *$/,",.":/^ *[-–—−]?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)?%? *$/,".,":/^ *[-–—−]?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/,"'.":/^ *[-–—−]?[0-9]{1,3}('[0-9]{3})*(\.[0-9]+)?%? *$/},a={"-.":"1234.56","-,":"1234,56",",.":"1,234.56",".,":"1.234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"},i={na:1,"n/a":1,"-":1,":":1},o={},s=["-.",0];_each(e=e||[],function(e){_each(n,function(t,r){void 0===o[r]&&(o[r]=0),t.test(e)&&(o[r]+=1,o[r]>s[1]&&(s[0]=r,s[1]=o[r]))})}),t=s[0];var u={parse:function(e){if(_isNumber(e)||_isUndefined(e)||_isNull(e))return e;var n=e.replace("%","").replace("−","-").replace("–","-").replace("—","-");return"-"!==t[0]&&(n=n.replace(new RegExp("."===t[0]?"\\.":t[0],"g"),"")),"."!==t[1]&&(n=n.replace(t[1],".")),isNaN(n)||""===n?(i[n.toLowerCase()]||""===n||r++,e):Number(n)},toNum:function(e){return e},fromNum:function(e){return e},errors:function(){return r},name:function(){return"number"},formatter:function(e){var t=e["number-format"]||"-",r=Number(e["number-divisor"]||0),n=(e["number-append"]||"").replace(/ /g," "),a=(e["number-prepend"]||"").replace(/ /g," ");return function(e,i,o){if(isNaN(e))return e;var s=t;if(0!==r&&"-"===s&&(s="n1"),0!==r&&(e=Number(e)/Math.pow(10,r)),"s"===s.substr(0,1)){var u=+s.substr(1);s="n"+Math.max(0,function(e,t){return 0===e?0:Math.round(t-Math.ceil(Math.log(Math.abs(e))/Math.LN10))}(e,u))}return o&&(s="n0"),"-"===s&&(s=equalish(e,Math.round(e))?"n0":equalish(e,.1*Math.round(10*e))?"n1":equalish(e,.01*Math.round(100*e))?"n2":equalish(e,.001*Math.round(1e3*e))?"n3":equalish(e,1e-4*Math.round(1e4*e))?"n4":equalish(e,1e-5*Math.round(1e5*e))?"n5":"n6"),e=Globalize.format(e,"-"!==s?s:null),i?a+e+n:e}},isValid:function(e){return""===e||i[String(e).toLowerCase()]||_isNumber(u.parse(e))},ambiguousFormats:function(){var e=[];return _each(o,function(t,r){t===s[1]&&e.push([r,a[r]])}),e},format:function(e){return arguments.length?(t=e,u):t}};return u},columnTypes.date=function(){var e=/^ */.source,t=/[*']* *$/.source,r=/[ \-/.]?/.source,n=/[ \-/.]/.source,a=/[ \-/.,]/.source,i=/[ \-|T]/.source,o={YY:{parse:/['’‘]?(\d{2})/},YYYY:{test:/([12]\d{3})/,parse:/(\d{4})/},YYYY2:{test:/(?:1[7-9]|20)\d{2}/,parse:/(\d{4})/},H:{parse:/h([12])/},Q:{parse:/q([1234])/},W:{parse:/w([0-5]?[0-9])/},Mm:{test:/m?(0?[1-9]|1[0-2])/,parse:/m?(0?[1-9]|1[0-2])/},MM:{test:/(0?[1-9]|1[0-2])/,parse:/(0?[1-9]|1[0-2])/},DD:{parse:/(0?[1-9]|[1-2][0-9]|3[01])/},DOW:{parse:/([0-7])/},HHMM:{parse:/(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *(am|pm)?/}},s={0:["jan","january","januar","jänner","jän","janv","janvier","ene","enero","gen","gennaio","janeiro"],1:["feb","february","febr","februar","fév","févr","février","febrero","febbraio","fev","fevereiro"],2:["mar","mär","march","mrz","märz","mars","mars","marzo","marzo","março"],3:["apr","april","apr","april","avr","avril","abr","abril","aprile"],4:["may","mai","mayo","mag","maggio","maio","maj"],5:["jun","june","juni","juin","junio","giu","giugno","junho"],6:["jul","july","juli","juil","juillet","julio","lug","luglio","julho"],7:["aug","august","août","ago","agosto"],8:["sep","september","sept","septembre","septiembre","set","settembre","setembro"],9:["oct","october","okt","oktober","octobre","octubre","ott","ottobre","out","outubro"],10:["nov","november","november","novembre","noviembre","novembre","novembro"],11:["dec","december","dez","des","dezember","déc","décembre","dic","diciembre","dicembre","desember","dezembro"]},u={};_each(s,function(e,t){_each(e,function(e){u[e]=t})}),o.MMM={parse:new RegExp("("+_flatten(_values(s)).join("|")+")")},_each(o,function(e){e.parse=e.parse.source,_isRegExp(e.test)?e.test=e.test.source:e.test=e.parse});var c={YYYY:{test:l(o.YYYY2.test),parse:l(o.YYYY2.parse),precision:"year"},"YYYY-H":{test:l(o.YYYY.test,r,o.H.test),parse:l(o.YYYY.parse,r,o.H.parse),precision:"half"},"H-YYYY":{test:l(o.H.test,n,o.YYYY.test),parse:l(o.H.parse,n,o.YYYY.parse),precision:"half"},"YYYY-Q":{test:l(o.YYYY.test,r,o.Q.test),parse:l(o.YYYY.parse,r,o.Q.parse),precision:"quarter"},"Q-YYYY":{test:l(o.Q.test,n,o.YYYY.test),parse:l(o.Q.parse,n,o.YYYY.parse),precision:"quarter"},"YYYY-M":{test:l(o.YYYY.test,r,o.Mm.test),parse:l(o.YYYY.parse,r,o.Mm.parse),precision:"month"},"M-YYYY":{test:l(o.MM.test,n,o.YYYY.test),parse:l(o.MM.parse,n,o.YYYY.parse),precision:"month"},"YYYY-MMM":{test:l(o.YYYY.test,n,o.MMM.parse),parse:l(o.YYYY.parse,n,o.MMM.parse),precision:"month"},"MMM-YYYY":{test:l(o.MMM.parse,n,o.YYYY.test),parse:l(o.MMM.parse,n,o.YYYY.parse),precision:"month"},"MMM-YY":{test:l(o.MMM.parse,n,o.YY.test),parse:l(o.MMM.parse,n,o.YY.parse),precision:"month"},MMM:{test:l(o.MMM.parse),parse:l(o.MMM.parse),precision:"month"},"YYYY-WW":{test:l(o.YYYY.test,r,o.W.test),parse:l(o.YYYY.parse,r,o.W.parse),precision:"week"},"WW-YYYY":{test:l(o.W.test,n,o.YYYY.test),parse:l(o.W.parse,n,o.YYYY.parse),precision:"week"},"MM/DD/YYYY":{test:l(o.MM.test,"([\\-\\/])",o.DD.test,"\\2",o.YYYY.test),parse:l(o.MM.parse,"([\\-\\/])",o.DD.parse,"\\2",o.YYYY.parse),precision:"day"},"DD/MM/YYYY":{test:l(o.DD.test,"([\\-\\.\\/ ?])",o.MM.test,"\\2",o.YYYY.test),parse:l(o.DD.parse,"([\\-\\.\\/ ?])",o.MM.parse,"\\2",o.YYYY.parse),precision:"day"},"DD/MMM/YYYY":{test:l(o.DD.test,"([\\-\\.\\/ ?])",o.MMM.test,"\\2",o.YYYY.test),parse:l(o.DD.parse,"([\\-\\.\\/ ?])",o.MMM.parse,"\\2",o.YYYY.parse),precision:"day"},"DD/MMM/YY":{test:l(o.DD.test,"([\\-\\.\\/ ?])",o.MMM.test,"\\2",o.YY.test),parse:l(o.DD.parse,"([\\-\\.\\/ ?])",o.MMM.parse,"\\2",o.YY.parse),precision:"day"},"YYYY-MM-DD":{test:l(o.YYYY.test,"([\\-\\.\\/ ?])",o.MM.test,"\\2",o.DD.test),parse:l(o.YYYY.parse,"([\\-\\.\\/ ?])",o.MM.parse,"\\2",o.DD.parse),precision:"day"},"MMM-DD-YYYY":{test:l(o.MMM.test,n,o.DD.test,a,o.YYYY.test),parse:l(o.MMM.parse,n,o.DD.parse,a,o.YYYY.parse),precision:"day"},"YYYY-WW-d":{test:l(o.YYYY.test,r,o.W.test,n,o.DOW.test),parse:l(o.YYYY.parse,r,o.W.parse,n,o.DOW.parse),precision:"day"},"MM/DD/YYYY HH:MM":{test:l(o.MM.test,"([\\-\\/])",o.DD.test,"\\2",o.YYYY.test,i,o.HHMM.test),parse:l(o.MM.parse,"([\\-\\/])",o.DD.parse,"\\2",o.YYYY.parse,i,o.HHMM.parse),precision:"day-minutes"},"DD.MM.YYYY HH:MM":{test:l(o.DD.test,"([\\-\\.\\/ ?])",o.MM.test,"\\2",o.YYYY.test,i,o.HHMM.test),parse:l(o.DD.parse,"([\\-\\.\\/ ?])",o.MM.parse,"\\2",o.YYYY.parse,i,o.HHMM.parse),precision:"day-minutes"},"YYYY-MM-DD HH:MM":{test:l(o.YYYY.test,"([\\-\\.\\/ ?])",o.MM.test,"\\2",o.DD.test,i,o.HHMM.test),parse:l(o.YYYY.parse,"([\\-\\.\\/ ?])",o.MM.parse,"\\2",o.DD.parse,i,o.HHMM.parse),precision:"day-minutes"},ISO8601:{test:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,parse:function(e){return e},precision:"day-seconds"}};function l(){return new RegExp(e+Array.prototype.slice.call(arguments).join(" *")+t,"i")}function f(e,t){var r=c[t];return _isRegExp(r.test)?r.test.test(e):r.test(e,t)}function p(e,t,r){var n=new Date(Date.UTC(e,0,3));return n.setUTCDate(3-n.getUTCDay()+7*(t-1)+parseInt(r,10)),n}function d(e,t){return 12!==e?e+("pm"===t?12:0):"am"===t?0:12}return function(e){var t,r=0,n={},a=["",0];e=e||[],_each(c,function(t,r){_each(e,function(e){void 0===n[r]&&(n[r]=0),f(e,r)&&(n[r]+=1,n[r]>a[1]&&(a[0]=r,a[1]=n[r]))})}),t=a[0];var i={parse:function(e){if(_isDate(e)||_isUndefined(e))return e;if(!t||!_isString(e))return r++,e;var n,a,i,o=(n=e.toLowerCase(),_isRegExp((i=c[a=t]).parse)?n.match(i.parse):i.parse(n,a));if(!o)return r++,e;function s(e){return(e=+e)<20?2e3+e:1900+e}f(e,t)||r++;var l=(new Date).getFullYear();switch(t){case"YYYY":return new Date(o[1],0,1);case"YYYY-H":return new Date(o[1],6*(o[2]-1),1);case"H-YYYY":return new Date(o[2],6*(o[1]-1),1);case"YYYY-Q":return new Date(o[1],3*(o[2]-1),1);case"Q-YYYY":return new Date(o[2],3*(o[1]-1),1);case"YYYY-M":return new Date(o[1],o[2]-1,1);case"M-YYYY":return new Date(o[2],o[1]-1,1);case"YYYY-MMM":return new Date(+o[1],u[o[2]],1);case"MMM-YYYY":return new Date(+o[2],u[o[1]],1);case"MMM-YY":return new Date(s(+o[2]),u[o[1]],1);case"MMM":return new Date(l,u[o[1]],1);case"YYYY-WW":return p(o[1],o[2],1);case"WW-YYYY":return p(o[2],o[1],1);case"YYYY-WW-d":return p(o[1],o[2],o[3]);case"YYYY-MM-DD":return new Date(o[1],o[3]-1,o[4]);case"DD/MM/YYYY":return new Date(o[4],o[3]-1,o[1]);case"DD/MMM/YYYY":return new Date(o[4],u[o[3]],o[1]);case"DD/MMM/YY":return new Date(s(o[4]),u[o[3]],o[1]);case"MM/DD/YYYY":return new Date(o[4],o[1]-1,o[3]);case"MMM-DD-YYYY":return new Date(o[3],u[o[1]],o[2]);case"YYYY-MM-DD HH:MM":return new Date(+o[1],o[3]-1,+o[4],d(+o[5],o[8]),+o[6]||0,+o[7]||0);case"DD.MM.YYYY HH:MM":return new Date(+o[4],o[3]-1,+o[1],d(+o[5],o[8]),+o[6]||0,+o[7]||0);case"MM/DD/YYYY HH:MM":return new Date(+o[4],o[1]-1,+o[3],d(+o[5],o[8]),+o[6]||0,+o[7]||0);case"ISO8601":return new Date(o.toUpperCase());default:console.warn("unknown format",t)}return r++,e},toNum:function(e){return e.getTime()},fromNum:function(e){return new Date(e)},errors:function(){return r},name:function(){return"date"},format:function(e){return arguments.length?(t=e,i):t},precision:function(){return c[t].precision},formatter:function(){if(!t)return _identity$1;var e=Globalize.culture().calendar.patterns.M.replace("MMMM","MMM");switch(c[t].precision){case"year":return function(e){return _isDate(e)?e.getFullYear():e};case"half":return function(e){return _isDate(e)?e.getFullYear()+" H"+(e.getMonth()/6+1):e};case"quarter":return function(e){return _isDate(e)?e.getFullYear()+" Q"+(e.getMonth()/3+1):e};case"month":return function(e){return _isDate(e)?Globalize.format(e,"MMM yy"):e};case"week":return function(e){return _isDate(e)?function(e){var t=e.getUTCDay(),r=new Date(e.valueOf());r.setDate(r.getDate()-(t+6)%7+3);var n=r.getUTCFullYear(),a=Math.floor((r.getTime()-new Date(n,0,1,-6))/864e5);return[n,1+Math.floor(a/7),t>0?t:7]}(e).slice(0,2).join(" W"):e};case"day":return function(e,t){return _isDate(e)?Globalize.format(e,t?"D":"d"):e};case"day-minutes":return function(t){return _isDate(t)?Globalize.format(t,e).replace(" ","&nbsp;")+" - "+Globalize.format(t,"t").replace(" ","&nbsp;"):t};case"day-seconds":return function(e){return _isDate(e)?Globalize.format(e,"T").replace(" ","&nbsp;"):e}}},isValid:function(e){return _isDate(i.parse(e))},ambiguousFormats:function(){var e=[];return _each(n,function(t,r){t===a[1]&&e.push([r,r])}),e}};return i}}();var TAGS=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,COMMENTS_AND_PHP_TAGS=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,default_allowed="<a><b><br><br/><i><strong><sup><sub><strike><u><em><tt>";function purifyHtml(e,t){if(null===e)return null;if(void 0!==e){if((e=String(e)).indexOf("<")<0||e.indexOf(">")<0)return e;if(e=stripTags(e,t),"undefined"==typeof document)return e;var r=document.createElement("div");r.innerHTML=e;for(var n=r.querySelectorAll("*"),a=0;a<n.length;a++)for(var i=0;i<n[a].attributes.length;i++){var o=n[a].attributes[i];o.specified&&"on"==o.name.substr(0,2)&&n[a].removeAttribute(o.name)}return r.innerHTML}}function stripTags(e,t){t=(((void 0!==t?t||"":default_allowed)+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");for(var r=e,n=e;;)if((r=n)===(n=r.replace(COMMENTS_AND_PHP_TAGS,"").replace(TAGS,function(e,r){return t.indexOf("<"+r.toLowerCase()+">")>-1?e:""})))return n}function column(e,t,r){function n(e){return null!==e&&void 0!==e&&""!==e}var a=_shuffle(_range(t.length)).filter(function(e){return n(t[e])}).slice(0,200).map(function(e){return t[e]});r=r?columnTypes[r](a):function(e){if(_every(t,_isNumber))return columnTypes.number();if(_every(t,_isDate))return columnTypes.date();var r,a=[columnTypes.date(e),columnTypes.number(e),columnTypes.text()],i=t.filter(n).length;return _each(t,function(e){_each(a,function(t){t.parse(e)})}),_every(a,function(e){return e.errors()/i<.1&&(r=e),!r}),_isUndefined(r)&&(r=a[2]),r}(a);var i,o,s,u=t.slice(0),c={name:function(){return arguments.length?(e=arguments[0],c):purifyHtml(e)},title:function(){return arguments.length?(s=arguments[0],c):purifyHtml(s||e)},length:t.length,val:function(e,n){if(arguments.length){var a=n?u:t;return e<0&&(e+=a.length),r.parse(purifyHtml(a[e]))}},values:function(e){var n=e?u:t;return _map(n=_map(n,function(e){return purifyHtml(e)}),r.parse)},each:function(e){for(var r=0;r<t.length;r++)e(c.val(r),r)},raw:function(e,r){return arguments.length?2==arguments.length?(t[e]=r,c):purifyHtml(t[e]):t},type:function(e){if(!0===e)return r;if(_isString(e)){if(columnTypes[e])return r=columnTypes[e](a),c;throw"unknown column type: "+e}return r.name()},range:function(){return!!r.toNum&&(i||(i=[Number.MAX_VALUE,-Number.MAX_VALUE],c.each(function(e){_isNumber(e=r.toNum(e))&&!_isNaN(e)&&(e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e))}),i[0]=r.fromNum(i[0]),i[1]=r.fromNum(i[1])),i)},total:function(){return!!r.toNum&&(o||(o=0,c.each(function(e){o+=r.toNum(e)}),o=r.fromNum(o)),o)},filterRows:function(e){return t=[],arguments.length?_each(e,function(e){t.push(u[e])}):t=u.slice(0),c.length=t.length,i=o=!1,c},toString:function(){return e+" ("+r.name()+")"},indexOf:function(e){return _find(_range(t.length),function(t){return c.val(t)==e})},limitRows:function(e){u.length>e&&(u.length=e,t.length=e,c.length=e)}};return c}function delimited(e){return{dataset:function(){if(e.url);else if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(t){return new DelimitedParser(e).parse(t)});throw"you need to provide either an URL or CSV data."},parse:function(){return new DelimitedParser(e).parse(e.csv)}}}var DelimitedParser=function(e){e=Object.assign({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:!1,firstRowIsHeader:!0},e),this.__delimiterPatterns=getDelimiterPatterns(e.delimiter,e.quoteChar),this.opts=e};function getDelimiterPatterns(e,t){return new RegExp("(\\"+e+"|\\r?\\n|\\r|^)(?:"+t+"([^"+t+"]*(?:"+t+'"[^'+t+"]*)*)"+t+"|([^"+t+"\\"+e+"\\r\\n]*))","gi")}function json(e){return{dataset:function(){if(e.url)return fetch(e.url).then(function(e){return e.text()}).then(function(e){return JSON.parse(e)});if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(e){return JSON.parse(e)});throw"you need to provide either an URL or CSV data."},parse:function(){return JSON.parse(e.csv)}}}function reorderColumns(e,t){var r=e.getMetadata("data.column-order",[]);return r.length&&r.length==t.numColumns()&&t.columnOrder(r),t}function applyChanges(e,t){var r=e.getMetadata("data.changes",[]),n=e.getMetadata("data.transpose",!1);return r.forEach(function(e){var r="row",a="column";n&&(r="column",a="row"),t.hasColumn(e[a])&&(0===e[r]?t.column(e[a]).title(e.value):t.column(e[a]).raw(e[r]-1,e.value))}),_each(e.getMetadata("data.column-format",{}),function(e,r){e.type&&t.hasColumn(r)&&"auto"!=e.type&&t.column(r).type(e.type),e["input-format"]&&t.hasColumn(r)&&t.column(r).type(!0).format(e["input-format"])}),t}function _isBoolean(e){return!0===e||!1===e||"[object Boolean]"===toString.call(e)}function addComputedColumns(chart,dataset){var v_columns=chart.getMetadata("describe.computed-columns",{}),data=dataset.list(),columnNameToVar={},col_aggregates={};return dataset.eachColumn(function(e){e.isComputed||(columnNameToVar[e.name()]=column_name_to_var(e.name()),"number"==e.type()&&(col_aggregates[e.name()]={min:d3_min(e.values()),max:d3_max(e.values()),sum:d3_sum(e.values()),mean:d3_mean(e.values()),median:d3_median(e.values())}))}),_each(v_columns,add_computed_column),dataset;function add_computed_column(formula,name){var datefmt=function(e){return e.getFullYear()+"-"+left_pad(1+e.getMonth(),2,0)+"-"+left_pad(1+e.getDate(),2,0)},values=data.map(function(row,row_i){var context=[];return context.push("var __row = "+row_i+";"),row.forEach(function(e,t){columnNameToVar[t]&&(context.push("var "+columnNameToVar[t]+" = "+JSON.stringify(e)+";"),"number"==dataset.column(t).type()&&(context.push("var "+columnNameToVar[t]+"__sum = "+col_aggregates[t].sum+";"),context.push("var "+columnNameToVar[t]+"__min = "+col_aggregates[t].min+";"),context.push("var "+columnNameToVar[t]+"__max = "+col_aggregates[t].max+";"),context.push("var "+columnNameToVar[t]+"__mean = "+col_aggregates[t].mean+";"),context.push("var "+columnNameToVar[t]+"__median = "+col_aggregates[t].median+";")))}),context.push("var max = Math.max, min = Math.min;"),function(){try{return eval(this.context.join("\n")+"\n"+formula)}catch(e){return console.warn(e),"n/a"}}.call({context:context})}).map(function(e){return _isBoolean(e)?e?"yes":"no":_isDate(e)?datefmt(e):_isNumber(e)?""+e:String(e)}),v_col=dw.column(name,values);v_col.isComputed=!0,dataset.add(v_col)}function column_name_to_var(e){return e.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w\-]+/g,"").replace(/-/g,"_").replace(/\_\_+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/^(abstract|arguments|await|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|eval|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|let|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var|void|volatile|while|window|with|yield)$/,"$1_")}function d3_min(e){var t,r,n=-1,a=e.length;if(1===arguments.length){for(;++n<a;)if(null!=(r=e[n])&&r>=r){t=r;break}for(;++n<a;)null!=(r=e[n])&&t>r&&(t=r)}return t}function d3_max(e){var t,r,n=-1,a=e.length;if(1===arguments.length){for(;++n<a;)if(null!=(r=e[n])&&r>=r){t=r;break}for(;++n<a;)null!=(r=e[n])&&r>t&&(t=r)}return t}function d3_sum(e){var t,r=0,n=e.length,a=-1;if(1===arguments.length)for(;++a<n;)d3_numeric(t=+e[a])&&(r+=t);return r}function d3_mean(e){for(var t,r=0,n=e.length,a=-1,i=n;++a<n;)d3_numeric(t=d3_number(e[a]))?r+=t:--i;if(i)return r/i}function d3_median(e){var t,r=[],n=e.length,a=-1;if(1===arguments.length)for(;++a<n;)d3_numeric(t=d3_number(e[a]))&&r.push(t);if(r.length)return d3_quantile(r.sort(d3_ascending),.5)}function d3_quantile(e,t){var r=(e.length-1)*t+1,n=Math.floor(r),a=+e[n-1],i=r-n;return i?a+i*(e[n]-a):a}function d3_number(e){return null===e?NaN:+e}function d3_numeric(e){return!isNaN(e)}function d3_ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function left_pad(e,t,r){for(e=String(e);e.length<t;)e=String(r)+e;return e}}function loadGlobalizeLocale(e,t){window.Globalize.cultures.hasOwnProperty(e)?(window.Globalize.culture(e),"function"==typeof t&&t()):getScript("/static/vendor/globalize/cultures/globalize.culture."+e+".js",function(){window.Globalize.culture(e),"function"==typeof t&&t()})}function getScript(e,t){var r=document.createElement("script"),n=document.getElementsByTagName("script")[0];r.async=1,r.onload=r.onreadystatechange=function(e,n){(n||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,r=void 0,n||t&&t())},r.src=URL,n.parentNode.insertBefore(r,n)}function fetchJSON(e,t,r,n,a){var i={method:t,body:n,mode:"cors",credentials:r};window.fetch(e,i).then(function(e){return 200!=e.status?new Error(e.statusText):e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return console.warn("malformed json input",e),e}}).then(a).catch(function(e){console.error(e)})}function putJSON(e,t,r){return fetchJSON(e,"PUT","include",t,r)}function getNestedValue(e,t){for(var r=0;r<t.length;r+=1){if(!e)return;e=e[t[r]]}return e}function observeDeep(e,t,r){var n=e.replace(/\[(\d+)\]/g,".$1").split("."),a=n[0],i=t.bind(this),o=getNestedValue(this.get(),n);return r&&!1===r.init||i(o),this.on(r&&r.defer?"update":"state",function(e){var t=e.changed,r=e.current;e.previous;if(t[a]){var s=getNestedValue(r,n);s===o&&"object"!=typeof s&&"function"!=typeof s||(i(s,o),o=s)}})}DelimitedParser.prototype.parse=function(e){this.__rawData=e;var t=this.opts;"auto"==t.delimiter&&(t.delimiter=this.guessDelimiter(e,t.skipRows),this.__delimiterPatterns=getDelimiterPatterns(t.delimiter,t.quoteChar));var r,n="|"!=t.delimiter?"|":"#";return e=n+"\n"+e.replace(/\s+$/g,"")+n,r=function(e,t,r){r=r||",";for(var a,i=[[]],o=null;o=e.exec(t);){var s=o[1];s.length&&s!=r&&i.push([]),a=o[2]?o[2].replace(new RegExp('""',"g"),'"'):o[3],i[i.length-1].push(a)}i[0][0].substr(0,1)==n&&(i[0][0]=i[0][0].substr(1));var u=i.length-1,c=i[u].length-1,l=i[u][c].length-1;return i[u][c].substr(l)==n&&(i[u][c]=i[u][c].substr(0,l)),i.slice(1)}(this.__delimiterPatterns,e,t.delimiter),t.transpose&&(r=function(e){var t=e,r=t.length?t.length:0,n=t[0]instanceof Array?t[0].length:0;if(0===n||0===r)return[];var a,i,o=[];for(a=0;a<n;a++)for(o[a]=[],i=0;i<r;i++)o[a][i]=t[i][a];return o}(r)),function(e){var r=[],n={},a=e.length,i=e[0].length,o=t.skipRows,s=[];t.firstRowIsHeader&&(s=e[o],o++);for(var u=0;u<i;u++){var c=_isString(s[u])?s[u].replace(/^\s+|\s+$/g,""):"",l=""!==c?"":1;for(c=""!==c?c:"X.";void 0!==n[c+l];)l=""===l?1:l+1;r.push({name:c+l,data:[]}),n[c+l]=!0}return _range(o,a).forEach(function(n){r.forEach(function(r,a){r.data.push(""!==e[n][a]?e[n][a]:t.emptyValue)})}),dataset(r=r.map(function(e){return column(e.name,e.data)}))}(r)},DelimitedParser.prototype.guessDelimiter=function(e){var t=0,r=-1,n=this,a=["\t",";","|",","];return a.forEach(function(a,i){var o=getDelimiterPatterns(a,n.quoteChar),s=e.match(o).length;"\t"==a&&(s*=1.15),s>t&&(t=s,r=i)}),a[r]};var storeChanges=_debounce(function(e,t){var r=e.serialize();putJSON("/api/2/charts/"+r.id,JSON.stringify(r),function(){t&&t()})},1e3),storeData=_debounce(function(e,t){var r=e.getMetadata("data.json")?JSON.stringify(e.dataset()):e.rawData();putJSON("/api/2/charts/"+e.get("id")+"/data",r,function(){t&&t()})},1e3),Chart$1=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(e,t){var r=this,n={firstRowIsHeader:this.getMetadata("data.horizontal-header",!0),transpose:this.getMetadata("data.transpose",!1)};return e&&!t?n.csv=e:n.url=t||"data.csv",n.csv&&(this._rawData=n.csv),(this.getMetadata("data.json",!1)?json(n):delimited(n)).dataset().then(function(e){return r.dataset(e),e}).catch(function(e){console.log("nope",e)})},t.prototype.dataset=function(e){if(arguments.length){!0!==e&&(this._dataset_cache=e);var t="function"!=typeof e.list;return this._dataset=t?e:reorderColumns(this,applyChanges(this,addComputedColumns(this,!0===e?this._dataset_cache:e))),t&&this.set({dataset:e}),this._dataset}return this._dataset},t.prototype.theme=function(e){return arguments.length?(this.set({theme:e}),this):this.get().theme},t.prototype.vis=function(e){return arguments.length?(this.set({vis:e}),this):this.get().vis},t.prototype.locale=function(e,t){return arguments.length&&(this._locale=e=e.replace("_","-"),window.Globalize&&loadGlobalizeLocale(e,t)),this._locale},t.prototype.getMetadata=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=this.get().metadata;if(!e)return r;var n=r;return _some(e.split("."),function(e){return!(!_isUndefined(n)&&!_isNull(n))||(n=n[e],!1)}),_isUndefined(n)||_isNull(n)?t:n},t.prototype.setMetadata=function(e,t){var r=e.split("."),n=r.pop(),a=this.get().metadata,i=a;return r.forEach(function(e){(_isUndefined(i[e])||_isNull(i[e]))&&(i[e]={}),i=i[e]}),is_equal(i[n],t)||(i[n]=t,this.set({metadata:a})),this},t.prototype.store=function(e){storeChanges(this,e)},t.prototype.storeData=function(e){storeData(this,e)},t.prototype.serialize=function(){var e=this.get(),t={};return["id","title","theme","createdAt","lastModifiedAt","type","metadata","authorId","showInGallery","language","guestSession","lastEditStep","publishedAt","publicUrl","publicVersion","organizationId","forkedFrom","externalData","forkable","isFork","inFolder","author"].forEach(function(r){t[r]=e[r]}),t},t.prototype.passiveMode=function(){var e=this;this.set({passiveMode:!0}),setTimeout(function(){return e.set({passiveMode:!1})},100)},t.prototype.isPassive=function(){return this.get().passiveMode},t.prototype.rawData=function(){return this._rawData},t}(Store);function is_equal(e,t){return JSON.stringify(e)==JSON.stringify(t)}Chart$1.prototype.observeDeep=observeDeep;var data$1={},main={App:ChartEditor,Chart:Chart$1,data:data$1};return main});
