!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("svelte/editor",t):e.editor=t()}(this,function(){"use strict";function noop(){}function assign(e,t){for(var r in t)e[r]=t[r];return e}function insertNode(e,t,r){t.insertBefore(e,r)}function detachNode(e){e.parentNode.removeChild(e)}function createElement(e){return document.createElement(e)}function createText(e){return document.createTextNode(e)}function blankObject(){return Object.create(null)}function destroy(e){this.destroy=noop,this.fire("destroy"),this.set=this.get=noop,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function _differs(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function fire(e,t){var r=e in this._handlers&&this._handlers[e].slice();if(r)for(var n=0;n<r.length;n+=1){var o=r[n];o.__calling||(o.__calling=!0,o.call(this,t),o.__calling=!1)}}function get(e){return e?this._state[e]:this._state}function init(e,t){e._handlers=blankObject(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function observe(e,t,r){var n=t.bind(this);return r&&!1===r.init||n(this.get()[e],void 0),this.on(r&&r.defer?"update":"state",function(t){t.changed[e]&&n(t.current[e],t.previous&&t.previous[e])})}function on(e,t){if("teardown"===e)return this.on("destroy",t);var r=this._handlers[e]||(this._handlers[e]=[]);return r.push(t),{cancel:function(){var e=r.indexOf(t);~e&&r.splice(e,1)}}}function set(e){this._set(assign({},e)),this.root._lock||(this.root._lock=!0,callAll(this.root._beforecreate),callAll(this.root._oncreate),callAll(this.root._aftercreate),this.root._lock=!1)}function _set(e){var t=this._state,r={},n=!1;for(var o in e)this._differs(e[o],t[o])&&(r[o]=n=!0);n&&(this._state=assign(assign({},t),e),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:t}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:t})))}function callAll(e){for(;e&&e.length;)e.shift()()}function _mount(e,t){this._fragment[this._fragment.i?"i":"m"](e,t||null)}function _unmount(){this._fragment&&this._fragment.u()}function removeFromStore(){this.store._remove(this)}var proto={destroy:destroy,get:get,fire:fire,observe:observe,on:on,set:set,teardown:destroy,_recompute:noop,_set:_set,_mount:_mount,_unmount:_unmount,_differs:_differs},dw=window.dw;function __(e,t){var r=arguments;if(void 0===t&&(t="core"),e=e.trim(),!dw.backend.__messages[t])return"MISSING:"+e;var n=dw.backend.__messages[t][e]||dw.backend.__messages.core[e]||e;if(arguments.length>2)for(var o=2;o<arguments.length;o++){var a=o-1;n=n.replace("$"+a,r[o])}return n}var EditorNav="./EditorNav.html",PublishSidebar="../publish/PublishSidebar.html";function data(){return{datasets:[],steps:[{id:"upload",title:__("Upload Data")},{id:"describe",title:__("Check & Describe")},{id:"visualize",title:__("Visualize")},{id:"publish",title:__("Publish & Embed")}]}}function oncreate(){}function create_main_fragment(e,t){var r,n,o={},a={};"step"in t&&(a.active=t.step,o.active=!0),"maxStep"in t&&(a.maxStep=t.maxStep,o.maxStep=!0),"steps"in t&&(a.steps=t.steps,o.steps=!0),"$chart"in t&&(a.chart=t.$chart,o.chart=!0);var i=new EditorNav({root:e.root,data:a,_bind:function(t,r){e.get();var n={},a={};!o.active&&t.active&&(n.step=r.active),!o.maxStep&&t.maxStep&&(n.maxStep=r.maxStep),!o.steps&&t.steps&&(n.steps=r.steps),!o.chart&&t.chart&&(a.chart=r.chart),e.store.set(a),e._set(n),o={}}});function u(e){return"upload"==e.step?create_if_block:"describe"==e.step?create_if_block_1:"visualize"==e.step?create_if_block_2:"publish"==e.step?create_if_block_3:create_if_block_4}e.root._beforecreate.push(function(){i._bind({active:1,maxStep:1,steps:1,chart:1},i.get())});var s=u(t),c=s(e,t);return{c:function(){i._fragment.c(),r=createText("\n\n"),n=createElement("div"),c.c()},m:function(e,t){i._mount(e,t),insertNode(r,e,t),insertNode(n,e,t),c.m(n,null)},p:function(t,r){var a={};!o.active&&t.step&&(a.active=r.step,o.active=!0),!o.maxStep&&t.maxStep&&(a.maxStep=r.maxStep,o.maxStep=!0),!o.steps&&t.steps&&(a.steps=r.steps,o.steps=!0),!o.chart&&t.$chart&&(a.chart=r.$chart,o.chart=!0),i._set(a),o={},s!==(s=u(r))&&(c.u(),c.d(),(c=s(e,r)).c(),c.m(n,null))},u:function(){i._unmount(),detachNode(r),detachNode(n),c.u()},d:function(){i.destroy(!1),c.d()}}}function create_if_block(e,t){var r;return{c:function(){r=createText("UPLOAD")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_1(e,t){var r;return{c:function(){r=createText("DESCRIBE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_2(e,t){var r;return{c:function(){r=createText("VISUALIZE")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function create_if_block_3(e,t){var r=new PublishSidebar({root:e.root});return{c:function(){r._fragment.c()},m:function(e,t){r._mount(e,t)},u:function(){r._unmount()},d:function(){r.destroy(!1)}}}function create_if_block_4(e,t){var r;return{c:function(){r=createText(":(")},m:function(e,t){insertNode(r,e,t)},u:function(){detachNode(r)},d:noop}}function ChartEditor(e){init(this,e),this._state=assign(assign(this.store._init(["chart"]),data()),e.data),this.store._add(this,["chart"]),this._handlers.destroy=[removeFromStore];var t=this;e.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=create_main_fragment(this,this._state),this.root._oncreate.push(function(){oncreate.call(t),t.fire("update",{changed:{step:1,maxStep:1,steps:1,$chart:1},current:t._state})}),e.target&&(this._fragment.c(),this._mount(e.target,e.anchor),this._lock=!0,callAll(this._beforecreate),callAll(this._oncreate),callAll(this._aftercreate),this._lock=!1)}function assign$1(e,t){for(var r in t)e[r]=t[r];return e}function blankObject$1(){return Object.create(null)}function _differs$1(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function _differsImmutable$1(e,t){return e!=e?t==t:e!==t}function fire$1(e,t){var r=e in this._handlers&&this._handlers[e].slice();if(r)for(var n=0;n<r.length;n+=1){var o=r[n];if(!o.__calling)try{o.__calling=!0,o.call(this,t)}finally{o.__calling=!1}}}function get$1(){return this._state}function on$1(e,t){var r=this._handlers[e]||(this._handlers[e]=[]);return r.push(t),{cancel:function(){var e=r.indexOf(t);~e&&r.splice(e,1)}}}function Store(e,t){this._handlers={},this._dependents=[],this._computed=blankObject$1(),this._sortedComputedProperties=[],this._state=assign$1({},e),this._differs=t&&t.immutable?_differsImmutable$1:_differs$1}function getNestedValue(e,t){for(var r=0;r<t.length;r+=1){if(!e)return;e=e[t[r]]}return e}function observeDeep(e,t,r){var n=e.replace(/\[(\d+)\]/g,".$1").split("."),o=n[0],a=t.bind(this),i=getNestedValue(this.get(),n);return r&&!1===r.init||a(i),this.on(r&&r.defer?"update":"state",function(e){var t=e.changed,r=e.current;e.previous;if(t[o]){var u=getNestedValue(r,n);u===i&&"object"!=typeof u&&"function"!=typeof u||(a(u,i),i=u)}})}assign(ChartEditor.prototype,proto),assign$1(Store.prototype,{_add:function(e,t){this._dependents.push({component:e,props:t})},_init:function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r];t["$"+n]=this._state[n]}return t},_remove:function(e){for(var t=this._dependents.length;t--;)if(this._dependents[t].component===e)return void this._dependents.splice(t,1)},_set:function(e,t){var r=this,n=this._state;this._state=assign$1(assign$1({},n),e);for(var o=0;o<this._sortedComputedProperties.length;o+=1)r._sortedComputedProperties[o].update(r._state,t);this.fire("state",{changed:t,previous:n,current:this._state}),this._dependents.filter(function(e){for(var n={},o=!1,a=0;a<e.props.length;a+=1){var i=e.props[a];i in t&&(n["$"+i]=r._state[i],o=!0)}if(o)return e.component._stage(n),!0}).forEach(function(e){e.component.set({})}),this.fire("update",{changed:t,previous:n,current:this._state})},_sortComputedProperties:function(){var e,t=this._computed,r=this._sortedComputedProperties=[],n=blankObject$1();function o(a){var i=t[a];i&&(i.deps.forEach(function(t){if(t===e)throw new Error("Cyclical dependency detected between "+t+" <-> "+a);o(t)}),n[a]||(n[a]=!0,r.push(i)))}for(var a in this._computed)o(e=a)},compute:function(e,t,r){var n,o=this,a={deps:t,update:function(a,i,u){var s=t.map(function(e){return e in i&&(u=!0),a[e]});if(u){var c=r.apply(null,s);o._differs(c,n)&&(n=c,i[e]=!0,a[e]=n)}}};this._computed[e]=a,this._sortComputedProperties();var i=assign$1({},this._state),u={};a.update(i,u,!0),this._set(i,u)},fire:fire$1,get:get$1,on:on$1,set:function(e){var t=this._state,r=this._changed={},n=!1;for(var o in e){if(this._computed[o])throw new Error("'"+o+"' is a read-only computed property");this._differs(e[o],t[o])&&(r[o]=n=!0)}n&&this._set(e,r)}});var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var underscore=createCommonjsModule(function(e,t){!function(){var r="object"==typeof self&&self.self===self&&self||"object"==typeof commonjsGlobal&&commonjsGlobal.global===commonjsGlobal&&commonjsGlobal||this||{},n=r._,o=Array.prototype,a=Object.prototype,i="undefined"!=typeof Symbol?Symbol.prototype:null,u=o.push,s=o.slice,c=a.toString,l=a.hasOwnProperty,f=Array.isArray,p=Object.keys,d=Object.create,h=function(){},m=function(e){return e instanceof m?e:this instanceof m?void(this._wrapped=e):new m(e)};t.nodeType?r._=m:(!e.nodeType&&e.exports&&(t=e.exports=m),t._=m),m.VERSION="1.9.1";var v,g=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,o){return e.call(t,r,n,o)};case 4:return function(r,n,o,a){return e.call(t,r,n,o,a)}}return function(){return e.apply(t,arguments)}},Y=function(e,t,r){return m.iteratee!==v?m.iteratee(e,t):null==e?m.identity:m.isFunction(e)?g(e,t,r):m.isObject(e)&&!m.isArray(e)?m.matcher(e):m.property(e)};m.iteratee=v=function(e,t){return Y(e,t,1/0)};var y=function(e,t){return t=null==t?e.length-1:+t,function(){for(var r=arguments,n=Math.max(arguments.length-t,0),o=Array(n),a=0;a<n;a++)o[a]=r[a+t];switch(t){case 0:return e.call(this,o);case 1:return e.call(this,arguments[0],o);case 2:return e.call(this,arguments[0],arguments[1],o)}var i=Array(t+1);for(a=0;a<t;a++)i[a]=r[a];return i[t]=o,e.apply(this,i)}},_=function(e){if(!m.isObject(e))return{};if(d)return d(e);h.prototype=e;var t=new h;return h.prototype=null,t},M=function(e){return function(t){return null==t?void 0:t[e]}},b=function(e,t){return null!=e&&l.call(e,t)},x=function(e,t){for(var r=t.length,n=0;n<r;n++){if(null==e)return;e=e[t[n]]}return r?e:void 0},w=Math.pow(2,53)-1,D=M("length"),N=function(e){var t=D(e);return"number"==typeof t&&t>=0&&t<=w};m.each=m.forEach=function(e,t,r){var n,o;if(t=g(t,r),N(e))for(n=0,o=e.length;n<o;n++)t(e[n],n,e);else{var a=m.keys(e);for(n=0,o=a.length;n<o;n++)t(e[a[n]],a[n],e)}return e},m.map=m.collect=function(e,t,r){t=Y(t,r);for(var n=!N(e)&&m.keys(e),o=(n||e).length,a=Array(o),i=0;i<o;i++){var u=n?n[i]:i;a[i]=t(e[u],u,e)}return a};var S=function(e){return function(t,r,n,o){var a=arguments.length>=3;return function(t,r,n,o){var a=!N(t)&&m.keys(t),i=(a||t).length,u=e>0?0:i-1;for(o||(n=t[a?a[u]:u],u+=e);u>=0&&u<i;u+=e){var s=a?a[u]:u;n=r(n,t[s],s,t)}return n}(t,g(r,o,4),n,a)}};m.reduce=m.foldl=m.inject=S(1),m.reduceRight=m.foldr=S(-1),m.find=m.detect=function(e,t,r){var n=(N(e)?m.findIndex:m.findKey)(e,t,r);if(void 0!==n&&-1!==n)return e[n]},m.filter=m.select=function(e,t,r){var n=[];return t=Y(t,r),m.each(e,function(e,r,o){t(e,r,o)&&n.push(e)}),n},m.reject=function(e,t,r){return m.filter(e,m.negate(Y(t)),r)},m.every=m.all=function(e,t,r){t=Y(t,r);for(var n=!N(e)&&m.keys(e),o=(n||e).length,a=0;a<o;a++){var i=n?n[a]:a;if(!t(e[i],i,e))return!1}return!0},m.some=m.any=function(e,t,r){t=Y(t,r);for(var n=!N(e)&&m.keys(e),o=(n||e).length,a=0;a<o;a++){var i=n?n[a]:a;if(t(e[i],i,e))return!0}return!1},m.contains=m.includes=m.include=function(e,t,r,n){return N(e)||(e=m.values(e)),("number"!=typeof r||n)&&(r=0),m.indexOf(e,t,r)>=0},m.invoke=y(function(e,t,r){var n,o;return m.isFunction(t)?o=t:m.isArray(t)&&(n=t.slice(0,-1),t=t[t.length-1]),m.map(e,function(e){var a=o;if(!a){if(n&&n.length&&(e=x(e,n)),null==e)return;a=e[t]}return null==a?a:a.apply(e,r)})}),m.pluck=function(e,t){return m.map(e,m.property(t))},m.where=function(e,t){return m.filter(e,m.matcher(t))},m.findWhere=function(e,t){return m.find(e,m.matcher(t))},m.max=function(e,t,r){var n,o,a=-1/0,i=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var u=0,s=(e=N(e)?e:m.values(e)).length;u<s;u++)null!=(n=e[u])&&n>a&&(a=n);else t=Y(t,r),m.each(e,function(e,r,n){((o=t(e,r,n))>i||o===-1/0&&a===-1/0)&&(a=e,i=o)});return a},m.min=function(e,t,r){var n,o,a=1/0,i=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var u=0,s=(e=N(e)?e:m.values(e)).length;u<s;u++)null!=(n=e[u])&&n<a&&(a=n);else t=Y(t,r),m.each(e,function(e,r,n){((o=t(e,r,n))<i||o===1/0&&a===1/0)&&(a=e,i=o)});return a},m.shuffle=function(e){return m.sample(e,1/0)},m.sample=function(e,t,r){if(null==t||r)return N(e)||(e=m.values(e)),e[m.random(e.length-1)];var n=N(e)?m.clone(e):m.values(e),o=D(n);t=Math.max(Math.min(t,o),0);for(var a=o-1,i=0;i<t;i++){var u=m.random(i,a),s=n[i];n[i]=n[u],n[u]=s}return n.slice(0,t)},m.sortBy=function(e,t,r){var n=0;return t=Y(t,r),m.pluck(m.map(e,function(e,r,o){return{value:e,index:n++,criteria:t(e,r,o)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")};var j=function(e,t){return function(r,n,o){var a=t?[[],[]]:{};return n=Y(n,o),m.each(r,function(t,o){var i=n(t,o,r);e(a,t,i)}),a}};m.groupBy=j(function(e,t,r){b(e,r)?e[r].push(t):e[r]=[t]}),m.indexBy=j(function(e,t,r){e[r]=t}),m.countBy=j(function(e,t,r){b(e,r)?e[r]++:e[r]=1});var k=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;m.toArray=function(e){return e?m.isArray(e)?s.call(e):m.isString(e)?e.match(k):N(e)?m.map(e,m.identity):m.values(e):[]},m.size=function(e){return null==e?0:N(e)?e.length:m.keys(e).length},m.partition=j(function(e,t,r){e[r?0:1].push(t)},!0),m.first=m.head=m.take=function(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[0]:m.initial(e,e.length-t)},m.initial=function(e,t,r){return s.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))},m.last=function(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[e.length-1]:m.rest(e,Math.max(0,e.length-t))},m.rest=m.tail=m.drop=function(e,t,r){return s.call(e,null==t||r?1:t)},m.compact=function(e){return m.filter(e,Boolean)};var O=function(e,t,r,n){for(var o=(n=n||[]).length,a=0,i=D(e);a<i;a++){var u=e[a];if(N(u)&&(m.isArray(u)||m.isArguments(u)))if(t)for(var s=0,c=u.length;s<c;)n[o++]=u[s++];else O(u,t,r,n),o=n.length;else r||(n[o++]=u)}return n};m.flatten=function(e,t){return O(e,t,!1)},m.without=y(function(e,t){return m.difference(e,t)}),m.uniq=m.unique=function(e,t,r,n){m.isBoolean(t)||(n=r,r=t,t=!1),null!=r&&(r=Y(r,n));for(var o=[],a=[],i=0,u=D(e);i<u;i++){var s=e[i],c=r?r(s,i,e):s;t&&!r?(i&&a===c||o.push(s),a=c):r?m.contains(a,c)||(a.push(c),o.push(s)):m.contains(o,s)||o.push(s)}return o},m.union=y(function(e){return m.uniq(O(e,!0,!0))}),m.intersection=function(e){for(var t=arguments,r=[],n=arguments.length,o=0,a=D(e);o<a;o++){var i=e[o];if(!m.contains(r,i)){var u;for(u=1;u<n&&m.contains(t[u],i);u++);u===n&&r.push(i)}}return r},m.difference=y(function(e,t){return t=O(t,!0,!0),m.filter(e,function(e){return!m.contains(t,e)})}),m.unzip=function(e){for(var t=e&&m.max(e,D).length||0,r=Array(t),n=0;n<t;n++)r[n]=m.pluck(e,n);return r},m.zip=y(m.unzip),m.object=function(e,t){for(var r={},n=0,o=D(e);n<o;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r};var A=function(e){return function(t,r,n){r=Y(r,n);for(var o=D(t),a=e>0?0:o-1;a>=0&&a<o;a+=e)if(r(t[a],a,t))return a;return-1}};m.findIndex=A(1),m.findLastIndex=A(-1),m.sortedIndex=function(e,t,r,n){for(var o=(r=Y(r,n,1))(t),a=0,i=D(e);a<i;){var u=Math.floor((a+i)/2);r(e[u])<o?a=u+1:i=u}return a};var C=function(e,t,r){return function(n,o,a){var i=0,u=D(n);if("number"==typeof a)e>0?i=a>=0?a:Math.max(a+u,i):u=a>=0?Math.min(a+1,u):a+u+1;else if(r&&a&&u)return n[a=r(n,o)]===o?a:-1;if(o!=o)return(a=t(s.call(n,i,u),m.isNaN))>=0?a+i:-1;for(a=e>0?i:u-1;a>=0&&a<u;a+=e)if(n[a]===o)return a;return-1}};m.indexOf=C(1,m.findIndex,m.sortedIndex),m.lastIndexOf=C(-1,m.findLastIndex),m.range=function(e,t,r){null==t&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),o=Array(n),a=0;a<n;a++,e+=r)o[a]=e;return o},m.chunk=function(e,t){if(null==t||t<1)return[];for(var r=[],n=0,o=e.length;n<o;)r.push(s.call(e,n,n+=t));return r};var T=function(e,t,r,n,o){if(!(n instanceof t))return e.apply(r,o);var a=_(e.prototype),i=e.apply(a,o);return m.isObject(i)?i:a};m.bind=y(function(e,t,r){if(!m.isFunction(e))throw new TypeError("Bind must be called on a function");var n=y(function(o){return T(e,n,t,this,r.concat(o))});return n}),m.partial=y(function(e,t){var r=m.partial.placeholder,n=function(){for(var o=arguments,a=0,i=t.length,u=Array(i),s=0;s<i;s++)u[s]=t[s]===r?o[a++]:t[s];for(;a<arguments.length;)u.push(o[a++]);return T(e,n,this,this,u)};return n}),m.partial.placeholder=m,m.bindAll=y(function(e,t){var r=(t=O(t,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=t[r];e[n]=m.bind(e[n],e)}}),m.memoize=function(e,t){var r=function(n){var o=r.cache,a=""+(t?t.apply(this,arguments):n);return b(o,a)||(o[a]=e.apply(this,arguments)),o[a]};return r.cache={},r},m.delay=y(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)}),m.defer=m.partial(m.delay,m,1),m.throttle=function(e,t,r){var n,o,a,i,u=0;r||(r={});var s=function(){u=!1===r.leading?0:m.now(),n=null,i=e.apply(o,a),n||(o=a=null)},c=function(){var c=m.now();u||!1!==r.leading||(u=c);var l=t-(c-u);return o=this,a=arguments,l<=0||l>t?(n&&(clearTimeout(n),n=null),u=c,i=e.apply(o,a),n||(o=a=null)):n||!1===r.trailing||(n=setTimeout(s,l)),i};return c.cancel=function(){clearTimeout(n),u=0,n=o=a=null},c},m.debounce=function(e,t,r){var n,o,a=function(t,r){n=null,r&&(o=e.apply(t,r))},i=y(function(i){if(n&&clearTimeout(n),r){var u=!n;n=setTimeout(a,t),u&&(o=e.apply(this,i))}else n=m.delay(a,t,this,i);return o});return i.cancel=function(){clearTimeout(n),n=null},i},m.wrap=function(e,t){return m.partial(t,e)},m.negate=function(e){return function(){return!e.apply(this,arguments)}},m.compose=function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},m.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},m.before=function(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}},m.once=m.partial(m.before,2),m.restArguments=y;var E=!{toString:null}.propertyIsEnumerable("toString"),$=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],H=function(e,t){var r=$.length,n=e.constructor,o=m.isFunction(n)&&n.prototype||a,i="constructor";for(b(e,i)&&!m.contains(t,i)&&t.push(i);r--;)(i=$[r])in e&&e[i]!==o[i]&&!m.contains(t,i)&&t.push(i)};m.keys=function(e){if(!m.isObject(e))return[];if(p)return p(e);var t=[];for(var r in e)b(e,r)&&t.push(r);return E&&H(e,t),t},m.allKeys=function(e){if(!m.isObject(e))return[];var t=[];for(var r in e)t.push(r);return E&&H(e,t),t},m.values=function(e){for(var t=m.keys(e),r=t.length,n=Array(r),o=0;o<r;o++)n[o]=e[t[o]];return n},m.mapObject=function(e,t,r){t=Y(t,r);for(var n=m.keys(e),o=n.length,a={},i=0;i<o;i++){var u=n[i];a[u]=t(e[u],u,e)}return a},m.pairs=function(e){for(var t=m.keys(e),r=t.length,n=Array(r),o=0;o<r;o++)n[o]=[t[o],e[t[o]]];return n},m.invert=function(e){for(var t={},r=m.keys(e),n=0,o=r.length;n<o;n++)t[e[r[n]]]=r[n];return t},m.functions=m.methods=function(e){var t=[];for(var r in e)m.isFunction(e[r])&&t.push(r);return t.sort()};var F=function(e,t){return function(r){var n=arguments,o=arguments.length;if(t&&(r=Object(r)),o<2||null==r)return r;for(var a=1;a<o;a++)for(var i=n[a],u=e(i),s=u.length,c=0;c<s;c++){var l=u[c];t&&void 0!==r[l]||(r[l]=i[l])}return r}};m.extend=F(m.allKeys),m.extendOwn=m.assign=F(m.keys),m.findKey=function(e,t,r){t=Y(t,r);for(var n,o=m.keys(e),a=0,i=o.length;a<i;a++)if(t(e[n=o[a]],n,e))return n};var z,P,I=function(e,t,r){return t in r};m.pick=y(function(e,t){var r={},n=t[0];if(null==e)return r;m.isFunction(n)?(t.length>1&&(n=g(n,t[1])),t=m.allKeys(e)):(n=I,t=O(t,!1,!1),e=Object(e));for(var o=0,a=t.length;o<a;o++){var i=t[o],u=e[i];n(u,i,e)&&(r[i]=u)}return r}),m.omit=y(function(e,t){var r,n=t[0];return m.isFunction(n)?(n=m.negate(n),t.length>1&&(r=t[1])):(t=m.map(O(t,!1,!1),String),n=function(e,r){return!m.contains(t,r)}),m.pick(e,n,r)}),m.defaults=F(m.allKeys,!0),m.create=function(e,t){var r=_(e);return t&&m.extendOwn(r,t),r},m.clone=function(e){return m.isObject(e)?m.isArray(e)?e.slice():m.extend({},e):e},m.tap=function(e,t){return t(e),e},m.isMatch=function(e,t){var r=m.keys(t),n=r.length;if(null==e)return!n;for(var o=Object(e),a=0;a<n;a++){var i=r[a];if(t[i]!==o[i]||!(i in o))return!1}return!0},z=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&P(e,t,r,n)},P=function(e,t,r,n){e instanceof m&&(e=e._wrapped),t instanceof m&&(t=t._wrapped);var o=c.call(e);if(o!==c.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return i.valueOf.call(e)===i.valueOf.call(t)}var a="[object Array]"===o;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var u=e.constructor,s=t.constructor;if(u!==s&&!(m.isFunction(u)&&u instanceof u&&m.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],n=n||[];for(var l=r.length;l--;)if(r[l]===e)return n[l]===t;if(r.push(e),n.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!z(e[l],t[l],r,n))return!1}else{var f,p=m.keys(e);if(l=p.length,m.keys(t).length!==l)return!1;for(;l--;)if(f=p[l],!b(t,f)||!z(e[f],t[f],r,n))return!1}return r.pop(),n.pop(),!0},m.isEqual=function(e,t){return z(e,t)},m.isEmpty=function(e){return null==e||(N(e)&&(m.isArray(e)||m.isString(e)||m.isArguments(e))?0===e.length:0===m.keys(e).length)},m.isElement=function(e){return!(!e||1!==e.nodeType)},m.isArray=f||function(e){return"[object Array]"===c.call(e)},m.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},m.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(e){m["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),m.isArguments(arguments)||(m.isArguments=function(e){return b(e,"callee")});var R=r.document&&r.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof R&&(m.isFunction=function(e){return"function"==typeof e||!1}),m.isFinite=function(e){return!m.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},m.isNaN=function(e){return m.isNumber(e)&&isNaN(e)},m.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===c.call(e)},m.isNull=function(e){return null===e},m.isUndefined=function(e){return void 0===e},m.has=function(e,t){if(!m.isArray(t))return b(e,t);for(var r=t.length,n=0;n<r;n++){var o=t[n];if(null==e||!l.call(e,o))return!1;e=e[o]}return!!r},m.noConflict=function(){return r._=n,this},m.identity=function(e){return e},m.constant=function(e){return function(){return e}},m.noop=function(){},m.property=function(e){return m.isArray(e)?function(t){return x(t,e)}:M(e)},m.propertyOf=function(e){return null==e?function(){}:function(t){return m.isArray(t)?x(e,t):e[t]}},m.matcher=m.matches=function(e){return e=m.extendOwn({},e),function(t){return m.isMatch(t,e)}},m.times=function(e,t,r){var n=Array(Math.max(0,e));t=g(t,r,1);for(var o=0;o<e;o++)n[o]=t(o);return n},m.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},m.now=Date.now||function(){return(new Date).getTime()};var W={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},V=m.invert(W),L=function(e){var t=function(t){return e[t]},r="(?:"+m.keys(e).join("|")+")",n=RegExp(r),o=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(o,t):e}};m.escape=L(W),m.unescape=L(V),m.result=function(e,t,r){m.isArray(t)||(t=[t]);var n=t.length;if(!n)return m.isFunction(r)?r.call(e):r;for(var o=0;o<n;o++){var a=null==e?void 0:e[t[o]];void 0===a&&(a=r,o=n),e=m.isFunction(a)?a.call(e):a}return e};var q=0;m.uniqueId=function(e){var t=++q+"";return e?e+t:t},m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var G=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},J=/\\|'|\r|\n|\u2028|\u2029/g,K=function(e){return"\\"+U[e]};m.template=function(e,t,r){!t&&r&&(t=r),t=m.defaults({},t,m.templateSettings);var n,o=RegExp([(t.escape||G).source,(t.interpolate||G).source,(t.evaluate||G).source].join("|")+"|$","g"),a=0,i="__p+='";e.replace(o,function(t,r,n,o,u){return i+=e.slice(a,u).replace(J,K),a=u+t.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?i+="'+\n((__t=("+n+"))==null?'':__t)+\n'":o&&(i+="';\n"+o+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{n=new Function(t.variable||"obj","_",i)}catch(e){throw e.source=i,e}var u=function(e){return n.call(this,e,m)},s=t.variable||"obj";return u.source="function("+s+"){\n"+i+"}",u},m.chain=function(e){var t=m(e);return t._chain=!0,t};var B=function(e,t){return e._chain?m(t).chain():t};m.mixin=function(e){return m.each(m.functions(e),function(t){var r=m[t]=e[t];m.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),B(this,r.apply(m,e))}}),m},m.mixin(m),m.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];m.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!==e&&"splice"!==e||0!==r.length||delete r[0],B(this,r)}}),m.each(["concat","join","slice"],function(e){var t=o[e];m.prototype[e]=function(){return B(this,t.apply(this._wrapped,arguments))}}),m.prototype.value=function(){return this._wrapped},m.prototype.valueOf=m.prototype.toJSON=m.prototype.value,m.prototype.toString=function(){return String(this._wrapped)}}()}),underscore_1=underscore._;function dataset(e){var t={},r=e.slice(0);function n(e){for(var r=e.name(),n=r,o=1;t.hasOwnProperty(n);)n=r+"."+o++;n!==r&&e.name(n)}e.forEach(function(e){n(e),t[e.name()]=e});var o={columns:function(){return e},column:function(r){if(underscore.isString(r)){if(void 0!==t[r])return t[r];throw new Error('No column found with that name: "'+r+'"')}if(!(r<0)){if(void 0!==e[r])return e[r];throw new Error("No column found with that name or index: "+r)}},numColumns:function(){return e.length},numRows:function(){return e[0].length},eachColumn:function(t){e.forEach(t)},hasColumn:function(r){return void 0!==(underscore.isString(r)?t[r]:e[r])},indexOf:function(r){return o.hasColumn(r)?e.indexOf(t[r]):-1},list:function(){return underscore.range(e[0].length).map(function(t){var r={};return e.forEach(function(e){r[e.name()]=e.val(t)}),r})},csv:function(){var t="";return e.forEach(function(e,r){var n=e.title();n.indexOf('"')>-1&&n.replace('"','\\"'),n.indexOf(",")>-1&&(n='"'+n+'"'),t+=(r>0?",":"")+n}),underscore.range(o.numRows()).forEach(function(r){t+="\n",e.forEach(function(e,n){var o=""+("date"===e.type()?e.raw(r):e.val(r));o.indexOf('"')>-1&&o.replace('"','\\"'),o.indexOf(",")>-1&&(o='"'+o+'"'),t+=(n>0?",":"")+o})}),t},toCSV:function(){return this.csv()},filterColumns:function(r){return e=e.filter(function(e){return!r[e.name()]}),underscore.each(r,function(e,r){e&&t[r]&&delete t[r]}),o},eachRow:function(e){var t;for(t=0;t<o.numRows();t++)e(t);return o},add:function(a){return n(a),e.push(a),t[a.name()]=a,r.push(a),o},reset:function(){return e=r.slice(0),t={},e.forEach(function(e){t[e.name()]=e}),o},limitRows:function(t){return e.forEach(function(e){e.limitRows(t)}),o},limitColumns:function(t){return e.length>t&&(e.length=t,r.length=t),o},columnOrder:function(t){return arguments.length?(e.length=0,t.forEach(function(t){e.push(r[t])}),o):e.map(function(e){return r.indexOf(e)})}};return o}function text(){return{parse:underscore.identity,errors:function(){return 0},name:function(){return"text"},formatter:function(){return underscore.identity},isValid:function(){return!0},format:function(){}}}function equalish(e,t){return Math.abs(e-t)<1e-6}function number$1(e){var t,r=0,n={"-.":/^ *[-–—−]?[0-9]*(\.[0-9]+)?(e[+-][0-9]+)?%? *$/,"-,":/^ *[-–—−]?[0-9]*(,[0-9]+)?%? *$/,",.":/^ *[-–—−]?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)?%? *$/,".,":/^ *[-–—−]?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)?%? *$/,"'.":/^ *[-–—−]?[0-9]{1,3}('[0-9]{3})*(\.[0-9]+)?%? *$/},o={"-.":"1234.56","-,":"1234,56",",.":"1,234.56",".,":"1.234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"},a={na:1,"n/a":1,"-":1,":":1},i={},u=["-.",0];e=e||[],underscore.each(e,function(e){underscore.each(n,function(t,r){void 0===i[r]&&(i[r]=0),t.test(e)&&(i[r]+=1,i[r]>u[1]&&(u[0]=r,u[1]=i[r]))})}),t=u[0];var s={parse:function(e){if(underscore.isNumber(e)||underscore.isUndefined(e)||underscore.isNull(e))return e;var n=e.replace("%","").replace("−","-").replace("–","-").replace("—","-");return"-"!==t[0]&&(n=n.replace(new RegExp("."===t[0]?"\\.":t[0],"g"),"")),"."!==t[1]&&(n=n.replace(t[1],".")),isNaN(n)||""===n?(a[n.toLowerCase()]||""===n||r++,e):Number(n)},toNum:function(e){return e},fromNum:function(e){return e},errors:function(){return r},name:function(){return"number"},formatter:function(e){var t=e["number-format"]||"-",r=Number(e["number-divisor"]||0),n=(e["number-append"]||"").replace(/ /g," "),o=(e["number-prepend"]||"").replace(/ /g," ");return function(e,a,i){if(isNaN(e))return e;var u=t;if(0!==r&&"-"===u&&(u="n1"),0!==r&&(e=Number(e)/Math.pow(10,r)),"s"===u.substr(0,1)){var s=+u.substr(1);u="n"+Math.max(0,function(e,t){return 0===e?0:Math.round(t-Math.ceil(Math.log(Math.abs(e))/Math.LN10))}(e,s))}return i&&(u="n0"),"-"===u&&(u=equalish(e,Math.round(e))?"n0":equalish(e,.1*Math.round(10*e))?"n1":equalish(e,.01*Math.round(100*e))?"n2":equalish(e,.001*Math.round(1e3*e))?"n3":equalish(e,1e-4*Math.round(1e4*e))?"n4":equalish(e,1e-5*Math.round(1e5*e))?"n5":"n6"),e=Globalize.format(e,"-"!==u?u:null),a?o+e+n:e}},isValid:function(e){return""===e||a[String(e).toLowerCase()]||underscore.isNumber(s.parse(e))},ambiguousFormats:function(){var e=[];return underscore.each(i,function(t,r){t===u[1]&&e.push([r,o[r]])}),e},format:function(e){return arguments.length?(t=e,s):t}};return s}var begin=/^ */.source,end=/[*']* *$/.source,s0=/[ \-/.]?/.source,s1=/[ \-/.]/.source,s2=/[ \-/.;]/.source,s3=/[ \-|T]/.source,sM=/[ \-/.m]/.source,rx={YY:{parse:/['’‘]?(\d{2})/},YYYY:{test:/([12]\d{3})/,parse:/(\d{4})/},YYYY2:{test:/(?:1[7-9]|20)\d{2}/,parse:/(\d{4})/},H:{parse:/h([12])/},Q:{parse:/q([1234])/},W:{parse:/w([0-5]?[0-9])/},MM:{test:/(0?[1-9]|1[0-2])/,parse:/(0?[1-9]|1[0-2])/},DD:{parse:/(0?[1-9]|[1-2][0-9]|3[01])/},DOW:{parse:/([0-7])/},HHMM:{parse:/(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *(am|pm)?/}},MONTHS={0:["jan","january","januar","jänner","jän","janv","janvier","ene","enero","gen","gennaio","janeiro"],1:["feb","february","febr","februar","fév","févr","février","febrero","febbraio","fev","fevereiro"],2:["mar","mär","march","mrz","märz","mars","mars","marzo","marzo","março"],3:["apr","april","apr","april","avr","avril","abr","abril","aprile"],4:["may","mai","mayo","mag","maggio","maio","maj"],5:["jun","june","juni","juin","junio","giu","giugno","junho"],6:["jul","july","juli","juil","juillet","julio","lug","luglio","julho"],7:["aug","august","août","ago","agosto"],8:["sep","september","sept","septembre","septiembre","set","settembre","setembro"],9:["oct","october","okt","oktober","octobre","octubre","ott","ottobre","out","outubro"],10:["nov","november","november","novembre","noviembre","novembre","novembro"],11:["dec","december","dez","des","dezember","déc","décembre","dic","diciembre","dicembre","desember","dezembro"]},shortMonthKey={};underscore.each(MONTHS,function(e,t){underscore.each(e,function(e){shortMonthKey[e]=t})}),rx.MMM={parse:new RegExp("("+underscore.flatten(underscore.values(MONTHS)).join("|")+")")},underscore.each(rx,function(e){e.parse=e.parse.source,underscore.isRegExp(e.test)?e.test=e.test.source:e.test=e.parse});var knownFormats={YYYY:{test:reg(rx.YYYY2.test),parse:reg(rx.YYYY2.parse),precision:"year"},"YYYY-H":{test:reg(rx.YYYY.test,s0,rx.H.test),parse:reg(rx.YYYY.parse,s0,rx.H.parse),precision:"half"},"H-YYYY":{test:reg(rx.H.test,s1,rx.YYYY.test),parse:reg(rx.H.parse,s1,rx.YYYY.parse),precision:"half"},"YYYY-Q":{test:reg(rx.YYYY.test,s0,rx.Q.test),parse:reg(rx.YYYY.parse,s0,rx.Q.parse),precision:"quarter"},"Q-YYYY":{test:reg(rx.Q.test,s1,rx.YYYY.test),parse:reg(rx.Q.parse,s1,rx.YYYY.parse),precision:"quarter"},"YYYY-M":{test:reg(rx.YYYY.test,sM,rx.MM.test),parse:reg(rx.YYYY.parse,sM,rx.MM.parse),precision:"month"},"M-YYYY":{test:reg(rx.MM.test,s1,rx.YYYY.test),parse:reg(rx.MM.parse,s1,rx.YYYY.parse),precision:"month"},"YYYY-MMM":{test:reg(rx.YYYY.test,s1,rx.MMM.parse),parse:reg(rx.YYYY.parse,s1,rx.MMM.parse),precision:"month"},"MMM-YYYY":{test:reg(rx.MMM.parse,s1,rx.YYYY.test),parse:reg(rx.MMM.parse,s1,rx.YYYY.parse),precision:"month"},"MMM-YY":{test:reg(rx.MMM.parse,s1,rx.YY.test),parse:reg(rx.MMM.parse,s1,rx.YY.parse),precision:"month"},MMM:{test:reg(rx.MMM.parse),parse:reg(rx.MMM.parse),precision:"month"},"YYYY-WW":{test:reg(rx.YYYY.test,s0,rx.W.test),parse:reg(rx.YYYY.parse,s0,rx.W.parse),precision:"week"},"WW-YYYY":{test:reg(rx.W.test,s1,rx.YYYY.test),parse:reg(rx.W.parse,s1,rx.YYYY.parse),precision:"week"},"MM/DD/YYYY":{test:reg(rx.MM.test,"([\\-\\/])",rx.DD.test,"\\2",rx.YYYY.test),parse:reg(rx.MM.parse,"([\\-\\/])",rx.DD.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MM/YYYY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.YYYY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MMM/YYYY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MMM.test,"\\2",rx.YYYY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MMM.parse,"\\2",rx.YYYY.parse),precision:"day"},"DD/MMM/YY":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MMM.test,"\\2",rx.YY.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MMM.parse,"\\2",rx.YY.parse),precision:"day"},"YYYY-MM-DD":{test:reg(rx.YYYY.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.DD.test),parse:reg(rx.YYYY.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.DD.parse),precision:"day"},"MMM-DD-YYYY":{test:reg(rx.MMM.test,s1,rx.DD.test,s2,rx.YYYY.test),parse:reg(rx.MMM.parse,s1,rx.DD.parse,s2,rx.YYYY.parse),precision:"day"},"YYYY-WW-d":{test:reg(rx.YYYY.test,s0,rx.W.test,s1,rx.DOW.test),parse:reg(rx.YYYY.parse,s0,rx.W.parse,s1,rx.DOW.parse),precision:"day"},"MM/DD/YYYY HH:MM":{test:reg(rx.MM.test,"([\\-\\/])",rx.DD.test,"\\2",rx.YYYY.test,s3,rx.HHMM.test),parse:reg(rx.MM.parse,"([\\-\\/])",rx.DD.parse,"\\2",rx.YYYY.parse,s3,rx.HHMM.parse),precision:"day-minutes"},"DD.MM.YYYY HH:MM":{test:reg(rx.DD.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.YYYY.test,s3,rx.HHMM.test),parse:reg(rx.DD.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.YYYY.parse,s3,rx.HHMM.parse),precision:"day-minutes"},"YYYY-MM-DD HH:MM":{test:reg(rx.YYYY.test,"([\\-\\.\\/ ?])",rx.MM.test,"\\2",rx.DD.test,s3,rx.HHMM.test),parse:reg(rx.YYYY.parse,"([\\-\\.\\/ ?])",rx.MM.parse,"\\2",rx.DD.parse,s3,rx.HHMM.parse),precision:"day-minutes"},ISO8601:{test:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,parse:function(e){return e},precision:"day-seconds"}};function reg(){return new RegExp(begin+Array.prototype.slice.call(arguments).join(" *")+end,"i")}function test(e,t){var r=knownFormats[t];return underscore.isRegExp(r.test)?r.test.test(e):r.test(e,t)}function parse(e,t){var r=knownFormats[t];return underscore.isRegExp(r.parse)?e.match(r.parse):r.parse(e,t)}function dateFromIsoWeek(e,t,r){var n=new Date(Date.UTC(e,0,3));return n.setUTCDate(3-n.getUTCDay()+7*(t-1)+parseInt(r,10)),n}function dateToIsoWeek(e){var t=e.getUTCDay(),r=new Date(e.valueOf());r.setDate(r.getDate()-(t+6)%7+3);var n=r.getUTCFullYear(),o=Math.floor((r.getTime()-new Date(n,0,1,-6))/864e5);return[n,1+Math.floor(o/7),t>0?t:7]}function hour(e,t){return 12!==e?e+("pm"===t?12:0):"am"===t?0:12}function date$1(e){var t,r=0,n={},o=["",0];e=e||[],underscore.each(knownFormats,function(t,r){underscore.each(e,function(e){void 0===n[r]&&(n[r]=0),test(e,r)&&(n[r]+=1,n[r]>o[1]&&(o[0]=r,o[1]=n[r]))})}),t=o[0];var a={parse:function(e){if(underscore.isDate(e)||underscore.isUndefined(e))return e;if(!t||!underscore.isString(e))return r++,e;var n=parse(e.toLowerCase(),t);if(!n)return r++,e;function o(e){return(e=+e)<30?2e3+e:1900+e}test(e,t)||r++;var a=(new Date).getFullYear();switch(t){case"YYYY":return new Date(n[1],0,1);case"YYYY-H":return new Date(n[1],6*(n[2]-1),1);case"H-YYYY":return new Date(n[2],6*(n[1]-1),1);case"YYYY-Q":return new Date(n[1],3*(n[2]-1),1);case"Q-YYYY":return new Date(n[2],3*(n[1]-1),1);case"YYYY-M":return new Date(n[1],n[2]-1,1);case"M-YYYY":return new Date(n[2],n[1]-1,1);case"YYYY-MMM":return new Date(+n[1],shortMonthKey[n[2]],1);case"MMM-YYYY":return new Date(+n[2],shortMonthKey[n[1]],1);case"MMM-YY":return new Date(o(+n[2]),shortMonthKey[n[1]],1);case"MMM":return new Date(a,shortMonthKey[n[1]],1);case"YYYY-WW":return dateFromIsoWeek(n[1],n[2],1);case"WW-YYYY":return dateFromIsoWeek(n[2],n[1],1);case"YYYY-WW-d":return dateFromIsoWeek(n[1],n[2],n[3]);case"YYYY-MM-DD":return new Date(n[1],n[3]-1,n[4]);case"DD/MM/YYYY":return new Date(n[4],n[3]-1,n[1]);case"DD/MMM/YYYY":return new Date(n[4],shortMonthKey[n[3]],n[1]);case"DD/MMM/YY":return new Date(o(n[4]),shortMonthKey[n[3]],n[1]);case"MM/DD/YYYY":return new Date(n[4],n[1]-1,n[3]);case"MMM-DD-YYYY":return new Date(n[3],shortMonthKey[n[1]],n[2]);case"YYYY-MM-DD HH:MM":return new Date(+n[1],n[3]-1,+n[4],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"DD.MM.YYYY HH:MM":return new Date(+n[4],n[3]-1,+n[1],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"MM/DD/YYYY HH:MM":return new Date(+n[4],n[1]-1,+n[3],hour(+n[5],n[8]),+n[6]||0,+n[7]||0);case"ISO8601":return new Date(n.toUpperCase());default:console.warn("unknown format",t)}return r++,e},toNum:function(e){return e.getTime()},fromNum:function(e){return new Date(e)},errors:function(){return r},name:function(){return"date"},format:function(e){return arguments.length?(t=e,a):t},precision:function(){return knownFormats[t].precision},formatter:function(){if(!t)return underscore.identity;var e=Globalize.culture().calendar.patterns.M.replace("MMMM","MMM");switch(knownFormats[t].precision){case"year":return function(e){return underscore.isDate(e)?e.getFullYear():e};case"half":return function(e){return underscore.isDate(e)?e.getFullYear()+" H"+(e.getMonth()/6+1):e};case"quarter":return function(e){return underscore.isDate(e)?e.getFullYear()+" Q"+(e.getMonth()/3+1):e};case"month":return function(e){return underscore.isDate(e)?Globalize.format(e,"MMM yy"):e};case"week":return function(e){return underscore.isDate(e)?dateToIsoWeek(e).slice(0,2).join(" W"):e};case"day":return function(e,t){return underscore.isDate(e)?Globalize.format(e,t?"D":"d"):e};case"day-minutes":return function(t){return underscore.isDate(t)?Globalize.format(t,e).replace(" ","&nbsp;")+" - "+Globalize.format(t,"t").replace(" ","&nbsp;"):t};case"day-seconds":return function(e){return underscore.isDate(e)?Globalize.format(e,"T").replace(" ","&nbsp;"):e}}},isValid:function(e){return underscore.isDate(a.parse(e))},ambiguousFormats:function(){var e=[];return underscore.each(n,function(t,r){t===o[1]&&e.push([r,r])}),e}};return a}var columnTypes={text:text,number:number$1,date:date$1},TAGS=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,COMMENTS_AND_PHP_TAGS=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,defaultAllowed="<a><b><br><br/><i><strong><sup><sub><strike><u><em><tt>";function purifyHTML(e,t){if(null===e)return null;if(void 0!==e){if((e=String(e)).indexOf("<")<0||e.indexOf(">")<0)return e;if(e=stripTags(e,t),"undefined"==typeof document)return e;var r=document.createElement("div");r.innerHTML=e;for(var n=r.querySelectorAll("*"),o=0;o<n.length;o++){"a"===n[o].nodeName.toLowerCase()&&("_self"!==n[o].getAttribute("target")&&n[o].setAttribute("target","_blank"),n[o].setAttribute("rel","nofollow noopener noreferrer"));for(var a=0;a<n[o].attributes.length;a++){var i=n[o].attributes[a];i.specified&&"on"===i.name.substr(0,2)&&n[o].removeAttribute(i.name)}}return r.innerHTML}}function stripTags(e,t){t=(((void 0!==t?t||"":defaultAllowed)+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");for(var r=e,n=e;;)if((r=n)===(n=r.replace(COMMENTS_AND_PHP_TAGS,"").replace(TAGS,function(e,r){return t.indexOf("<"+r.toLowerCase()+">")>-1?e:""})))return n}function column(e,t,r){function n(e){return null!==e&&void 0!==e&&""!==e}var o,a,i=underscore.shuffle(underscore.range(t.length)).filter(function(e){return n(t[e])}).slice(0,200).map(function(e){return t[e]});r=r?columnTypes[r](i):function(e){if(underscore.every(t,underscore.isNumber))return columnTypes.number();if(underscore.every(t,underscore.isDate))return columnTypes.date();var r,o=[columnTypes.date(e),columnTypes.number(e),columnTypes.text()],a=.1*t.filter(n).length;return underscore.each(t,function(e){underscore.each(o,function(t){t.parse(e)})}),underscore.every(o,function(e){return e.errors()<a&&(r=e),!r}),underscore.isUndefined(r)&&(r=o[2]),r}(i);var u,s=t.slice(0),c={name:function(){return arguments.length?(e=arguments[0],c):purifyHTML(e)},title:function(){return arguments.length?(u=arguments[0],c):purifyHTML(u||e)},length:t.length,val:function(e,n){if(arguments.length){var o=n?s:t;return e<0&&(e+=o.length),r.parse(purifyHTML(o[e]))}},values:function(e){var n=e?s:t;return n=underscore.map(n,function(e){return purifyHTML(e)}),underscore.map(n,r.parse)},each:function(e){for(var r=0;r<t.length;r++)e(c.val(r),r)},raw:function(e,r){return arguments.length?2===arguments.length?(t[e]=r,c):purifyHTML(t[e]):t},type:function(e){if(!0===e)return r;if(underscore.isString(e)){if(columnTypes[e])return r=columnTypes[e](i),c;throw new Error("unknown column type: "+e)}return r.name()},range:function(){return!!r.toNum&&(o||(o=[Number.MAX_VALUE,-Number.MAX_VALUE],c.each(function(e){e=r.toNum(e),underscore.isNumber(e)&&!underscore.isNaN(e)&&(e<o[0]&&(o[0]=e),e>o[1]&&(o[1]=e))}),o[0]=r.fromNum(o[0]),o[1]=r.fromNum(o[1])),o)},total:function(){return!!r.toNum&&(a||(a=0,c.each(function(e){a+=r.toNum(e)}),a=r.fromNum(a)),a)},filterRows:function(e){return t=[],arguments.length?underscore.each(e,function(e){t.push(s[e])}):t=s.slice(0),c.length=t.length,o=a=!1,c},toString:function(){return e+" ("+r.name()+")"},indexOf:function(e){return underscore.find(underscore.range(t.length),function(t){return c.val(t)===e})},limitRows:function(e){s.length>e&&(s.length=e,t.length=e,c.length=e)}};return c}function delimited(e){return{dataset:function(){if(e.url);else if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(t){return new DelimitedParser(e).parse(t)});throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return new DelimitedParser(e).parse(e.csv)}}}var DelimitedParser=function(e){e=Object.assign({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:!1,firstRowIsHeader:!0},e),this.__delimiterPatterns=getDelimiterPatterns(e.delimiter,e.quoteChar),this.opts=e};function getDelimiterPatterns(e,t){return new RegExp("(\\"+e+"|\\r?\\n|\\r|^)(?:"+t+"([^"+t+"]*(?:"+t+'"[^'+t+"]*)*)"+t+"|([^"+t+"\\"+e+"\\r\\n]*))","gi")}function json(e){return{dataset:function(){if(e.url)return fetch(e.url).then(function(e){return e.text()}).then(function(e){return JSON.parse(e)});if(e.csv)return new Promise(function(t){t(e.csv)}).then(function(e){return JSON.parse(e)});throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return JSON.parse(e.csv)}}}function reorderColumns(e,t){var r=e.getMetadata("data.column-order",[]);return r.length&&r.length===t.numColumns()&&t.columnOrder(r),t}function applyChanges(e,t){var r=e.getMetadata("data.changes",[]),n=e.getMetadata("data.transpose",!1);r.forEach(function(e){var r="row",o="column";n&&(r="column",o="row"),t.hasColumn(e[o])&&(0===e[r]?t.column(e[o]).title(e.value):t.column(e[o]).raw(e[r]-1,e.value))});var o=e.getMetadata("data.column-format",{});return underscore.each(o,function(e,r){e.type&&t.hasColumn(r)&&"auto"!==e.type&&t.column(r).type(e.type),e["input-format"]&&t.hasColumn(r)&&t.column(r).type(!0).format(e["input-format"])}),t}function arrayMin(e,t){var r,n,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(r=e[a])&&r>=r)for(n=r;++a<o;)null!=(r=e[a])&&n>r&&(n=r)}else for(;++a<o;)if(null!=(r=t(e[a],a,e))&&r>=r)for(n=r;++a<o;)null!=(r=t(e[a],a,e))&&n>r&&(n=r);return n}function arrayMax(e,t){var r,n,o=e.length,a=-1;if(null==t){for(;++a<o;)if(null!=(r=e[a])&&r>=r)for(n=r;++a<o;)null!=(r=e[a])&&r>n&&(n=r)}else for(;++a<o;)if(null!=(r=t(e[a],a,e))&&r>=r)for(n=r;++a<o;)null!=(r=t(e[a],a,e))&&r>n&&(n=r);return n}function arraySum(e,t){var r,n=e.length,o=-1,a=0;if(null==t)for(;++o<n;)(r=+e[o])&&(a+=r);else for(;++o<n;)(r=+t(e[o],o,e))&&(a+=r);return a}function number$2(e){return null===e?NaN:+e}function arrayMean(e,t){var r,n=e.length,o=n,a=-1,i=0;if(null==t)for(;++a<n;)isNaN(r=number$2(e[a]))?--o:i+=r;else for(;++a<n;)isNaN(r=number$2(t(e[a],a,e)))?--o:i+=r;if(o)return i/o}function ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function quantile(e,t,r){if(null==r&&(r=number$2),n=e.length){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*t,a=Math.floor(o),i=+r(e[a],a,e);return i+(+r(e[a+1],a+1,e)-i)*(o-a)}}function arrayMedian(e,t){var r,n=e.length,o=-1,a=[];if(null==t)for(;++o<n;)isNaN(r=number$2(e[o]))||a.push(r);else for(;++o<n;)isNaN(r=number$2(t(e[o],o,e)))||a.push(r);return quantile(a.sort(ascending),.5)}function columnNameToVariable(e){return e.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/-/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/^(abstract|arguments|await|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|eval|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|let|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var|void|volatile|while|window|with|yield)$/,"$1_")}function addComputedColumns(chart,dataset){var virtualColumns=chart.getMetadata("describe.computed-columns",{}),data=dataset.list(),columnNameToVar={},columnAggregates={};return dataset.eachColumn(function(e){e.isComputed||(columnNameToVar[e.name()]=columnNameToVariable(e.name()),"number"===e.type()&&(columnAggregates[e.name()]={min:arrayMin(e.values()),max:arrayMax(e.values()),sum:arraySum(e.values()),mean:arrayMean(e.values()),median:arrayMedian(e.values())}))}),underscore.each(virtualColumns,addComputedColumn),dataset;function addComputedColumn(formula,name){var datefmt=function(e){return e.getFullYear()+"-"+leftPad(1+e.getMonth(),2,0)+"-"+leftPad(1+e.getDate(),2,0)},values=data.map(function(row,rowIndex){var context=[];return context.push("var __row = "+rowIndex+";"),Object.keys(row).forEach(function(e){var t=row[e];columnNameToVar[e]&&(context.push("var "+columnNameToVar[e]+" = "+JSON.stringify(t)+";"),"number"===dataset.column(e).type()&&(context.push("var "+columnNameToVar[e]+"__sum = "+columnAggregates[e].sum+";"),context.push("var "+columnNameToVar[e]+"__min = "+columnAggregates[e].min+";"),context.push("var "+columnNameToVar[e]+"__max = "+columnAggregates[e].max+";"),context.push("var "+columnNameToVar[e]+"__mean = "+columnAggregates[e].mean+";"),context.push("var "+columnNameToVar[e]+"__median = "+columnAggregates[e].median+";")))}),context.push("var max = Math.max, min = Math.min;"),function(){try{return eval(this.context.join("\n")+"\n"+formula)}catch(e){return console.warn(e),"n/a"}}.call({context:context})}).map(function(e){return underscore.isBoolean(e)?e?"yes":"no":underscore.isDate(e)?datefmt(e):underscore.isNumber(e)?""+e:String(e)}),virtualColumn=column(name,values);virtualColumn.isComputed=!0,dataset.add(virtualColumn)}function leftPad(e,t,r){for(e=String(e);e.length<t;)e=String(r)+e;return e}}function fetchJSON(e,t,r,n,o){var a={method:t,body:n,mode:"cors",credentials:r};return window.fetch(e,a).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.text()}).then(function(e){try{return JSON.parse(e)}catch(t){return console.warn("malformed json input",e),e}}).then(function(e){return o&&o(e),e}).catch(function(e){console.error(e)})}function putJSON(e,t,r){return fetchJSON(e,"PUT","include",t,r)}function loadScript(e,t){var r=document.createElement("script");r.src=e,r.onload=function(){t&&t()},document.body.appendChild(r)}DelimitedParser.prototype.parse=function(e){this.__rawData=e;var t=this.opts;"auto"===t.delimiter&&(t.delimiter=this.guessDelimiter(e,t.skipRows),this.__delimiterPatterns=getDelimiterPatterns(t.delimiter,t.quoteChar));var r,n="|"!==t.delimiter?"|":"#";return e=n+"\n"+e.replace(/\s+$/g,"")+n,r=function(e,t,r){r=r||",";for(var o,a=[[]],i=null;i=e.exec(t);){var u=i[1];u.length&&u!==r&&a.push([]),o=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],a[a.length-1].push(o)}a[0][0].substr(0,1)===n&&(a[0][0]=a[0][0].substr(1));var s=a.length-1,c=a[s].length-1,l=a[s][c].length-1;return a[s][c].substr(l)===n&&(a[s][c]=a[s][c].substr(0,l)),a.slice(1)}(this.__delimiterPatterns,e,t.delimiter),t.transpose&&(r=function(e){var t,r,n=e,o=n.length?n.length:0,a=n[0]instanceof Array?n[0].length:0;if(0===a||0===o)return[];var i=[];for(t=0;t<a;t++)for(i[t]=[],r=0;r<o;r++)i[t][r]=n[r][t];return i}(r)),function(e){var r=[],n={},o=e.length,a=e[0].length,i=t.skipRows,u=[];t.firstRowIsHeader&&(u=e[i],i++);for(var s=0;s<a;s++){var c=underscore.isString(u[s])?u[s].replace(/^\s+|\s+$/g,""):"",l=""!==c?"":1;for(c=""!==c?c:"X.";void 0!==n[c+l];)l=""===l?1:l+1;r.push({name:c+l,data:[]}),n[c+l]=!0}return underscore.range(i,o).forEach(function(n){r.forEach(function(r,o){r.data.push(""!==e[n][o]?e[n][o]:t.emptyValue)})}),dataset(r=r.map(function(e){return column(e.name,e.data)}))}(r)},DelimitedParser.prototype.guessDelimiter=function(e){var t=0,r=-1,n=this,o=["\t",";","|",","];return o.forEach(function(o,a){var i=getDelimiterPatterns(o,n.quoteChar),u=e.match(i).length;"\t"===o&&(u*=1.15),u>t&&(t=u,r=a)}),o[r]};var storeChanges=underscore.debounce(function(e,t){var r=e.serialize();putJSON("/api/2/charts/"+r.id,JSON.stringify(r),function(){t&&t()})},1e3),storeData=underscore.debounce(function(e,t){var r=e.getMetadata("data.json")?JSON.stringify(e.dataset()):e.rawData();putJSON("/api/2/charts/"+e.get().id+"/data",r,function(){t&&t()})},1e3),Chart=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(e,t){var r=this,n={firstRowIsHeader:this.getMetadata("data.horizontal-header",!0),transpose:this.getMetadata("data.transpose",!1)};return e&&!t?n.csv=e:n.url=t||"data.csv",n.csv&&(this._rawData=n.csv),(this.getMetadata("data.json",!1)?json(n):delimited(n)).dataset().then(function(e){return r.dataset(e),e}).catch(function(e){console.error("could not fetch datasource",e)})},t.prototype.dataset=function(e){if(arguments.length){!0!==e&&(this._dataset_cache=e);var t="function"!=typeof e.list;return this._dataset=t?e:reorderColumns(this,applyChanges(this,addComputedColumns(this,!0===e?this._dataset_cache:e))),t&&this.set({dataset:e}),this._dataset}return this._dataset},t.prototype.theme=function(e){return arguments.length?(this.set({theme:e}),this):this.get().theme},t.prototype.vis=function(e){return arguments.length?(this.set({vis:e}),this):this.get().vis},t.prototype.locale=function(e,t){return arguments.length&&(this._locale=e=e.replace("_","-"),window.Globalize&&loadGlobalizeLocale(e,t)),this._locale},t.prototype.getMetadata=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=this.get().metadata;if(!e)return r;var n=e.split("."),o=r;return underscore.some(n,function(e){return!(!underscore.isUndefined(o)&&!underscore.isNull(o))||(o=o[e],!1)}),underscore.isUndefined(o)||underscore.isNull(o)?t:o},t.prototype.setMetadata=function(e,t){var r=e.split("."),n=r.pop(),o=this.get().metadata,a=o;return r.forEach(function(e){(underscore.isUndefined(a[e])||underscore.isNull(a[e]))&&(a[e]={}),a=a[e]}),deepEqual(a[n],t)||(a[n]=t,this.set({metadata:o})),this},t.prototype.store=function(e){storeChanges(this,e)},t.prototype.storeData=function(e){storeData(this,e)},t.prototype.serialize=function(){var e=this.get(),t={};return["id","title","theme","createdAt","lastModifiedAt","type","metadata","authorId","showInGallery","language","guestSession","lastEditStep","publishedAt","publicUrl","publicVersion","organizationId","forkedFrom","externalData","forkable","isFork","inFolder","author"].forEach(function(r){t[r]=e[r]}),t},t.prototype.passiveMode=function(){var e=this;this.set({passiveMode:!0}),setTimeout(function(){return e.set({passiveMode:!1})},100)},t.prototype.isPassive=function(){return this.get().passiveMode},t.prototype.rawData=function(){return this._rawData},t}(Store);function deepEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}function loadGlobalizeLocale(e,t){window.Globalize.cultures.hasOwnProperty(e)?(window.Globalize.culture(e),"function"==typeof t&&t()):loadScript("/static/vendor/globalize/cultures/globalize.culture."+e+".js",function(){window.Globalize.culture(e),"function"==typeof t&&t()})}Chart.prototype.observeDeep=observeDeep;var data$1={},main={App:ChartEditor,Chart:Chart,data:data$1};return main});
