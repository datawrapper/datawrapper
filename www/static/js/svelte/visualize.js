!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/visualize",e):(t=t||self).visualize=e()}(this,(function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t};function n(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}var i=n((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(r)}t.exports=e}));var o=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var a=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?o(t):e},s=n((function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(r)}t.exports=e})),u=n((function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(r,n)}t.exports=e}));var c=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)};var f=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n};var p=function(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}};var l=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};function h(t,e){for(var r in e)t[r]=e[r];return t}function v(){return Object.create(null)}function d(t,e){return t!=t?e==e:t!==e||t&&"object"===i(t)||"function"==typeof t}function m(t,e){return t!=t?e==e:t!==e}function y(t,e){this._handlers={},this._dependents=[],this._computed=v(),this._sortedComputedProperties=[],this._state=h({},t),this._differs=e&&e.immutable?m:d}function g(t,e){for(var r=0;r<e.length;r+=1){if(!t)return;t=t[e[r]]}return t}h(y.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r];e["$"+n]=this._state[n]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,e){var r=this,n=this._state;this._state=h(h({},n),t);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,e);this.fire("state",{changed:e,previous:n,current:this._state}),this._dependents.filter((function(t){for(var n={},i=!1,o=0;o<t.props.length;o+=1){var a=t.props[o];a in e&&(n["$"+a]=r._state[a],i=!0)}if(i)return t.component._stage(n),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:e,previous:n,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,r=this._sortedComputedProperties=[],n=v();function i(o){var a=e[o];a&&(a.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between ".concat(e," <-> ").concat(o));i(e)})),n[o]||(n[o]=!0,r.push(a)))}for(var o in this._computed)i(t=o)},compute:function(t,e,r){var n,i=this,o={deps:e,update:function(o,a,s){var u=e.map((function(t){return t in a&&(s=!0),o[t]}));if(s){var c=r.apply(null,u);i._differs(c,n)&&(n=c,a[t]=!0,o[t]=n)}}};this._computed[t]=o,this._sortComputedProperties();var a=h({},this._state),s={};o.update(a,s,!0),this._set(a,s)},fire:function(t,e){var r=t in this._handlers&&this._handlers[t].slice();if(r)for(var n=0;n<r.length;n+=1){var i=r[n];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}},get:function(){return this._state},on:function(t,e){var r=this._handlers[t]||(this._handlers[t]=[]);return r.push(e),{cancel:function(){var t=r.indexOf(e);~t&&r.splice(t,1)}}},set:function(t){var e=this._state,r=this._changed={},n=!1;for(var i in t){if(this._computed[i])throw new Error("'".concat(i,"' is a read-only computed property"));this._differs(t[i],e[i])&&(r[i]=n=!0)}n&&this._set(t,r)}});var M="object"==("undefined"==typeof self?"undefined":i(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":i(global))&&global.global===global&&global||Function("return this")()||{},Y=Array.prototype,w=Object.prototype,b="undefined"!=typeof Symbol?Symbol.prototype:null,E=Y.push,A=Y.slice,x=w.toString,O=w.hasOwnProperty,D="undefined"!=typeof ArrayBuffer,N=Array.isArray,T=Object.keys,S=Object.create,C=D&&ArrayBuffer.isView,_=isNaN,I=isFinite,R=!{toString:null}.propertyIsEnumerable("toString"),k=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],j=Math.pow(2,53)-1;function L(t,e){return e=null==e?t.length-1:+e,function(){for(var r=Math.max(arguments.length-e,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var o=Array(e+1);for(i=0;i<e;i++)o[i]=arguments[i];return o[e]=n,t.apply(this,o)}}function P(t){var e=i(t);return"function"===e||"object"===e&&!!t}function U(t){return!0===t||!1===t||"[object Boolean]"===x.call(t)}function F(t){return function(e){return x.call(e)==="[object "+t+"]"}}var H=F("String"),B=F("Number"),V=F("Date"),W=F("RegExp"),z=F("Error"),G=F("Symbol"),$=F("Map"),q=F("WeakMap"),X=F("Set"),J=F("WeakSet"),K=F("ArrayBuffer"),Q=F("DataView"),Z=N||F("Array"),tt=F("Function"),et=M.document&&M.document.childNodes;"function"!=typeof/./&&"object"!=("undefined"==typeof Int8Array?"undefined":i(Int8Array))&&"function"!=typeof et&&(tt=function(t){return"function"==typeof t||!1});var rt=tt;function nt(t,e){return null!=t&&O.call(t,e)}var it=F("Arguments");!function(){it(arguments)||(it=function(t){return nt(t,"callee")})}();var ot=it;function at(t){return B(t)&&_(t)}function st(t){return function(){return t}}function ut(t){return function(e){var r=t(e);return"number"==typeof r&&r>=0&&r<=j}}function ct(t){return function(e){return null==e?void 0:e[t]}}var ft=ct("byteLength"),pt=ut(ft),lt=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var ht=D?function(t){return C?C(t)&&!Q(t):pt(t)&&lt.test(x.call(t))}:st(!1),vt=ct("length"),dt=ut(vt);function mt(t,e){e=function(t){for(var e={},r=t.length,n=0;n<r;++n)e[t[n]]=!0;return{contains:function(t){return e[t]},push:function(r){return e[r]=!0,t.push(r)}}}(e);var r=k.length,n=t.constructor,i=rt(n)&&n.prototype||w,o="constructor";for(nt(t,o)&&!e.contains(o)&&e.push(o);r--;)(o=k[r])in t&&t[o]!==i[o]&&!e.contains(o)&&e.push(o)}function yt(t){if(!P(t))return[];if(T)return T(t);var e=[];for(var r in t)nt(t,r)&&e.push(r);return R&&mt(t,e),e}function gt(t,e){var r=yt(e),n=r.length;if(null==t)return!n;for(var i=Object(t),o=0;o<n;o++){var a=r[o];if(e[a]!==i[a]||!(a in i))return!1}return!0}function Mt(t){return t instanceof Mt?t:this instanceof Mt?void(this._wrapped=t):new Mt(t)}function Yt(t,e,r,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=i(t);return("function"===o||"object"===o||"object"==i(e))&&function t(e,r,n,o){e instanceof Mt&&(e=e._wrapped);r instanceof Mt&&(r=r._wrapped);var a=x.call(e);if(a!==x.call(r))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+r;case"[object Number]":return+e!=+e?+r!=+r:0==+e?1/+e==1/r:+e==+r;case"[object Date]":case"[object Boolean]":return+e==+r;case"[object Symbol]":return b.valueOf.call(e)===b.valueOf.call(r);case"[object ArrayBuffer]":return t(new DataView(e),new DataView(r),n,o);case"[object DataView]":var s=ft(e);if(s!==ft(r))return!1;for(;s--;)if(e.getUint8(s)!==r.getUint8(s))return!1;return!0}if(ht(e))return t(new DataView(e.buffer),new DataView(r.buffer),n,o);var u="[object Array]"===a;if(!u){if("object"!=i(e)||"object"!=i(r))return!1;var c=e.constructor,f=r.constructor;if(c!==f&&!(rt(c)&&c instanceof c&&rt(f)&&f instanceof f)&&"constructor"in e&&"constructor"in r)return!1}o=o||[];var p=(n=n||[]).length;for(;p--;)if(n[p]===e)return o[p]===r;if(n.push(e),o.push(r),u){if((p=e.length)!==r.length)return!1;for(;p--;)if(!Yt(e[p],r[p],n,o))return!1}else{var l,h=yt(e);if(p=h.length,yt(r).length!==p)return!1;for(;p--;)if(l=h[p],!nt(r,l)||!Yt(e[l],r[l],n,o))return!1}return n.pop(),o.pop(),!0}(t,e,r,n)}function wt(t){if(!P(t))return[];var e=[];for(var r in t)e.push(r);return R&&mt(t,e),e}function bt(t){for(var e=yt(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=t[e[i]];return n}function Et(t){for(var e={},r=yt(t),n=0,i=r.length;n<i;n++)e[t[r[n]]]=r[n];return e}function At(t){var e=[];for(var r in t)rt(t[r])&&e.push(r);return e.sort()}function xt(t,e){return function(r){var n=arguments.length;if(e&&(r=Object(r)),n<2||null==r)return r;for(var i=1;i<n;i++)for(var o=arguments[i],a=t(o),s=a.length,u=0;u<s;u++){var c=a[u];e&&void 0!==r[c]||(r[c]=o[c])}return r}}Mt.VERSION="1.11.0",Mt.prototype.value=function(){return this._wrapped},Mt.prototype.valueOf=Mt.prototype.toJSON=Mt.prototype.value,Mt.prototype.toString=function(){return String(this._wrapped)};var Ot=xt(wt),Dt=xt(yt),Nt=xt(wt,!0);function Tt(t){if(!P(t))return{};if(S)return S(t);var e=function(){};e.prototype=t;var r=new e;return e.prototype=null,r}function St(t){return P(t)?Z(t)?t.slice():Ot({},t):t}function Ct(t){return t}function _t(t){return t=Dt({},t),function(e){return gt(e,t)}}function It(t,e){for(var r=e.length,n=0;n<r;n++){if(null==t)return;t=t[e[n]]}return r?t:void 0}function Rt(t){return Z(t)?function(e){return It(e,t)}:ct(t)}function kt(t,e,r){if(void 0===e)return t;switch(null==r?3:r){case 1:return function(r){return t.call(e,r)};case 3:return function(r,n,i){return t.call(e,r,n,i)};case 4:return function(r,n,i,o){return t.call(e,r,n,i,o)}}return function(){return t.apply(e,arguments)}}function jt(t,e,r){return null==t?Ct:rt(t)?kt(t,e,r):P(t)&&!Z(t)?_t(t):Rt(t)}function Lt(t,e){return jt(t,e,1/0)}function Pt(t,e,r){return Mt.iteratee!==Lt?Mt.iteratee(t,e):jt(t,e,r)}function Ut(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}Mt.iteratee=Lt;var Ft=Date.now||function(){return(new Date).getTime()};function Ht(t){var e=function(e){return t[e]},r="(?:"+yt(t).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(i,e):t}}var Bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Vt=Ht(Bt),Wt=Ht(Et(Bt)),zt=Mt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Gt=/(.)^/,$t={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},qt=/\\|'|\r|\n|\u2028|\u2029/g;function Xt(t){return"\\"+$t[t]}var Jt=0;function Kt(t,e,r,n,i){if(!(n instanceof e))return t.apply(r,i);var o=Tt(t.prototype),a=t.apply(o,i);return P(a)?a:o}var Qt=L((function(t,e){var r=Qt.placeholder;return function n(){for(var i=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===r?arguments[i++]:e[s];for(;i<arguments.length;)a.push(arguments[i++]);return Kt(t,n,this,this,a)}}));Qt.placeholder=Mt;var Zt=L((function(t,e,r){if(!rt(t))throw new TypeError("Bind must be called on a function");var n=L((function(i){return Kt(t,n,e,this,r.concat(i))}));return n}));function te(t,e,r,n){if(n=n||[],e||0===e){if(e<=0)return n.concat(t)}else e=1/0;for(var i=n.length,o=0,a=vt(t);o<a;o++){var s=t[o];if(dt(s)&&(Z(s)||ot(s)))if(e>1)te(s,e-1,r,n),i=n.length;else for(var u=0,c=s.length;u<c;)n[i++]=s[u++];else r||(n[i++]=s)}return n}var ee=L((function(t,e){var r=(e=te(e,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=e[r];t[n]=Zt(t[n],t)}return t}));var re=L((function(t,e,r){return setTimeout((function(){return t.apply(null,r)}),e)})),ne=Qt(re,Mt,1);function ie(t){return function(){return!t.apply(this,arguments)}}function oe(t,e){var r;return function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=null),r}}var ae=Qt(oe,2);function se(t,e,r){e=Pt(e,r);for(var n,i=yt(t),o=0,a=i.length;o<a;o++)if(e(t[n=i[o]],n,t))return n}function ue(t){return function(e,r,n){r=Pt(r,n);for(var i=vt(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(r(e[o],o,e))return o;return-1}}var ce=ue(1),fe=ue(-1);function pe(t,e,r,n){for(var i=(r=Pt(r,n,1))(e),o=0,a=vt(t);o<a;){var s=Math.floor((o+a)/2);r(t[s])<i?o=s+1:a=s}return o}function le(t,e,r){return function(n,i,o){var a=0,s=vt(n);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(r&&o&&s)return n[o=r(n,i)]===i?o:-1;if(i!=i)return(o=e(A.call(n,a,s),at))>=0?o+a:-1;for(o=t>0?a:s-1;o>=0&&o<s;o+=t)if(n[o]===i)return o;return-1}}var he=le(1,ce,pe),ve=le(-1,fe);function de(t,e,r){var n=(dt(t)?ce:se)(t,e,r);if(void 0!==n&&-1!==n)return t[n]}function me(t,e,r){var n,i;if(e=kt(e,r),dt(t))for(n=0,i=t.length;n<i;n++)e(t[n],n,t);else{var o=yt(t);for(n=0,i=o.length;n<i;n++)e(t[o[n]],o[n],t)}return t}function ye(t,e,r){e=Pt(e,r);for(var n=!dt(t)&&yt(t),i=(n||t).length,o=Array(i),a=0;a<i;a++){var s=n?n[a]:a;o[a]=e(t[s],s,t)}return o}function ge(t){var e=function(e,r,n,i){var o=!dt(e)&&yt(e),a=(o||e).length,s=t>0?0:a-1;for(i||(n=e[o?o[s]:s],s+=t);s>=0&&s<a;s+=t){var u=o?o[s]:s;n=r(n,e[u],u,e)}return n};return function(t,r,n,i){var o=arguments.length>=3;return e(t,kt(r,i,4),n,o)}}var Me=ge(1),Ye=ge(-1);function we(t,e,r){var n=[];return e=Pt(e,r),me(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function be(t,e,r){e=Pt(e,r);for(var n=!dt(t)&&yt(t),i=(n||t).length,o=0;o<i;o++){var a=n?n[o]:o;if(!e(t[a],a,t))return!1}return!0}function Ee(t,e,r){e=Pt(e,r);for(var n=!dt(t)&&yt(t),i=(n||t).length,o=0;o<i;o++){var a=n?n[o]:o;if(e(t[a],a,t))return!0}return!1}function Ae(t,e,r,n){return dt(t)||(t=bt(t)),("number"!=typeof r||n)&&(r=0),he(t,e,r)>=0}var xe=L((function(t,e,r){var n,i;return rt(e)?i=e:Z(e)&&(n=e.slice(0,-1),e=e[e.length-1]),ye(t,(function(t){var o=i;if(!o){if(n&&n.length&&(t=It(t,n)),null==t)return;o=t[e]}return null==o?o:o.apply(t,r)}))}));function Oe(t,e){return ye(t,Rt(e))}function De(t,e,r){var n,o,a=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=i(t[0])&&null!=t)for(var u=0,c=(t=dt(t)?t:bt(t)).length;u<c;u++)null!=(n=t[u])&&n>a&&(a=n);else e=Pt(e,r),me(t,(function(t,r,n){((o=e(t,r,n))>s||o===-1/0&&a===-1/0)&&(a=t,s=o)}));return a}function Ne(t,e,r){if(null==e||r)return dt(t)||(t=bt(t)),t[Ut(t.length-1)];var n=dt(t)?St(t):bt(t),i=vt(n);e=Math.max(Math.min(e,i),0);for(var o=i-1,a=0;a<e;a++){var s=Ut(a,o),u=n[a];n[a]=n[s],n[s]=u}return n.slice(0,e)}function Te(t,e){return function(r,n,i){var o=e?[[],[]]:{};return n=Pt(n,i),me(r,(function(e,i){var a=n(e,i,r);t(o,e,a)})),o}}var Se=Te((function(t,e,r){nt(t,r)?t[r].push(e):t[r]=[e]})),Ce=Te((function(t,e,r){t[r]=e})),_e=Te((function(t,e,r){nt(t,r)?t[r]++:t[r]=1})),Ie=Te((function(t,e,r){t[r?0:1].push(e)}),!0),Re=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ke(t,e,r){return e in r}var je=L((function(t,e){var r={},n=e[0];if(null==t)return r;rt(n)?(e.length>1&&(n=kt(n,e[1])),e=wt(t)):(n=ke,e=te(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var a=e[i],s=t[a];n(s,a,t)&&(r[a]=s)}return r})),Le=L((function(t,e){var r,n=e[0];return rt(n)?(n=ie(n),e.length>1&&(r=e[1])):(e=ye(te(e,!1,!1),String),n=function(t,r){return!Ae(e,r)}),je(t,n,r)}));function Pe(t,e,r){return A.call(t,0,Math.max(0,t.length-(null==e||r?1:e)))}function Ue(t,e,r){return null==t||t.length<1?null==e||r?void 0:[]:null==e||r?t[0]:Pe(t,t.length-e)}function Fe(t,e,r){return A.call(t,null==e||r?1:e)}var He=L((function(t,e){return e=te(e,!0,!0),we(t,(function(t){return!Ae(e,t)}))})),Be=L((function(t,e){return He(t,e)}));function Ve(t,e,r,n){U(e)||(n=r,r=e,e=!1),null!=r&&(r=Pt(r,n));for(var i=[],o=[],a=0,s=vt(t);a<s;a++){var u=t[a],c=r?r(u,a,t):u;e&&!r?(a&&o===c||i.push(u),o=c):r?Ae(o,c)||(o.push(c),i.push(u)):Ae(i,u)||i.push(u)}return i}var We=L((function(t){return Ve(te(t,!0,!0))}));function ze(t){for(var e=t&&De(t,vt).length||0,r=Array(e),n=0;n<e;n++)r[n]=Oe(t,n);return r}var Ge=L(ze);function $e(t,e){return t._chain?Mt(e).chain():e}function qe(t){return me(At(t),(function(e){var r=Mt[e]=t[e];Mt.prototype[e]=function(){var t=[this._wrapped];return E.apply(t,arguments),$e(this,r.apply(Mt,t))}})),Mt}me(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=Y[t];Mt.prototype[t]=function(){var r=this._wrapped;return null!=r&&(e.apply(r,arguments),"shift"!==t&&"splice"!==t||0!==r.length||delete r[0]),$e(this,r)}})),me(["concat","join","slice"],(function(t){var e=Y[t];Mt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),$e(this,t)}}));var Xe=qe(Object.freeze({__proto__:null,VERSION:"1.11.0",restArguments:L,isObject:P,isNull:function(t){return null===t},isUndefined:function(t){return void 0===t},isBoolean:U,isElement:function(t){return!(!t||1!==t.nodeType)},isString:H,isNumber:B,isDate:V,isRegExp:W,isError:z,isSymbol:G,isMap:$,isWeakMap:q,isSet:X,isWeakSet:J,isArrayBuffer:K,isDataView:Q,isArray:Z,isFunction:rt,isArguments:ot,isFinite:function(t){return!G(t)&&I(t)&&!isNaN(parseFloat(t))},isNaN:at,isTypedArray:ht,isEmpty:function(t){return null==t||(dt(t)&&(Z(t)||H(t)||ot(t))?0===t.length:0===yt(t).length)},isMatch:gt,isEqual:function(t,e){return Yt(t,e)},keys:yt,allKeys:wt,values:bt,pairs:function(t){for(var e=yt(t),r=e.length,n=Array(r),i=0;i<r;i++)n[i]=[e[i],t[e[i]]];return n},invert:Et,functions:At,methods:At,extend:Ot,extendOwn:Dt,assign:Dt,defaults:Nt,create:function(t,e){var r=Tt(t);return e&&Dt(r,e),r},clone:St,tap:function(t,e){return e(t),t},has:function(t,e){if(!Z(e))return nt(t,e);for(var r=e.length,n=0;n<r;n++){var i=e[n];if(null==t||!O.call(t,i))return!1;t=t[i]}return!!r},mapObject:function(t,e,r){e=Pt(e,r);for(var n=yt(t),i=n.length,o={},a=0;a<i;a++){var s=n[a];o[s]=e(t[s],s,t)}return o},identity:Ct,constant:st,noop:function(){},property:Rt,propertyOf:function(t){return null==t?function(){}:function(e){return Z(e)?It(t,e):t[e]}},matcher:_t,matches:_t,times:function(t,e,r){var n=Array(Math.max(0,t));e=kt(e,r,1);for(var i=0;i<t;i++)n[i]=e(i);return n},random:Ut,now:Ft,escape:Vt,unescape:Wt,templateSettings:zt,template:function(t,e,r){!e&&r&&(e=r),e=Nt({},e,Mt.templateSettings);var n,i=RegExp([(e.escape||Gt).source,(e.interpolate||Gt).source,(e.evaluate||Gt).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(i,(function(e,r,n,i,s){return a+=t.slice(o,s).replace(qt,Xt),o=s+e.length,r?a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(a+="';\n"+i+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var s=function(t){return n.call(this,t,Mt)},u=e.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s},result:function(t,e,r){Z(e)||(e=[e]);var n=e.length;if(!n)return rt(r)?r.call(t):r;for(var i=0;i<n;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=r,i=n),t=rt(o)?o.call(t):o}return t},uniqueId:function(t){var e=++Jt+"";return t?t+e:e},chain:function(t){var e=Mt(t);return e._chain=!0,e},iteratee:Lt,partial:Qt,bind:Zt,bindAll:ee,memoize:function(t,e){var r=function r(n){var i=r.cache,o=""+(e?e.apply(this,arguments):n);return nt(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return r.cache={},r},delay:re,defer:ne,throttle:function(t,e,r){var n,i,o,a,s=0;r||(r={});var u=function(){s=!1===r.leading?0:Ft(),n=null,a=t.apply(i,o),n||(i=o=null)},c=function(){var c=Ft();s||!1!==r.leading||(s=c);var f=e-(c-s);return i=this,o=arguments,f<=0||f>e?(n&&(clearTimeout(n),n=null),s=c,a=t.apply(i,o),n||(i=o=null)):n||!1===r.trailing||(n=setTimeout(u,f)),a};return c.cancel=function(){clearTimeout(n),s=0,n=i=o=null},c},debounce:function(t,e,r){var n,i,o=function(e,r){n=null,r&&(i=t.apply(e,r))},a=L((function(a){if(n&&clearTimeout(n),r){var s=!n;n=setTimeout(o,e),s&&(i=t.apply(this,a))}else n=re(o,e,this,a);return i}));return a.cancel=function(){clearTimeout(n),n=null},a},wrap:function(t,e){return Qt(e,t)},negate:ie,compose:function(){var t=arguments,e=t.length-1;return function(){for(var r=e,n=t[e].apply(this,arguments);r--;)n=t[r].call(this,n);return n}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:oe,once:ae,findKey:se,findIndex:ce,findLastIndex:fe,sortedIndex:pe,indexOf:he,lastIndexOf:ve,find:de,detect:de,findWhere:function(t,e){return de(t,_t(e))},each:me,forEach:me,map:ye,collect:ye,reduce:Me,foldl:Me,inject:Me,reduceRight:Ye,foldr:Ye,filter:we,select:we,reject:function(t,e,r){return we(t,ie(Pt(e)),r)},every:be,all:be,some:Ee,any:Ee,contains:Ae,includes:Ae,include:Ae,invoke:xe,pluck:Oe,where:function(t,e){return we(t,_t(e))},max:De,min:function(t,e,r){var n,o,a=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=i(t[0])&&null!=t)for(var u=0,c=(t=dt(t)?t:bt(t)).length;u<c;u++)null!=(n=t[u])&&n<a&&(a=n);else e=Pt(e,r),me(t,(function(t,r,n){((o=e(t,r,n))<s||o===1/0&&a===1/0)&&(a=t,s=o)}));return a},shuffle:function(t){return Ne(t,1/0)},sample:Ne,sortBy:function(t,e,r){var n=0;return e=Pt(e,r),Oe(ye(t,(function(t,r,i){return{value:t,index:n++,criteria:e(t,r,i)}})).sort((function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return t.index-e.index})),"value")},groupBy:Se,indexBy:Ce,countBy:_e,partition:Ie,toArray:function(t){return t?Z(t)?A.call(t):H(t)?t.match(Re):dt(t)?ye(t,Ct):bt(t):[]},size:function(t){return null==t?0:dt(t)?t.length:yt(t).length},pick:je,omit:Le,first:Ue,head:Ue,take:Ue,initial:Pe,last:function(t,e,r){return null==t||t.length<1?null==e||r?void 0:[]:null==e||r?t[t.length-1]:Fe(t,Math.max(0,t.length-e))},rest:Fe,tail:Fe,drop:Fe,compact:function(t){return we(t,Boolean)},flatten:function(t,e){return te(t,e,!1)},without:Be,uniq:Ve,unique:Ve,union:We,intersection:function(t){for(var e=[],r=arguments.length,n=0,i=vt(t);n<i;n++){var o=t[n];if(!Ae(e,o)){var a;for(a=1;a<r&&Ae(arguments[a],o);a++);a===r&&e.push(o)}}return e},difference:He,unzip:ze,transpose:ze,zip:Ge,object:function(t,e){for(var r={},n=0,i=vt(t);n<i;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r},range:function(t,e,r){null==e&&(e=t||0,t=0),r||(r=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/r),0),i=Array(n),o=0;o<n;o++,t+=r)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var r=[],n=0,i=t.length;n<i;)r.push(A.call(t,n,n+=e));return r},mixin:qe,default:Mt}));function Je(t){var e={},r=t.slice(0);function n(t){for(var r=t.name(),n=r,i=1;e.hasOwnProperty(n);)n=r+"."+i++;n!==r&&t.name(n)}t.forEach((function(t){n(t),e[t.name()]=t}));var i={columns:function(){return t},column:function(r){if(Xe.isString(r)){if(void 0!==e[r])return e[r];throw new Error('No column found with that name: "'+r+'"')}if(!(r<0)){if(void 0!==t[r])return t[r];throw new Error("No column found with that name or index: "+r)}},numColumns:function(){return t.length},numRows:function(){return t[0].length},eachColumn:function(e){t.forEach(e)},hasColumn:function(r){return void 0!==(Xe.isString(r)?e[r]:t[r])},indexOf:function(r){return i.hasColumn(r)?t.indexOf(e[r]):-1},list:function(){return Xe.range(t[0].length).map((function(e){var r={};return t.forEach((function(t){r[t.name()]=t.val(e)})),r}))},csv:function(){var e="";return t.forEach((function(t,r){var n=t.title();n.indexOf('"')>-1&&n.replace('"','\\"'),n.indexOf(",")>-1&&(n='"'+n+'"'),e+=(r>0?",":"")+n})),Xe.range(i.numRows()).forEach((function(r){e+="\n",t.forEach((function(t,n){var i=""+("date"===t.type()?t.raw(r):t.val(r));i.indexOf('"')>-1&&i.replace('"','\\"'),i.indexOf(",")>-1&&(i='"'+i+'"'),e+=(n>0?",":"")+i}))})),e},toCSV:function(){return this.csv()},filterColumns:function(r){return t=t.filter((function(t){return!r[t.name()]})),Xe.each(r,(function(t,r){t&&e[r]&&delete e[r]})),i},eachRow:function(t){var e;for(e=0;e<i.numRows();e++)t(e);return i},add:function(o){return n(o),t.push(o),e[o.name()]=o,r.push(o),i},limitRows:function(e){return t.forEach((function(t){t.limitRows(e)})),i},limitColumns:function(e){return t.length>e&&(t.length=e,r.length=e),i},columnOrder:function(e){return arguments.length?(t.length=0,e.forEach((function(e){t.push(r[e])})),i):t.map((function(t){return r.indexOf(t)}))}};return i}function Ke(t,e){return Math.abs(t-e)<1e-6}Xe._=Xe;var Qe=/^ */.source,Ze=/[*']* *$/.source,tr=/[ \-/.]?/.source,er=/[ \-/.]/.source,rr=/[ \-/.;,]/.source,nr=/[ \-|T]/.source,ir=/[ \-/.m]/.source,or={YY:{parse:/['’‘]?(\d{2})/},YYYY:{test:/([12]\d{3})/,parse:/(\d{4})/},YYYY2:{test:/(?:1[7-9]|20)\d{2}/,parse:/(\d{4})/},H:{parse:/h([12])/},Q:{parse:/q([1234])/},W:{parse:/w([0-5]?[0-9])/},MM:{test:/(0?[1-9]|1[0-2])/,parse:/(0?[1-9]|1[0-2])/},DD:{parse:/(0?[1-9]|[1-2][0-9]|3[01])/},DOW:{parse:/([0-7])/},HHMM:{parse:/(0?\d|1\d|2[0-3]):([0-5]\d)(?::([0-5]\d))? *(am|pm)?/}},ar={0:["jan","january","januar","jänner","jän","janv","janvier","ene","enero","gen","gennaio","janeiro"],1:["feb","february","febr","februar","fév","févr","février","febrero","febbraio","fev","fevereiro"],2:["mar","mär","march","mrz","märz","mars","mars","marzo","marzo","março"],3:["apr","april","apr","april","avr","avril","abr","abril","aprile"],4:["may","mai","mayo","mag","maggio","maio","maj"],5:["jun","june","juni","juin","junio","giu","giugno","junho"],6:["jul","july","juli","juil","juillet","julio","lug","luglio","julho"],7:["aug","august","août","ago","agosto"],8:["sep","september","sept","septembre","septiembre","set","settembre","setembro"],9:["oct","october","okt","oktober","octobre","octubre","ott","ottobre","out","outubro"],10:["nov","november","november","novembre","noviembre","novembre","novembro"],11:["dec","december","dez","des","dezember","déc","décembre","dic","diciembre","dicembre","desember","dezembro"]},sr={};Xe.each(ar,(function(t,e){Xe.each(t,(function(t){sr[t]=e}))})),or.MMM={parse:new RegExp("("+Xe.flatten(Xe.values(ar)).join("|")+")")},Xe.each(or,(function(t){t.parse=t.parse.source,Xe.isRegExp(t.test)?t.test=t.test.source:t.test=t.parse}));var ur={YYYY:{test:cr(or.YYYY2.test),parse:cr(or.YYYY2.parse),precision:"year"},"YYYY-H":{test:cr(or.YYYY.test,tr,or.H.test),parse:cr(or.YYYY.parse,tr,or.H.parse),precision:"half"},"H-YYYY":{test:cr(or.H.test,er,or.YYYY.test),parse:cr(or.H.parse,er,or.YYYY.parse),precision:"half"},"YYYY-Q":{test:cr(or.YYYY.test,tr,or.Q.test),parse:cr(or.YYYY.parse,tr,or.Q.parse),precision:"quarter"},"Q-YYYY":{test:cr(or.Q.test,er,or.YYYY.test),parse:cr(or.Q.parse,er,or.YYYY.parse),precision:"quarter"},"YYYY-M":{test:cr(or.YYYY.test,ir,or.MM.test),parse:cr(or.YYYY.parse,ir,or.MM.parse),precision:"month"},"M-YYYY":{test:cr(or.MM.test,er,or.YYYY.test),parse:cr(or.MM.parse,er,or.YYYY.parse),precision:"month"},"YYYY-MMM":{test:cr(or.YYYY.test,er,or.MMM.parse),parse:cr(or.YYYY.parse,er,or.MMM.parse),precision:"month"},"MMM-YYYY":{test:cr(or.MMM.parse,er,or.YYYY.test),parse:cr(or.MMM.parse,er,or.YYYY.parse),precision:"month"},"MMM-YY":{test:cr(or.MMM.parse,er,or.YY.test),parse:cr(or.MMM.parse,er,or.YY.parse),precision:"month"},MMM:{test:cr(or.MMM.parse),parse:cr(or.MMM.parse),precision:"month"},"YYYY-WW":{test:cr(or.YYYY.test,tr,or.W.test),parse:cr(or.YYYY.parse,tr,or.W.parse),precision:"week"},"WW-YYYY":{test:cr(or.W.test,er,or.YYYY.test),parse:cr(or.W.parse,er,or.YYYY.parse),precision:"week"},"MM/DD/YYYY":{test:cr(or.MM.test,"([\\-\\/])",or.DD.test,"\\2",or.YYYY.test),parse:cr(or.MM.parse,"([\\-\\/])",or.DD.parse,"\\2",or.YYYY.parse),precision:"day"},"MM/DD/YY":{test:cr(or.MM.test,"([\\-\\/])",or.DD.test,"\\2",or.YY.test),parse:cr(or.MM.parse,"([\\-\\/])",or.DD.parse,"\\2",or.YY.parse),precision:"day"},"DD/MM/YY":{test:cr(or.DD.test,"([\\-\\.\\/ ?])",or.MM.test,"\\2",or.YY.test),parse:cr(or.DD.parse,"([\\-\\.\\/ ?])",or.MM.parse,"\\2",or.YY.parse),precision:"day"},"DD/MM/YYYY":{test:cr(or.DD.test,"([\\-\\.\\/ ?])",or.MM.test,"\\2",or.YYYY.test),parse:cr(or.DD.parse,"([\\-\\.\\/ ?])",or.MM.parse,"\\2",or.YYYY.parse),precision:"day"},"DD/MMM/YYYY":{test:cr(or.DD.test,"([\\-\\.\\/ ?])",or.MMM.test,"\\2",or.YYYY.test),parse:cr(or.DD.parse,"([\\-\\.\\/ ?])",or.MMM.parse,"\\2",or.YYYY.parse),precision:"day"},"DD/MMM/YY":{test:cr(or.DD.test,"([\\-\\.\\/ ?])",or.MMM.test,"\\2",or.YY.test),parse:cr(or.DD.parse,"([\\-\\.\\/ ?])",or.MMM.parse,"\\2",or.YY.parse),precision:"day"},"YYYY-MM-DD":{test:cr(or.YYYY.test,"([\\-\\.\\/ ?])",or.MM.test,"\\2",or.DD.test),parse:cr(or.YYYY.parse,"([\\-\\.\\/ ?])",or.MM.parse,"\\2",or.DD.parse),precision:"day"},"MMM-DD-YYYY":{test:cr(or.MMM.test,er,or.DD.test,rr,or.YYYY.test),parse:cr(or.MMM.parse,er,or.DD.parse,rr,or.YYYY.parse),precision:"day"},"YYYY-WW-d":{test:cr(or.YYYY.test,tr,or.W.test,er,or.DOW.test),parse:cr(or.YYYY.parse,tr,or.W.parse,er,or.DOW.parse),precision:"day"},"MM/DD/YYYY HH:MM":{test:cr(or.MM.test,"([\\-\\/])",or.DD.test,"\\2",or.YYYY.test,nr,or.HHMM.test),parse:cr(or.MM.parse,"([\\-\\/])",or.DD.parse,"\\2",or.YYYY.parse,nr,or.HHMM.parse),precision:"day-minutes"},"DD.MM.YYYY HH:MM":{test:cr(or.DD.test,"([\\-\\.\\/ ?])",or.MM.test,"\\2",or.YYYY.test,nr,or.HHMM.test),parse:cr(or.DD.parse,"([\\-\\.\\/ ?])",or.MM.parse,"\\2",or.YYYY.parse,nr,or.HHMM.parse),precision:"day-minutes"},"YYYY-MM-DD HH:MM":{test:cr(or.YYYY.test,"([\\-\\.\\/ ?])",or.MM.test,"\\2",or.DD.test,nr,or.HHMM.test),parse:cr(or.YYYY.parse,"([\\-\\.\\/ ?])",or.MM.parse,"\\2",or.DD.parse,nr,or.HHMM.parse),precision:"day-minutes"},ISO8601:{test:/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d(\.\d+)?([+-][0-2]\d:[0-5]\d|Z)/,parse:function(t){return t},precision:"day-seconds"}};function cr(){return new RegExp(Qe+Array.prototype.slice.call(arguments).join(" *")+Ze,"i")}function fr(t,e){var r=ur[e];return Xe.isRegExp(r.test)?r.test.test(t):r.test(t,e)}function pr(t,e,r){var n=new Date(Date.UTC(t,0,3));return n.setUTCDate(3-n.getUTCDay()+7*(e-1)+parseInt(r,10)),n}function lr(t,e){return 12!==t?t+("pm"===e?12:0):"am"===e?0:12}var hr={text:function(){return{parse:Xe.identity,errors:function(){return 0},name:function(){return"text"},formatter:function(){return Xe.identity},isValid:function(){return!0},format:function(){}}},number:function(t){var e,r=0,n={"-.":/^ *[-–—−]?[0-9]*(\.[0-9]+)?(e[+-][0-9]+)?%? *$/,"-,":/^ *[-–—−]?[0-9]*(,[0-9]+)?%? *$/,",.":/^ *[-–—−]?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)?%? *$/,".,":/^ *[-–—−]?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)?%? *$/," .":/^ *[-–—−]?[0-9]{1,3}([   ][0-9]{3})*(\.[0-9]+)?%? *$/," ,":/^ *[-–—−]?[0-9]{1,3}([   ][0-9]{3})*(,[0-9]+)?%? *$/,"'.":/^ *[-–—−]?[0-9]{1,3}('[0-9]{3})*(\.[0-9]+)?%? *$/},i={"-.":"1234.56","-,":"1234,56",",.":"1,234.56",".,":"1.234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"," .":"1 234.56"," ,":"1 234,56"},o={na:1,"n/a":1,"-":1,":":1},a={},s=["-.",0];t=t||[],Xe.each(t,(function(t){Xe.each(n,(function(e,r){void 0===a[r]&&(a[r]=0),e.test(t)&&(a[r]+=1,a[r]>s[1]&&(s[0]=r,s[1]=a[r]))}))})),e=s[0];var u={parse:function(t){if(Xe.isNumber(t)||Xe.isUndefined(t)||Xe.isNull(t))return t;var n=t.replace("%","").replace("−","-").replace(/[   ]/g,"").replace("–","-").replace("—","-");return"-"!==e[0]&&(n=n.replace(new RegExp("."===e[0]?"\\.":e[0],"g"),"")),"."!==e[1]&&(n=n.replace(e[1],".")),isNaN(n)||""===n?(o[n.toLowerCase()]||""===n||r++,t):Number(n)},toNum:function(t){return t},fromNum:function(t){return t},errors:function(){return r},name:function(){return"number"},formatter:function(t){var e=t["number-format"]||"-",r=Number(t["number-divisor"]||0),n=(t["number-append"]||"").replace(/ /g," "),i=(t["number-prepend"]||"").replace(/ /g," ");return function(t,o,a){if(isNaN(t))return t;var s=e;if(0!==r&&"-"===s&&(s="n1"),0!==r&&(t=Number(t)/Math.pow(10,r)),"s"===s.substr(0,1)){var u=+s.substr(1);s="n"+Math.max(0,function(t,e){return 0===t?0:Math.round(e-Math.ceil(Math.log(Math.abs(t))/Math.LN10))}(t,u))}return a&&(s="n0"),"-"===s&&(s=Ke(t,Math.round(t))?"n0":Ke(t,.1*Math.round(10*t))?"n1":Ke(t,.01*Math.round(100*t))?"n2":Ke(t,.001*Math.round(1e3*t))?"n3":Ke(t,1e-4*Math.round(1e4*t))?"n4":Ke(t,1e-5*Math.round(1e5*t))?"n5":"n6"),t=Globalize.format(t,"-"!==s?s:null),o?i+t+n:t}},isValid:function(t){return""===t||o[String(t).toLowerCase()]||Xe.isNumber(u.parse(t))},ambiguousFormats:function(){var t=[];return Xe.each(a,(function(e,r){e===s[1]&&t.push([r,i[r]])})),t},format:function(t){return arguments.length?(e=t,u):e}};return u},date:function(t){var e,r=0,n={},i=["",0];t=t||[],Xe.each(ur,(function(e,r){Xe.each(t,(function(t){void 0===n[r]&&(n[r]=0),fr(t,r)&&(n[r]+=1,n[r]>i[1]&&(i[0]=r,i[1]=n[r]))}))})),e=i[0];var o={parse:function(t){if(Xe.isDate(t)||Xe.isUndefined(t))return t;if(!e||!Xe.isString(t))return r++,t;var n,i,o,a=(n=t.toLowerCase(),o=ur[i=e],Xe.isRegExp(o.parse)?n.match(o.parse):o.parse(n,i));if(!a)return r++,t;function s(t){return(t=+t)<30?2e3+t:1900+t}fr(t,e)||r++;var u=(new Date).getFullYear();switch(e){case"YYYY":return new Date(a[1],0,1);case"YYYY-H":return new Date(a[1],6*(a[2]-1),1);case"H-YYYY":return new Date(a[2],6*(a[1]-1),1);case"YYYY-Q":return new Date(a[1],3*(a[2]-1),1);case"Q-YYYY":return new Date(a[2],3*(a[1]-1),1);case"YYYY-M":return new Date(a[1],a[2]-1,1);case"M-YYYY":return new Date(a[2],a[1]-1,1);case"YYYY-MMM":return new Date(+a[1],sr[a[2]],1);case"MMM-YYYY":return new Date(+a[2],sr[a[1]],1);case"MMM-YY":return new Date(s(+a[2]),sr[a[1]],1);case"MMM":return new Date(u,sr[a[1]],1);case"YYYY-WW":return pr(a[1],a[2],1);case"WW-YYYY":return pr(a[2],a[1],1);case"YYYY-WW-d":return pr(a[1],a[2],a[3]);case"YYYY-MM-DD":return new Date(a[1],a[3]-1,a[4]);case"DD/MM/YYYY":return new Date(a[4],a[3]-1,a[1]);case"DD/MMM/YYYY":return new Date(a[4],sr[a[3]],a[1]);case"DD/MMM/YY":return new Date(s(a[4]),sr[a[3]],a[1]);case"MM/DD/YYYY":return new Date(a[4],a[1]-1,a[3]);case"MM/DD/YY":return new Date(s(a[4]),a[1]-1,a[3]);case"DD/MM/YY":return new Date(s(a[4]),a[3]-1,a[1]);case"MMM-DD-YYYY":return new Date(a[3],sr[a[1]],a[2]);case"YYYY-MM-DD HH:MM":return new Date(+a[1],a[3]-1,+a[4],lr(+a[5],a[8]),+a[6]||0,+a[7]||0);case"DD.MM.YYYY HH:MM":return new Date(+a[4],a[3]-1,+a[1],lr(+a[5],a[8]),+a[6]||0,+a[7]||0);case"MM/DD/YYYY HH:MM":return new Date(+a[4],a[1]-1,+a[3],lr(+a[5],a[8]),+a[6]||0,+a[7]||0);case"ISO8601":return new Date(a.toUpperCase());default:console.warn("unknown format",e)}return r++,t},toNum:function(t){return Xe.isDate(t)?t.getTime():Number.NaN},fromNum:function(t){return new Date(t)},errors:function(){return r},name:function(){return"date"},format:function(t){return arguments.length?(e=t,o):e},precision:function(){return ur[e].precision},formatter:function(){if(!e)return Xe.identity;var t=Globalize.culture().calendar.patterns.M.replace("MMMM","MMM");switch(ur[e].precision){case"year":return function(t){return Xe.isDate(t)?t.getFullYear():t};case"half":return function(t){return Xe.isDate(t)?t.getFullYear()+" H"+(t.getMonth()/6+1):t};case"quarter":return function(t){return Xe.isDate(t)?t.getFullYear()+" Q"+(t.getMonth()/3+1):t};case"month":return function(t){return Xe.isDate(t)?Globalize.format(t,"MMM yy"):t};case"week":return function(t){return Xe.isDate(t)?function(t){var e=t.getUTCDay(),r=new Date(t.valueOf());r.setDate(r.getDate()-(e+6)%7+3);var n=r.getUTCFullYear(),i=Math.floor((r.getTime()-new Date(n,0,1,-6))/864e5);return[n,1+Math.floor(i/7),e>0?e:7]}(t).slice(0,2).join(" W"):t};case"day":return function(t,e){return Xe.isDate(t)?Globalize.format(t,e?"D":"d"):t};case"day-minutes":return function(e){return Xe.isDate(e)?Globalize.format(e,t).replace(" ","&nbsp;")+" - "+Globalize.format(e,"t").replace(" ","&nbsp;"):e};case"day-seconds":return function(t){return Xe.isDate(t)?Globalize.format(t,"T").replace(" ","&nbsp;"):t}}},isValid:function(t){return Xe.isDate(o.parse(t))},ambiguousFormats:function(){var t=[];return Xe.each(n,(function(e,r){e===i[1]&&t.push([r,r])})),t}};return o}},vr=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,dr=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;function mr(t,e){if(null===t)return null;if(void 0!==t){if((t=String(t)).indexOf("<")<0||t.indexOf(">")<0)return t;if(t=function(t,e){e=(((void 0!==e?e||"":"<a><span><b><br><br/><i><strong><sup><sub><strike><u><em><tt>")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var r=t,n=t;for(;;)if(n=(r=n).replace(dr,"").replace(vr,(function(t,r){return e.indexOf("<"+r.toLowerCase()+">")>-1?t:""})),r===n)return n}(t,e),"undefined"==typeof document)return t;var r=document.createElement("div");r.innerHTML=t;for(var n=r.querySelectorAll("*"),i=0;i<n.length;i++){"a"===n[i].nodeName.toLowerCase()&&("_self"!==n[i].getAttribute("target")&&n[i].setAttribute("target","_blank"),n[i].setAttribute("rel","nofollow noopener noreferrer"),n[i].getAttribute("href")&&n[i].getAttribute("href").trim().startsWith("javascript:")&&n[i].setAttribute("href",""));for(var o=0;o<n[i].attributes.length;o++){var a=n[i].attributes[o];a.specified&&"on"===a.name.substr(0,2)&&n[i].removeAttribute(a.name)}}return r.innerHTML}}function yr(t,e,r){function n(t){return null!=t&&""!==t}var i,o,a=Xe.shuffle(Xe.range(e.length)).filter((function(t){return n(e[t])})).slice(0,200).map((function(t){return e[t]}));r=r?hr[r](a):function(t){if(Xe.every(e,Xe.isNumber))return hr.number();if(Xe.every(e,Xe.isDate))return hr.date();var r,i=[hr.date(t),hr.number(t),hr.text()],o=.1*e.filter(n).length;return Xe.each(e,(function(t){Xe.each(i,(function(e){e.parse(t)}))})),Xe.every(i,(function(t){return t.errors()<o&&(r=t),!r})),Xe.isUndefined(r)&&(r=i[2]),r}(a);var s,u=e.slice(0),c={name:function(){return arguments.length?(t=arguments[0],c):mr(t)},title:function(){return arguments.length?(s=arguments[0],c):mr(s||t)},length:e.length,val:function(t,n){if(arguments.length){var i=n?u:e;return t<0&&(t+=i.length),r.parse(Xe.isDate(i[t])||Xe.isNumber(i[t])?i[t]:mr(i[t]))}},values:function(t){var n=t?u:e;return n=Xe.map(n,(function(t){return Xe.isDate(t)||Xe.isNumber(t)?t:mr(t)})),Xe.map(n,r.parse)},each:function(t){for(var r=0;r<e.length;r++)t(c.val(r),r)},raw:function(t,r){return arguments.length?2===arguments.length?(e[t]=r,c):Xe.isDate(e[t])||Xe.isNumber(e[t])?e[t]:mr(e[t]):e.map((function(t){return Xe.isDate(t)||Xe.isNumber(t)?t:mr(t)}))},type:function(t){if(!0===t)return r;if(Xe.isString(t)){if(hr[t])return r=hr[t](a),c;throw new Error("unknown column type: "+t)}return r.name()},range:function(){return!!r.toNum&&(i||(i=[Number.MAX_VALUE,-Number.MAX_VALUE],c.each((function(t){t=r.toNum(t),Xe.isNumber(t)&&!Xe.isNaN(t)&&(t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t))})),i[0]=r.fromNum(i[0]),i[1]=r.fromNum(i[1])),i)},total:function(){return!!r.toNum&&(o||(o=0,c.each((function(t){o+=r.toNum(t)})),o=r.fromNum(o)),o)},filterRows:function(t){return e=[],arguments.length?Xe.each(t,(function(t){e.push(u[t])})):e=u.slice(0),c.length=e.length,i=o=!1,c},toString:function(){return t+" ("+r.name()+")"},indexOf:function(t){return Xe.find(Xe.range(e.length),(function(e){return c.val(e)===t}))},limitRows:function(t){u.length>t&&(u.length=t,e.length=t,c.length=t)}};return c}function gr(t){return{dataset:function(){if(t.url){var e=(new Date).getTime(),r="".concat(t.url).concat(t.url.indexOf("?")>-1?"&":"?","v=").concat(t.url.indexOf("//static.dwcdn.net")>-1?e-e%6e4:e);return window.fetch(r).then((function(t){return t.text()})).then((function(e){return new Mr(t).parse(e)}))}if(t.csv||""===t.csv)return new Promise((function(e){e(t.csv)})).then((function(e){return new Mr(t).parse(e)}));throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return new Mr(t).parse(t.csv)}}}Je.delimited=gr;var Mr=function(){function e(r){t(this,e),r=Object.assign({delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:!1,firstRowIsHeader:!0},r),this.__delimiterPatterns=Yr(r.delimiter,r.quoteChar),this.opts=r}return r(e,[{key:"parse",value:function(t){this.__rawData=t;var e=this.opts;"auto"===e.delimiter&&(e.delimiter=this.guessDelimiter(t,e.skipRows),this.__delimiterPatterns=Yr(e.delimiter,e.quoteChar));var r,n="|"!==e.delimiter?"|":"#";return t=n+"\n"+t.replace(/[ \r\n\f]+$/g,"")+n,r=function(t,e,r){r=r||",";for(var i,o=[[]],a=null;a=t.exec(e);){var s=a[1];s.length&&s!==r&&o.push([]),i=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],o[o.length-1].push(void 0===i?"":i)}o[0][0].substr(0,1)===n&&(o[0][0]=o[0][0].substr(1));var u=o.length-1,c=o[u].length-1,f=o[u][c].length-1;return o[u][c].substr(f)===n&&(o[u][c]=o[u][c].substr(0,f)),o.slice(1)}(this.__delimiterPatterns,t,e.delimiter),e.transpose&&(r=function(t){var e,r,n=t,i=n.length?n.length:0,o=n[0]instanceof Array?n[0].length:0;if(0===o||0===i)return[];var a=[];for(e=0;e<o;e++)for(a[e]=[],r=0;r<i;r++)a[e][r]=n[r][e];return a}(r)),function(t){var r=[],n={},i=t.length,o=t[0].length,a=e.skipRows,s=[];e.firstRowIsHeader&&(s=t[a],a++);for(var u=0;u<o;u++){var c=Xe.isString(s[u])?s[u].replace(/^\s+|\s+$/g,""):"",f=""!==c?"":1;for(c=""!==c?c:"X.";void 0!==n[c+f];)f=""===f?1:f+1;r.push({name:c+f,data:[]}),n[c+f]=!0}return Xe.range(a,i).forEach((function(n){r.forEach((function(r,i){r.data.push(""!==t[n][i]?t[n][i]:e.emptyValue)}))})),Je(r=r.map((function(t){return yr(t.name,t.data)})))}(r)}},{key:"guessDelimiter",value:function(t){var e=0,r=-1,n=this,i=["\t",";","|",","];return i.forEach((function(i,o){var a=Yr(i,n.quoteChar),s=t.match(a).length;"\t"===i&&(s*=1.15),s>e&&(e=s,r=o)})),i[r]}}]),e}();function Yr(t,e){return new RegExp("(\\"+t+"|\\r?\\n|\\r|^)(?:"+e+"([^"+e+"]*(?:"+e+'"[^'+e+"]*)*)"+e+"|([^"+e+"\\"+t+"\\r\\n]*))","gi")}function wr(t){return{dataset:function(){if(t.url)return fetch(t.url).then((function(t){return t.text()})).then((function(t){return JSON.parse(t)}));if(t.csv)return new Promise((function(e){e(t.csv)})).then((function(t){return JSON.parse(t)}));throw new Error("you need to provide either an URL or CSV data.")},parse:function(){return JSON.parse(t.csv)}}}function br(t,e){var r=t.getMetadata("data.column-order",[]);return r.length&&r.length===e.numColumns()&&e.columnOrder(r),e}function Er(t,e){var r=t.getMetadata("data.changes",[]),n=t.getMetadata("data.transpose",!1);r.forEach((function(t){var r="row",i="column";if(n&&(r="column",i="row"),e.hasColumn(t[i]))if(t.ignored=!1,0===t[r]){if(t.previous&&"undefined"!==t.previous)if(e.column(t[i]).title()!==t.previous)return;e.column(t[i]).title(t.value)}else{if(t.previous&&"undefined"!==t.previous)if(e.column(t[i]).raw(t[r]-1)!==t.previous)return;e.column(t[i]).raw(t[r]-1,t.value)}}));var i=t.getMetadata("data.column-format",{});return Xe.each(i,(function(t,r){t.type&&e.hasColumn(r)&&"auto"!==t.type&&e.column(r).type(t.type),t["input-format"]&&e.hasColumn(r)&&e.column(r).type(!0).format(t["input-format"])})),e}Je.json=wr;var Ar=function(t){if(Array.isArray(t))return t};var xr=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}};var Or=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var Dr=function(t,e){return Ar(t)||xr(t,e)||p(t,e)||Or()};function Nr(t){return t.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/-/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/^(and|or|in|true|false)$/,"$1_")}function Tr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return t;for(var n=e.split("."),i=t,o=0;o<n.length&&null!=i;o++)i=i[n[o]];return null==i?r:i}var Sr=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}},Cr=n((function(t){function e(r,n,i){return Sr()?t.exports=e=Reflect.construct:t.exports=e=function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&u(i,r.prototype),i},e.apply(null,arguments)}t.exports=e})),_r="TOP",Ir="TPAREN";function Rr(t,e,r){this.type=t,this.value=e,this.index=r}function kr(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}Rr.prototype.toString=function(){return this.type+": "+this.value},kr.prototype.newToken=function(t,e,r){return new Rr(t,e,null!=r?r:this.pos)},kr.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},kr.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},kr.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},kr.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var n=this.expression.indexOf(r,e+1);n>=0&&this.pos<this.expression.length;){if(this.pos=n+1,"\\"!==this.expression.charAt(n-1)){var i=this.expression.substring(e+1,n);this.current=this.newToken("TSTRING",this.unescape(i),e),t=!0;break}n=this.expression.indexOf(r,n+1)}return t},kr.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(Ir,t),this.pos++,!0)},kr.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken("TBRACKET",t),this.pos++,!0)},kr.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,!0)},kr.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken("TSEMICOLON",";"),this.pos++,!0)},kr.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var n=this.expression.substring(t,e);if(n in this.consts)return this.current=this.newToken("TNUMBER",this.consts[n]),this.pos+=n.length,!0}return!1},kr.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var n=this.expression.substring(t,e);if(this.isOperatorEnabled(n)&&(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps))return this.current=this.newToken(_r,n),this.pos+=n.length,!0}return!1},kr.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var n=this.expression.charAt(e);if(n.toUpperCase()===n.toLowerCase()){if(e===this.pos&&("$"===n||"_"===n)){"_"===n&&(r=!0);continue}if(e===this.pos||!r||"_"!==n&&(n<"0"||n>"9"))break}else r=!0}if(r){var i=this.expression.substring(t,e);return this.current=this.newToken("TNAME",i),this.pos+=i.length,!0}return!1},kr.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var jr=/^[0-9a-f]{4}$/i;kr.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var n=t.charAt(++e);switch(n){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var i=t.substring(e+1,e+5);jr.test(i)||this.parseError("Illegal escape sequence: \\u"+i),r+=String.fromCharCode(parseInt(i,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++e;var o=t.indexOf("\\",e);r+=t.substring(e,o<0?t.length:o),e=o}return r},kr.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},kr.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var n=!1,i=r;r<this.expression.length;){var o=this.expression.charAt(r);if(!e.test(o))break;r++,n=!0}return n&&(this.current=this.newToken("TNUMBER",parseInt(this.expression.substring(i,r),t)),this.pos=r),n},kr.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,n=r,i=r,o=!1,a=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!o&&"."===t);)"."===t?o=!0:a=!0,r++,e=a;if(e&&(i=r),"e"===t||"E"===t){r++;for(var s=!0,u=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!s||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;u=!0,s=!1}else s=!1;r++}u||(r=i)}return e?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(n,r))),this.pos=r):this.pos=i,e},kr.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(_r,e);else if("∙"===e||"•"===e)this.current=this.newToken(_r,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(_r,">="),this.pos++):this.current=this.newToken(_r,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(_r,"<="),this.pos++):this.current=this.newToken(_r,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(_r,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(_r,"=="),this.pos++):this.current=this.newToken(_r,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(_r,"!="),this.pos++):this.current=this.newToken(_r,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},kr.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},kr.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},kr.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)};var Lr="IEXPR";function Pr(t,e){this.type=t,this.value=null!=e?e:0}function Ur(t){return new Pr("IOP1",t)}function Fr(t){return new Pr("IOP2",t)}function Hr(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}Pr.prototype.toString=function(){switch(this.type){case"INUMBER":case"IOP1":case"IOP2":case"IOP3":case"IVAR":case"IVARNAME":case"IENDSTATEMENT":return this.value;case"IFUNCALL":return"CALL "+this.value;case"IFUNDEF":return"DEF "+this.value;case"IARRAY":return"ARRAY "+this.value;case"IMEMBER":return"."+this.value;default:return"Invalid Instruction"}},Hr.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},Hr.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}(e,t.value):"function"==typeof e?e(t):t.value===e)},Hr.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},Hr.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},Hr.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},Hr.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},Hr.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;if(this.accept("TNAME")||this.accept(_r,(function(t){return t.value in e})))t.push(new Pr("IVAR",this.current.value));else if(this.accept("TNUMBER"))t.push(new Pr("INUMBER",this.current.value));else if(this.accept("TSTRING"))t.push(new Pr("INUMBER",this.current.value));else if(this.accept(Ir,"("))this.parseExpression(t),this.expect(Ir,")");else{if(!this.accept("TBRACKET","["))throw new Error("unexpected "+this.nextToken);if(this.accept("TBRACKET","]"))t.push(new Pr("IARRAY",0));else{var r=this.parseArrayList(t);t.push(new Pr("IARRAY",r))}}},Hr.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},Hr.prototype.pushExpression=function(t,e){for(var r=0,n=e.length;r<n;r++)t.push(e[r])},Hr.prototype.parseUntilEndStatement=function(t,e){return!!this.accept("TSEMICOLON")&&(!this.nextToken||"TEOF"===this.nextToken.type||this.nextToken.type===Ir&&")"===this.nextToken.value||e.push(new Pr("IENDSTATEMENT")),"TEOF"!==this.nextToken.type&&this.parseExpression(e),t.push(new Pr(Lr,e)),!0)},Hr.prototype.parseArrayList=function(t){for(var e=0;!this.accept("TBRACKET","]");)for(this.parseExpression(t),++e;this.accept("TCOMMA");)this.parseExpression(t),++e;return e},Hr.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(_r,"=");){var e=t.pop(),r=[],n=t.length-1;if("IFUNCALL"!==e.type){if("IVAR"!==e.type&&"IMEMBER"!==e.type)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new Pr("IVARNAME",e.value)),t.push(new Pr(Lr,r)),t.push(Fr("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var i=0,o=e.value+1;i<o;i++){var a=n-i;"IVAR"===t[a].type&&(t[a]=new Pr("IVARNAME",t[a].value))}this.parseVariableAssignmentExpression(r),t.push(new Pr(Lr,r)),t.push(new Pr("IFUNDEF",e.value))}}},Hr.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(_r,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(_r,":"),this.parseConditionalExpression(r),t.push(new Pr(Lr,e)),t.push(new Pr(Lr,r)),t.push(new Pr("IOP3","?"))}},Hr.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(_r,"or");){var e=[];this.parseAndExpression(e),t.push(new Pr(Lr,e)),t.push(Fr("or"))}},Hr.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(_r,"and");){var e=[];this.parseComparison(e),t.push(new Pr(Lr,e)),t.push(Fr("and"))}};var Br=["==","!=","<","<=",">=",">","in"];Hr.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(_r,Br);){var e=this.current;this.parseAddSub(t),t.push(Fr(e.value))}};var Vr=["+","-","||"];Hr.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(_r,Vr);){var e=this.current;this.parseTerm(t),t.push(Fr(e.value))}};var Wr=["*","/","%"];function zr(t,e){return Number(t)+Number(e)}function Gr(t,e){return t-e}function $r(t,e){return t*e}function qr(t,e){return t/e}function Xr(t,e){return t%e}function Jr(t,e){return t===e}function Kr(t,e){return t!==e}function Qr(t,e){return t>e}function Zr(t,e){return t<e}function tn(t,e){return t>=e}function en(t,e){return t<=e}function rn(t,e){return Boolean(t&&e)}function nn(t,e){return Boolean(t||e)}function on(t){return Math.log(t)*Math.LOG10E}function an(t){return-t}function sn(t){return!t}function un(t){return t<0?Math.ceil(t):Math.floor(t)}function cn(t){return Math.random()*(t||1)}function fn(t){return Array.isArray(t)?t.length:String(t).length}function pn(t,e,r){return t?e:r}function ln(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function hn(t,e){return t[0|e]}function vn(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function dn(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function mn(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}function yn(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,n){return t(e,r,n)}),e)}function gn(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,r){return t(e,r)}))}function Mn(t){return(t>0)-(t<0)||+t}function Yn(t){return Math.log(1+t)}function wn(t){return Math.log(t)/Math.LN2}function bn(t){if(!Array.isArray(t))throw new Error("Sum argument is not an array");return t.reduce((function(t,e){return t+Number(e)}),0)}function En(t,e,r){var n,i,o,a,s,u,c=[];if(xn(t))return On(t,r);for(var f=t.length,p=0;p<f;p++){var l=t[p],h=l.type;if("INUMBER"===h||"IVARNAME"===h)c.push(l.value);else if("IOP2"===h)i=c.pop(),n=c.pop(),"and"===l.value?c.push(!!n&&!!En(i,e,r)):"or"===l.value?c.push(!!n||!!En(i,e,r)):"="===l.value?(a=e.binaryOps[l.value],c.push(a(n,En(i,e,r),r))):(a=e.binaryOps[l.value],c.push(a(On(n,r),On(i,r))));else if("IOP3"===h)o=c.pop(),i=c.pop(),n=c.pop(),"?"===l.value?c.push(En(n?i:o,e,r)):(a=e.ternaryOps[l.value],c.push(a(On(n,r),On(i,r),On(o,r))));else if("IVAR"===h)if(l.value in e.functions)c.push(e.functions[l.value]);else if(l.value in e.unaryOps&&e.parser.isOperatorEnabled(l.value))c.push(e.unaryOps[l.value]);else{var v=r[l.value];if(void 0===v)throw new Error("undefined variable: "+l.value);c.push(v)}else if("IOP1"===h)n=c.pop(),a=e.unaryOps[l.value],c.push(a(On(n,r)));else if("IFUNCALL"===h){for(u=l.value,s=[];u-- >0;)s.unshift(On(c.pop(),r));if(!(a=c.pop()).apply||!a.call)throw new Error(a+" is not a function");c.push(a.apply(void 0,s))}else if("IFUNDEF"===h)c.push(function(){for(var t=c.pop(),n=[],i=l.value;i-- >0;)n.unshift(c.pop());var o=c.pop(),a=function(){for(var i=Object.assign({},r),o=0,a=n.length;o<a;o++)i[n[o]]=arguments[o];return En(t,e,i)};return Object.defineProperty(a,"name",{value:o,writable:!1}),r[o]=a,a}());else if(h===Lr)c.push(An(l,e));else if("IEXPREVAL"===h)c.push(l);else if("IMEMBER"===h)n=c.pop(),c.push(n[l.value]);else if("IENDSTATEMENT"===h)c.pop();else{if("IARRAY"!==h)throw new Error("invalid Expression");for(u=l.value,s=[];u-- >0;)s.unshift(c.pop());c.push(s)}}if(c.length>1)throw new Error("invalid Expression (parity)");return 0===c[0]?0:On(c[0],r)}function An(t,e,r){return xn(t)?t:{type:"IEXPREVAL",value:function(r){return En(t.value,e,r)}}}function xn(t){return t&&"IEXPREVAL"===t.type}function On(t,e){return xn(t)?t.value(e):t}function Dn(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}function Nn(t){return t.trim()}function Tn(t){this.options=t||{},this.unaryOps={SIN:Math.sin,COS:Math.cos,TAN:Math.tan,ASIN:Math.asin,ACOS:Math.acos,ATAN:Math.atan,SQRT:Math.sqrt,LOG:Math.log,LOG2:Math.log2||wn,LN:Math.log,LG:Math.log10||on,LOG10:Math.log10||on,LOG1P:Math.log1p||Yn,ABS:Math.abs,CEIL:Math.ceil,TRIM:Nn,FLOOR:Math.floor,ISNULL:function(t){return null===t},TRUNC:Math.trunc||un,"-":an,"+":Number,EXP:Math.exp,NOT:sn,LENGTH:fn,"!":sn,SIGN:Math.sign||Mn,TEXT:function(t){return e(t)?t.toISOString():String(t)},NUMBER:Number},this.binaryOps={"+":zr,"-":Gr,"*":$r,"/":qr,"%":Xr,"^":Math.pow,"==":Jr,"!=":Kr,">":Qr,"<":Zr,">=":tn,"<=":en,and:rn,or:nn,in:function(t,e){return Array.isArray(e)?e.includes(t):String(e).includes(t)},"[":hn},this.ternaryOps={"?":pn};var e=function(t){return t instanceof Date&&!isNaN(t)},r=function(t){if(e(t))return t;try{var r=new Date(t);return e(r)?r:null}catch(t){return null}};function n(t){return(1===arguments.length&&Array.isArray(t)?t:Array.from(arguments)).slice(0).filter((function(t){return!isNaN(t)&&Number.isFinite(t)}))}var i=/\w*/g,o=/\w\S*/g;try{i=new RegExp("\\p{L}*","ug"),o=new RegExp("[\\p{L}\\p{N}]\\S*","ug")}catch(t){}this.functions={IF:pn,RANDOM:cn,MIN:function(){var t=n.apply(this,arguments);return dn(t)},MAX:function(){return vn(n.apply(this,arguments))},SUM:function(){return bn(n.apply(this,arguments))},MEAN:function(){var t=n.apply(this,arguments);return bn(t)/t.length},MEDIAN:function(){var t=n.apply(this,arguments).sort((function(t,e){return t-e})),e=Math.floor(t.length/2);return t.length%2==1?t[e]:.5*(t[e-1]+t[e])},POW:Math.pow,ATAN2:Math.atan2,ROUND:ln,CONCAT:function(){return Array.from(arguments).join("")},TRIM:Nn,SUBSTR:function(t,e,r){return t.substr(e,r)},REPLACE:function(t,e,r){return t.replace(e,r)},SPLIT:function(t,e){return String(t).split(e)},LOWER:function(t){return String(t).toLowerCase()},UPPER:function(t){return String(t).toUpperCase()},PROPER:function(t){return String(t).replace(i,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}))},TITLE:function(t){return String(t).replace(o,(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}))},SORT:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Array.isArray(t))throw new Error("First argument to SORT is not an array");return t.slice(0).sort((function(t,n){return((t="string"==typeof r?t[r]:"function"==typeof r?r(t):t)>(n="string"==typeof r?n[r]:"function"==typeof r?r(n):n)?1:t<n?-1:0)*(e?1:-1)}))},SLICE:function(t,e,r){if(!Array.isArray(t))throw new Error("First argument to SLICE is not an array");return t.slice(e,r)},JOIN:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Array.isArray(t))throw new Error("First argument to JOIN is not an array");return r?[t.slice(0,t.length-1).join(e),t[t.length-1]].join(r):t.join(e)},MAP:mn,FOLD:yn,FILTER:gn,PLUCK:function(t,e){if(!Array.isArray(t))throw new Error("First argument to PLUCK is not an array");return t.map((function(t){return t[e]}))},INDEXOF:function(t,e){return Array.isArray(t)||(t=String(t)),t.indexOf(e)},RANGE:function(t,e,r){null==e&&(e=t||0,t=0),r||(r=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/r),0),i=Array(n),o=0;o<n;o++,t+=r)i[o]=t;return i},FIND:function(t,e){if(!Array.isArray(t))throw new Error("First argument to FIND is not an array");if("function"!=typeof e)throw new Error("Second argument to FIND is not a function");for(var r=t.length,n=0;n<r;n++)if(e(t[n]))return t[n];return null},EVERY:function(t,e){if(!Array.isArray(t))throw new Error("First argument to EVERY is not an array");if("function"!=typeof e)throw new Error("Second argument to EVERY is not a function");for(var r=t.length,n=!0,i=0;i<r;i++)if(!(n=n&&e(t[i])))return!1;return!0},SOME:function(t,e){if(!Array.isArray(t))throw new Error("First argument to SOME is not an array");if("function"!=typeof e)throw new Error("Second argument to SOME is not a function");for(var r=t.length,n=!1,i=0;i<r;i++)if(n=n||e(t[i]))return!0;return!1},DATE:function(){return arguments.length>1&&(arguments[1]=arguments[1]-1),Cr(Date,Array.prototype.slice.call(arguments))},YEAR:function(t){return(t=r(t))?t.getFullYear():null},MONTH:function(t){return(t=r(t))?t.getMonth()+1:null},DAY:function(t){return(t=r(t))?t.getDate():null},WEEKDAY:function(t){return(t=r(t))?t.getDay():null},HOURS:function(t){return(t=r(t))?t.getHours():null},MINUTES:function(t){return(t=r(t))?t.getMinutes():null},SECONDS:function(t){return(t=r(t))?t.getSeconds():null},DATEDIFF:function(t,e){return t=r(t),e=r(e),t&&e?(e.getTime()-t.getTime())/864e5:null},TIMEDIFF:function(t,e){return t=r(t),e=r(e),t&&e?(e.getTime()-t.getTime())/1e3:null}},this.consts={E:Math.E,PI:Math.PI,TRUE:!0,FALSE:!1,NA:Number.NaN,NULL:Number.NaN}}Hr.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(_r,Wr);){var e=this.current;this.parseFactor(t),t.push(Fr(e.value))}},Hr.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(_r,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===Ir&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if("TSEMICOLON"===this.nextToken.type||"TCOMMA"===this.nextToken.type||"TEOF"===this.nextToken.type||this.nextToken.type===Ir&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(Ur(r.value))}else this.parseExponential(t)},Hr.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(_r,"^");)this.parseFactor(t),t.push(Fr("^"))},Hr.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(_r,"!");)t.push(Ur("!"))},Hr.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(_r,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(Ur(r.value))}else for(this.parseMemberExpression(t);this.accept(Ir,"(");)if(this.accept(Ir,")"))t.push(new Pr("IFUNCALL",0));else{var n=this.parseArgumentList(t);t.push(new Pr("IFUNCALL",n))}},Hr.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(Ir,")");)for(this.parseExpression(t),++e;this.accept("TCOMMA");)this.parseExpression(t),++e;return e},Hr.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(_r,".")||this.accept("TBRACKET","[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect("TNAME"),t.push(new Pr("IMEMBER",this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect("TBRACKET","]"),t.push(Fr("["))}}},Dn.prototype.evaluate=function(t){return t=t||{},En(this.tokens,this,t)},Dn.prototype.variables=function(){return(this.tokens||[]).filter((function(t){return"IVAR"===t.type})).map((function(t){return t.value}))},Tn.prototype.parse=function(t){var e=[],r=new Hr(this,new kr(this,t),{allowMemberAccess:!0});return r.parseExpression(e),r.expect("TEOF","EOF"),new Dn(e,this)},Tn.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var Sn=new Tn;Tn.parse=function(t){return Sn.parse(t)},Tn.evaluate=function(t,e){return Sn.parse(t).evaluate(e)},Tn.keywords=["ABS","ACOS","ACOSH","and","ASIN","ASINH","ATAN","ATAN2","ATANH","CBRT","CEIL","CONCAT","COS","COSH","DATEDIFF","DAY","E","EVERY","EXP","EXPM1","FIND","FLOOR","HOURS","IF","in","INDEXOF","ISNULL","JOIN","LENGTH","LN","LOG","LOG10","LOG1P","LOG2","LOWER","MAP","MAX","MEAN","MEDIAN","MIN","MINUTES","MONTH","NOT","NOT","or","PI","PLUCK","POW","PROPER","RANDOM","RANGE","REPLACE","ROUND","SECONDS","SIGN","SIN","SINH","SLICE","SOME","SORT","SPLIT","SQRT","SUBSTR","SUM","TAN","TANH","TIMEDIFF","TITLE","TRIM","TRUNC","UPPER","WEEKDAY","YEAR"];var Cn={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",AND:"logical",OR:"logical",NOT:"logical",IN:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function _n(t,e){var r=Tr(t.get(),"metadata.describe.computed-columns",{});Array.isArray(r)||(r=Object.keys(r).reduce((function(t,e){return t.push({name:e,formula:r[e]}),t}),[]));var n=Er(t,e).list(),i={},o={},a=new Tn;e.eachColumn((function(t){if(!t.isComputed)if(i[t.name()]=Nr(t.name()),"number"===t.type()){var e=t.range(),r=Dr(e,2),n=r[0],a=r[1];o[t.name()]={min:n,max:a,sum:p(t.values()),mean:l(t.values()),median:h(t.values())}}else if("date"===t.type()){var s=t.range(),u=Dr(s,2),c=u[0],f=u[1];o[t.name()]={min:c,max:f}}}));var s=r.reduce((function(t,r,n){var i=Nr(r.name);return t.set(i,{name:r.name,index:e.numColumns()+n,key:i,formula:r.formula,visited:0,computed:!1,dependsOn:[]})}),new Map);r.forEach((function(t){var e=t.formula,r=t.name,n=s.get(Nr(r));if(e.trim())try{n.expr=a.parse(e.trim()),n.expr.variables().forEach((function(t){t=t.split("__")[0],s.has(t)&&n.dependsOn.push(s.get(t))}))}catch(t){n.error=t.message}else n.expr={evaluate:function(){return""},variables:function(){return[]}}}));for(var u=[],c=0;s.size&&!(c>1e3);)s.forEach((function(t){c++;try{f(t,[])}catch(e){if(!e.message.startsWith("circular-dependency"))throw e;t.error=e.message,s.delete(t.key),u.push(t)}}));return u.forEach((function(e){if(e.error){var r=yr(e.name,n.map((function(t){return"null"})));r.isComputed=!0,r.formula=e.formula,r.errors=[{message:e.error,row:"all"}],e.column=r}else e.column=function(e){var r=e.formula,a=e.name,s=e.expr,u=e.error,c=e.index,f=[];u&&f.push({row:"all",message:u});var v=Tr(t,"metadata.data.changes",[]).filter((function(t){return t.column===c&&t.row>0})).reduce((function(t,e){var r=t.get(e.row-1);return r&&(e.previous=r.previous),t.set(e.row-1,e),t}),new Map),d=n.map((function(t,e){var r,n={ROWNUMBER:e};Xe.each(t,(function(t,e){i[e]&&(n[i[e]]=t,o[e]&&Object.keys(o[e]).forEach((function(t){n["".concat(i[e],"__").concat(t)]=o[e][t]})))}));try{"function"==typeof(r=s.evaluate(n))&&(f.push({message:"formula returned function",row:e}),r=null)}catch(t){f.push({message:t.message,row:e}),r=null}if(v.has(e)){var a=v.get(e);if(void 0===a.previous||a.previous==r)return a.value}return r}));i[a]=Nr(a),d.forEach((function(t,e){n[e][a]=t}));var m=yr(a,d.map((function(t){return Xe.isBoolean(t)?t?"yes":"no":Xe.isDate(t)?t.toISOString():Xe.isNumber(t)?String(t):Xe.isNull(t)?null:String(t)})));if("number"===m.type()){var y=m.range(),g=Dr(y,2),M=g[0],Y=g[1];o[a]={min:M,max:Y,sum:p(m.values()),mean:l(m.values()),median:h(m.values())}}else if("date"===m.type()){var w=m.range(),b=Dr(w,2),E=b[0],A=b[1];o[a]={min:E,max:A}}return m.isComputed=!0,m.errors=f,m.formula=r,m}(e)})),u.sort((function(t,e){return t.index-e.index})).forEach((function(t){var r=t.column;return e.add(r)})),e;function f(t,e){if(!t.computed){e.push(t.name);for(var r=0;r<e.length-2;r++)if(t.name===e[r])throw new Error("circular-dependency: "+e.join(" ‣ "));t.curIter=c;for(var n=!0,i=0;i<t.dependsOn.length;i++)n=n&&t.dependsOn[i].computed;n?(t.computed=!0,u.push(t),s.delete(t.key)):e.length<10&&t.dependsOn.forEach((function(t){f(t,e.slice(0))}))}}function p(t){var e,r=0,n=t.length,i=-1;if(1===arguments.length)for(;++i<n;)m(e=+t[i])&&(r+=e);return r}function l(t){for(var e,r=0,n=t.length,i=-1,o=n;++i<n;)m(e=d(t[i]))?r+=e:--o;if(o)return r/o}function h(t){var e,r=[],n=t.length,i=-1;if(1===arguments.length)for(;++i<n;)m(e=d(t[i]))&&r.push(e);if(r.length)return v(r.sort(y),.5)}function v(t,e){var r=(t.length-1)*e+1,n=Math.floor(r),i=+t[n-1],o=r-n;return o?i+o*(t[n]-i):i}function d(t){return null===t?NaN:+t}function m(t){return!isNaN(t)}function y(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}}Tn.prototype.isOperatorEnabled=function(t){var e=function(t){return Object.prototype.hasOwnProperty.call(Cn,t)?Cn[t]:t}(t),r=this.options.operators||{};return!(e in r&&!r[e])};var In=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},Rn=n((function(t){function e(r){var n="function"==typeof Map?new Map:void 0;return t.exports=e=function(t){if(null===t||!In(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return Cr(t,arguments,s(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),u(e,t)},e(r)}t.exports=e}));var kn=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i};var jn=function(t,e){if(null==t)return{};var r,n,i=kn(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i},Ln=n((function(t,e){var r;r=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function i(){}function o(e,r,o){if("undefined"!=typeof document){"number"==typeof(o=t({path:"/"},i.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(t){}r=n.write?n.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var u in o)o[u]&&(s+="; "+u,!0!==o[u]&&(s+="="+o[u].split(";")[0]));return document.cookie=e+"="+r+s}}function a(t,r){if("undefined"!=typeof document){for(var i={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),u=s.slice(1).join("=");r||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var c=e(s[0]);if(u=(n.read||n)(u,c)||e(u),r)try{u=JSON.parse(u)}catch(t){}if(i[c]=u,t===c)break}catch(t){}}return t?i[t]:i}}return i.set=o,i.get=function(t){return a(t,!1)},i.getJSON=function(t){return a(t,!0)},i.remove=function(e,r){o(e,"",t(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))},t.exports=r()}));function Pn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Un(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pn(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Fn=new Set(["get","head","options","trace"]);function Hn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.fetch)try{e.fetch=window.fetch}catch(t){throw new Error("Neither options.fetch nor window.fetch is defined.")}if(!e.baseUrl)try{e.baseUrl="//".concat(window.dw.backend.__api_domain)}catch(t){throw new Error("Neither options.baseUrl nor window.dw is defined.")}var r,n=Un({payload:null,raw:!1,method:"GET",mode:"cors",credentials:"include"},e,{headers:Un({"Content-Type":"application/json"},e.headers)}),i=n.payload,o=n.baseUrl,a=n.fetch,s=n.raw,u=jn(n,["payload","baseUrl","fetch","raw"]),c="".concat(o.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));if(i&&(u.body=JSON.stringify(i)),Fn.has(u.method.toLowerCase()))r=a(c,u);else{var f=Ln.get("crumb");f?(u.headers["X-CSRF-Token"]=f,r=a(c,u)):r=Hn("/v3/me",{fetch:a,baseUrl:o}).then((function(){var t=Ln.get("crumb");t&&(u.headers["X-CSRF-Token"]=t)})).catch((function(){})).then((function(){return a(c,u)}))}return r.then((function(t){if(s)return t;if(!t.ok)throw new Wn(t);if(204===t.status||!t.headers.get("content-type"))return t;var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}))}Hn.get=Vn("GET"),Hn.patch=Vn("PATCH");var Bn=Hn.put=Vn("PUT");Hn.post=Vn("POST"),Hn.head=Vn("HEAD");function Vn(t){return function(e,r){if(r&&r.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return Hn(e,Un({},r,{method:t}))}}Hn.delete=Vn("DELETE");var Wn=function(e){function r(e){var n;return t(this,r),(n=a(this,s(r).call(this))).name="HttpReqError",n.status=e.status,n.statusText=e.statusText,n.message="[".concat(e.status,"] ").concat(e.statusText),n.response=e,n}return c(r,e),r}(Rn(Error));var zn=Xe.debounce((function(t,e){var r=t.serialize();Bn("/v3/charts/".concat(r.id),{payload:r}).then((function(){e&&e()})).catch((function(t){console.error("Could not store chart changes",t)}))}),1e3),Gn=Xe.debounce((function(t,e){var r=t.getMetadata("data.json")?JSON.stringify(t.dataset()):t.rawData();Bn("/v3/charts/".concat(t.get().id,"/data"),{body:r,headers:{"Content-Type":"text/csv"}}).then((function(){e&&e()})).catch((function(t){console.error("Could not store chart data",t)}))}),1e3),$n=function(e){function n(){return t(this,n),a(this,s(n).apply(this,arguments))}return c(n,e),r(n,[{key:"load",value:function(t,e){var r=this,n={firstRowIsHeader:this.getMetadata("data.horizontal-header",!0),transpose:this.getMetadata("data.transpose",!1)};return t&&!e?n.csv=t:n.url=e||"data.csv",n.csv&&(this._rawData=n.csv),(this.getMetadata("data.json",!1)?wr(n):gr(n)).dataset().then((function(t){return r.dataset(t),t})).catch((function(t){console.error("could not fetch datasource",t)}))}},{key:"dataset",value:function(t){if(arguments.length){!0!==t&&(this._dataset_cache=t);var e="function"!=typeof t.list;return this._dataset=e?t:br(this,Er(this,_n(this,!0===t?this._dataset_cache:t))),e&&this.set({dataset:t}),this._dataset}return this._dataset}},{key:"theme",value:function(t){return arguments.length?(this.set({theme:t}),this):this.get().theme}},{key:"vis",value:function(t){return arguments.length?(this.set({vis:t}),this):this.get().vis}},{key:"locale",value:function(t,e){return arguments.length&&(this._locale=t=t.replace("_","-"),window.Globalize&&qn(t,e)),this._locale}},{key:"getMetadata",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.get(),n=r.metadata;if(!t)return n;var i=t.split("."),o=n;return Xe.some(i,(function(t){return!(!Xe.isUndefined(o)&&!Xe.isNull(o))||(o=o[t],!1)})),Xe.isUndefined(o)||Xe.isNull(o)?e:o}},{key:"setMetadata",value:function(t,e){var r,n,i=t.split("."),o=i.pop(),a=this.get().metadata,s=a;return i.forEach((function(t){(Xe.isUndefined(s[t])||Xe.isNull(s[t]))&&(s[t]={}),s=s[t]})),r=s[o],n=e,JSON.stringify(r)!==JSON.stringify(n)&&(s[o]=e,this.set({metadata:a})),this}},{key:"store",value:function(t){zn(this,t)}},{key:"storeData",value:function(t){Gn(this,t)}},{key:"serialize",value:function(){var t=this.get(),e={};return["id","title","theme","createdAt","lastModifiedAt","type","metadata","authorId","showInGallery","language","guestSession","lastEditStep","publishedAt","publicUrl","publicVersion","organizationId","forkedFrom","externalData","forkable","isFork","inFolder","author"].forEach((function(r){e[r]=t[r]})),e}},{key:"passiveMode",value:function(){var t=this;this.set({passiveMode:!0}),setTimeout((function(){return t.set({passiveMode:!1})}),100)}},{key:"isPassive",value:function(){return this.get().passiveMode}},{key:"rawData",value:function(){return this._rawData}}]),n}(y);function qn(t,e){Object.prototype.hasOwnProperty.call(window.Globalize.cultures,t)?(window.Globalize.culture(t),"function"==typeof e&&e()):function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;new Promise((function(r,n){var i=document.createElement("script");i.src=t,i.onload=function(){e&&e(),r()},i.onerror=n,document.body.appendChild(i)}))}("/static/vendor/globalize/cultures/globalize.culture.".concat(t,".js"),(function(){window.Globalize.culture(t),"function"==typeof e&&e()}))}return $n.prototype.observeDeep=function(t,e,r){var n=t.replace(/\[(\d+)\]/g,".$1").split("."),o=n[0],a=e.bind(this),s=g(this.get(),n);return r&&!1===r.init||a(s),this.on(r&&r.defer?"update":"state",(function(t){var e=t.changed,r=t.current;t.previous;if(e[o]){var u=g(r,n);u===s&&"object"!==i(u)&&"function"!=typeof u||(a(u,s),s=u)}}))},{Chart:$n}}));
