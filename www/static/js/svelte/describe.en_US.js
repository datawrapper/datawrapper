!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("Handsontable"),require("cm/lib/codemirror"),require("cm/mode/javascript/javascript")):"function"==typeof define&&define.amd?define("svelte/describe",["Handsontable","cm/lib/codemirror","cm/mode/javascript/javascript"],e):t.describe=e(t.HOT,t.CodeMirror)}(this,function(t,e){"use strict";function n(){}function s(t){for(var e,n,s=arguments,a=1,r=arguments.length;a<r;a++)for(e in n=s[a])t[e]=n[e];return t}function a(t,e){e.appendChild(t)}function r(t,e,n){e.insertBefore(t,n)}function o(t){t.parentNode.removeChild(t)}function c(t){return document.createElement(t)}function i(t){return document.createTextNode(t)}function u(t,e,n){t.addEventListener(e,n,!1)}function l(t,e,n){t.removeEventListener(e,n,!1)}function h(t,e,n){t.setAttribute(e,n)}function f(t,e,n){t.style.setProperty(e,n)}function d(){return Object.create(null)}function m(t){this.destroy=n,this.fire("destroy"),this.set=this.get=n,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function p(t,e){return t!==e||t&&"object"==typeof t||"function"==typeof t}function v(t,e,n,s,a){for(var r in e)if(n[r]){var o=s[r],c=a[r],i=e[r];if(i)for(var u=0;u<i.length;u+=1){var l=i[u];l.__calling||(l.__calling=!0,l.call(t,o,c),l.__calling=!1)}}}function _(t){return t?this._state[t]:this._state}function g(t,e){t._observers={pre:d(),post:d()},t._handlers=d(),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=t.root.store||e.store}function w(t,e,n){var s=n&&n.defer?this._observers.post:this._observers.pre;return(s[t]||(s[t]=[])).push(e),n&&!1===n.init||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var n=s[t].indexOf(e);~n&&s[t].splice(n,1)}}}function b(t){for(;t&&t.length;)t.pop()()}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var R={destroy:m,get:_,fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var s=0;s<n.length;s+=1)n[s].call(this,e)},observe:w,on:function(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(s({},t)),this.root._lock||(this.root._lock=!0,b(this.root._beforecreate),b(this.root._oncreate),b(this.root._aftercreate),this.root._lock=!1)},teardown:m,_recompute:n,_set:function(t){var e=this._state,n={},a=!1;for(var r in t)p(t[r],e[r])&&(n[r]=a=!0);a&&(this._state=s({},e,t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(v(this,this._observers.pre,n,this._state,e),this._fragment.p(n,this._state),v(this,this._observers.post,n,this._state,e)))},_mount:function(t,e){this._fragment.m(t,e)},_unmount:function(){this._fragment&&this._fragment.u()}};var C={update:function(){var e=this,n=this.get(),s=n.data,a=n.transpose,r=n.firstRowIsHeader,o=n.skipRows,c=n.hot;if(s){var i=this.store.get("dw_chart"),u=i.dataset(dw.datasource.delimited({csv:s,transpose:a,firstRowIsHeader:r,skipRows:o}).parse()).dataset();this.set({columnOrder:u.columnOrder()});var l=[[]];u.eachColumn(function(t){return l[0].push(t.title())}),u.eachRow(function(t){var e=[];u.eachColumn(function(n){return e.push(n.raw(t))}),l.push(e)}),c.loadData(l),c.updateSettings({cells:function(n,s){return{readOnly:e.get().readonly||u.numColumns()>s&&u.column(s).isComputed&&0===n,renderer:y(e,u,t,{})}},manualColumnMove:[]}),this.set({has_changes:i.get("metadata.data.changes",[]).length>0}),c.render()}},dataChanged:function(t){var e=this,n=this.get().hot,s=!1;t.forEach(function(t){var a=t[0],r=t[1],o=t[2],c=t[3];if(o!=c){var i=e.store.get("dw_chart"),u=e.get().transpose,l=i.get("metadata.data.changes");if(a=n.toPhysicalRow(a),u){var h=a;a=r,r=h}l.push({row:a,column:r,value:c,time:(new Date).getTime()}),i.set("metadata.data.changes",l),s=!0}}),s&&setTimeout(function(){e.update(),chart.save()},100)},columnMoved:function(e,n){var s=this.get().hot;if(e.length){var a=this.get().columnOrder,r=a.slice(0),o=a[n],c=r.splice(e[0],e.length),i=o?r.indexOf(o):r.length;r.splice.apply(r,[i,0].concat(c)),this.store.get("dw_chart").set("metadata.data.column-order",r.slice(0)),this.set({columnOrder:r}),t.hooks.once("afterRender",function(){setTimeout(function(){s.selectCell(0,i,s.countRows()-1,i+c.length-1)},10)}),this.update()}},updateHeight:function(){var t=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;this.refs.hot.style.height=Math.min(400,t+10)+"px"},checkRange:function(t,e,n,s){var a=this.get().hot;if(e!=s||0!==t||n!=a.countRows()-1)this.set({activeColumn:null});else{var r=this.store.get("dw_chart");this.set({activeColumn:r.dataset().column(e)})}}};function y(t,e,n,s){var a={date:"fa fa-clock-o"};return function(s,r,o,c,i,u,l){if(!(e.numColumns()<=c)){var h=e.column(c),f=t.get(),d=f.searchResults,m=f.currentResult,p=f.activeColumn;if((o=s.toPhysicalRow(o))>0)u=chart.columnFormatter(h)(h.val(o-1),!0);parseInt(u)<0&&r.classList.add("negative"),r.classList.add(h.type()+"Type"),"text"==h.type()&&u.length>70&&(u=u.substr(0,60)+"…"),0===o?(r.classList.add("firstRow"),a[h.type()]&&(u='<i class="'+a[h.type()]+'"></i> '+u)):r.classList.add(o%2?"oddRow":"evenRow"),p&&p==h&&r.classList.add("area"),d.forEach(function(t){t.row==o&&t.col==c&&r.classList.add("htSearchResult")}),m&&m.row==o&&m.col==c&&r.classList.add("htCurrentSearchResult"),o>0&&!h.type(!0).isValid(h.val(o-1))&&r.classList.add("parsingError"),l.readOnly&&r.classList.add("readOnly"),chart.dataCellChanged(c,o)&&r.classList.add("changed"),function(t,e,s,a,r,o,c){var i=dw.utils.purifyHtml(n.helper.stringify(o));e.innerHTML=i}(0,r,0,0,0,u)}}}function I(e){g(this,e),this.refs={},this._state=s({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,transpose:!1,activeColumn:null,search:"",searchResults:[]},e.data),this._recompute({searchResults:1,searchIndex:1},this._state);var a,i,u=function(){var e=this,n=new t(this.refs.hot,{data:[],rowHeaders:function(t){return n.getPlugin("ColumnSorting").translateRow(t)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:400,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0},columnSorting:!0,sortIndicator:!0,sortFunction:function(t,e){return function(s,a){var r,o=n.getPlugin("columnSorting");if(0===s[0])return-1;switch(e.type){case"date":r=o.dateSort;break;case"numeric":r=o.numericSort;break;default:r=o.defaultSort}return r(t,e)(s,a)}},search:"search"});window.HT=n,this.set({hot:n}),t.hooks.add("afterSetDataAtCell",function(t){return e.dataChanged(t)}),t.hooks.add("afterColumnMove",function(t,n){return e.columnMoved(t,n)}),t.hooks.add("afterRender",function(){return e.updateHeight()}),t.hooks.add("afterSelection",function(t,n,s,a){return e.checkRange(t,n,s,a)}),this.observe("data",function(){return e.update()}),this.observe("transpose",function(){return e.update()}),this.observe("firstRowIsHeader",function(){return e.update()}),this.observe("search",function(t){var s=n.search.query(t);e.set({searchResults:s}),n.render()}),this.observe("currentResult",function(t){t&&n&&(n.render(),n.scrollViewportTo(t.row,t.col),setTimeout(function(){n.scrollViewportTo(t.row,t.col)},100))})}.bind(this);e.root?this.root._oncreate.push(u):this._oncreate=[u],this._fragment=(this._state,a=this,{c:function(){i=c("div"),this.h()},h:function(){i.id="data-preview"},m:function(t,e){r(i,t,e),a.refs.hot=i},p:n,u:function(){o(i)},d:function(){a.refs.hot===i&&(a.refs.hot=null)}}),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),b(this._oncreate))}s(I.prototype,C,R),I.prototype._recompute=function(t,e){(t.searchResults||t.searchIndex)&&p(e.currentResult,e.currentResult=function(t,e){if(!t||!t.length)return null;var n=t.length;if(e<0||e>=n){for(;e<0;)e+=n;e>n&&(e%=n)}return t[e]}(e.searchResults,e.searchIndex))&&(t.currentResult=!0)};function x(t){h(t,"svelte-3309569136","")}function k(t,e,n,s,h){var f,d,m=n.key;return{c:function(){f=c("li"),d=i(m),this.h()},h:function(){x(f),u(f,"click",H),f._svelte={component:h,metaColumns_1:e,column_index:s}},m:function(t,e){r(f,t,e),a(d,f)},p:function(t,e,n,s,a){t.metaColumns&&m!==(m=s.key)&&(d.data=m),f._svelte.metaColumns_1=n,f._svelte.column_index=a},u:function(){o(f)},d:function(){l(f,"click",H)}}}function H(t){var e=this._svelte.component,n=this._svelte.metaColumns_1[this._svelte.column_index];e.insert(n)}function N(t){g(this,t),this.refs={},this._state=s({},t.data),this._recompute({columns:1},this._state);var n=function(){var t=this,n=e.fromTextArea(this.refs.code,{value:this.get("formula"),mode:"javascript"});this.observe("formula",function(t){t!=n.getValue()&&n.setValue(t)}),n.on("change",function(e){t.set({formula:e.getValue()})}),n.on("focus",function(){t.fire("focus")})}.bind(this);t.root?this.root._oncreate.push(n):this._oncreate=[n],this._fragment=function(t,e){var n,s,h,d,m,p,v,_,g,w,b,R,C,y,I,H,N,S,T,O,L,F,M,P,D=t.column.name(),E=!1;function j(){E=!0,e.set({name:C.value}),E=!1}for(var A=t.metaColumns,V=[],q=0;q<A.length;q+=1)V[q]=k(0,A,A[q],q,e);return{c:function(){n=c("div"),s=c("h3"),h=i('Edit computed column "'),d=i(D),m=i('"'),p=i("\n    "),v=c("p"),_=i("The values for columns can be calculated using a formula, similar to Excel."),g=i("\n\n    "),w=c("label"),b=i("computed columns / modal / name"),R=i("\n    "),C=c("input"),y=i("\n\n    "),I=c("label"),H=i("Formula (JavaScript)"),N=i("\n    "),S=c("textarea"),T=i("\n\n    "),O=c("p"),L=i("Available columns"),F=i(":"),M=i("\n\n    "),P=c("ul");for(var t=0;t<V.length;t+=1)V[t].c();this.h()},h:function(){s.className="first",x(w),u(C,"input",j),C.type="text",x(I),S.className="code",f(O,"margin-top","1em"),x(P),P.className="col-select"},m:function(o,c){r(n,o,c),a(s,n),a(h,s),a(d,s),a(m,s),a(p,n),a(v,n),a(_,v),a(g,n),a(w,n),a(b,w),a(R,n),a(C,n),C.value=t.name,a(y,n),a(I,n),a(H,I),a(N,n),a(S,n),e.refs.code=S,a(T,n),a(O,n),a(L,O),a(F,O),a(M,n),a(P,n);for(var i=0;i<V.length;i+=1)V[i].m(P,null)},p:function(t,n){t.column&&D!==(D=n.column.name())&&(d.data=D),E||(C.value=n.name);var s=n.metaColumns;if(t.metaColumns){for(var a=0;a<s.length;a+=1)V[a]?V[a].p(t,n,s,s[a],a):(V[a]=k(0,s,s[a],a,e),V[a].c(),V[a].m(P,null));for(;a<V.length;a+=1)V[a].u(),V[a].d();V.length=s.length}},u:function(){o(n);for(var t=0;t<V.length;t+=1)V[t].u()},d:function(){l(C,"input",j),e.refs.code===S&&(e.refs.code=null),function(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}(V)}}}(this._state,this),t.target&&(this._fragment.c(),this._fragment.m(t.target,t.anchor||null),b(this._oncreate))}function S(t){g(this,t),this._state=s({},t.data),this._fragment=function(t,e){var n,s,h,d,m;function p(){e.set({value:h.checked})}return{c:function(){n=c("div"),s=c("label"),h=c("input"),d=i(" "),m=i(t.label),this.h()},h:function(){u(h,"change",p),h.type="checkbox",s.className="checkbox",f(s,"text-align","left"),f(s,"width","100%"),f(s,"position","relative"),f(s,"left","0"),n.className="control-group vis-option-group vis-option-type-checkbox"},m:function(e,o){r(n,e,o),a(s,n),a(h,s),h.checked=t.value,a(d,s),a(m,s)},p:function(t,e){h.checked=e.value,t.label&&(m.data=e.label)},u:function(){o(n)},d:function(){l(h,"change",p)}}}(this._state,this),t.target&&(this._fragment.c(),this._fragment.m(t.target,t.anchor||null))}s(N.prototype,{insert:function(t){}},R),N.prototype._recompute=function(t,e){var n;t.columns&&p(e.metaColumns,e.metaColumns=(n=e.columns)?n.map(function(t){return{key:(e=t.name(),e.toString().toLowerCase().replace(/\s+/g,"_").replace(/[^\w-]+/g,"").replace(/-/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").replace(/^(\d)/,"_$1").replace(/(abstract|arguments|await|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|eval|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|let|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|var|void|volatile|while|window|with|yield)/,"$1_")),title:t.title()};var e}):[])&&(t.metaColumns=!0)},s(S.prototype,R);var T={nextResult:function(t){var e=this.get(),n=e.searchIndex,s=e.searchResults;(n+=t)<0&&(n+=s.length),n%=s.length,this.set({searchIndex:n})},keyPress:function(t){"F3"!=t.key&&"Enter"!=t.key||this.nextResult(t.shiftKey?-1:1)},toggleTranspose:function(){this.set({transpose:!this.get("transpose")})},revertChanges:function(){var t=this.store.get("dw_chart");t.set("metadata.data.changes",[]),t.saveSoon(),this.refs.hot.update()},cmFocus:function(){var t=this;setTimeout(function(){t.refs.hot.get("hot").render()},100)}};function O(t){h(t,"svelte-1903720201","")}function L(t,e){var n={},a={};"customColumn"in t&&(a.column=t.customColumn,n.column=!0),"formula"in t&&(a.formula=t.formula,n.formula=!0),"columns"in t&&(a.columns=t.columns,n.columns=!0);var r=new N({root:e.root,data:a,_bind:function(t,a){e.get();var r={};!n.column&&t.column&&(r.customColumn=a.column),!n.formula&&t.formula&&(r.formula=a.formula),!n.columns&&t.columns&&(r.columns=a.columns),n=s({},t),e._set(r),n={}}});return e.root._beforecreate.push(function(){e.get();var t=r.get(),s={};t&&(n.column||(s.customColumn=t.column),n.formula||(s.formula=t.formula),n.columns||(s.columns=t.columns),n={column:!0,formula:!0,columns:!0},e._set(s),n={})}),r.on("focus",function(t){e.cmFocus()}),{c:function(){r._fragment.c()},m:function(t,e){r._mount(t,e)},p:function(t,e){var s={};!n.column&&t.customColumn&&(s.column=e.customColumn,n.column=!0),!n.formula&&t.formula&&(s.formula=e.formula,n.formula=!0),!n.columns&&t.columns&&(s.columns=e.columns,n.columns=!0),r._set(s),n={}},u:function(){r._unmount()},d:function(){r.destroy(!1)}}}function F(t,e){var s,a,c=t.columnFormat.title();return{c:function(){s=i("COLUMN FORMAT FOR "),a=i(c)},m:function(t,e){r(s,t,e),r(a,t,e)},p:function(t,e){t.columnFormat&&c!==(c=e.columnFormat.title())&&(a.data=c)},u:function(){o(s),o(a)},d:n}}function M(t,e){var n,u,l,h,f,d,m,p,v,_,g={},w={label:"First row as label"};"firstRowIsHeader"in t&&(w.value=t.firstRowIsHeader,g.value=!0);var b=new S({root:e.root,data:w,_bind:function(t,n){e.get();var a={};!g.value&&t.value&&(a.firstRowIsHeader=n.value),g=s({},t),e._set(a),g={}}});return e.root._beforecreate.push(function(){e.get();var t=b.get(),n={};t&&(g.value||(n.firstRowIsHeader=t.value),g={value:!0},e._set(n),g={})}),{c:function(){n=c("h3"),u=i("Make sure the data looks right"),l=i("\n\n                "),h=c("p"),f=i("Please make sure that Datawrapper interprets your data correctly. In the table number columns should be shown in blue, dates in green and text in black."),d=i("\n\n                "),b._fragment.c(),m=i("\n\n                [TODO: hook]\n                "),p=c("hr"),v=i("\n\n                "),(_=c("div")).innerHTML='<a class="btn submit" href="upload"><i class="icon-chevron-left"></i> Zurück</a>\n                    <a href="visualize" class="submit btn btn-primary" id="describe-proceed">Weiter <i class="icon-chevron-right icon-white"></i></a>',this.h()},h:function(){n.className="first",_.className="btn-group"},m:function(t,e){r(n,t,e),a(u,n),r(l,t,e),r(h,t,e),a(f,h),r(d,t,e),b._mount(t,e),r(m,t,e),r(p,t,e),r(v,t,e),r(_,t,e)},p:function(t,e){var n={label:"First row as label"};!g.value&&t.firstRowIsHeader&&(n.value=e.firstRowIsHeader,g.value=!0),b._set(n),g={}},u:function(){o(n),o(l),o(h),o(d),b._unmount(),o(m),o(p),o(v),o(_)},d:function(){b.destroy(!1)}}}function P(t,e){var n,s,h,f;function d(t){e.nextResult(-1)}function m(t){e.nextResult(1)}return{c:function(){n=c("div"),(s=c("button")).innerHTML='<i class="fa fa-chevron-up"></i>',h=i("\n                      "),(f=c("button")).innerHTML='<i class="fa fa-chevron-down"></i>',this.h()},h:function(){O(s),s.className="btn",u(s,"click",d),O(f),f.className="btn",u(f,"click",m),n.className="btn-group"},m:function(t,e){r(n,t,e),a(s,n),a(h,n),a(f,n)},u:function(){o(n)},d:function(){l(s,"click",d),l(f,"click",m)}}}function D(t,e){var s,a,c,u,l,h,f,d=t.searchIndexSafe+1,m=t.searchResults.length;return{c:function(){s=i(d),a=i("\n                        "),c=i("of"),u=i("\n                        "),l=i(m),h=i("\n                        "),f=i("results")},m:function(t,e){r(s,t,e),r(a,t,e),r(c,t,e),r(u,t,e),r(l,t,e),r(h,t,e),r(f,t,e)},p:function(t,e){t.searchIndexSafe&&d!==(d=e.searchIndexSafe+1)&&(s.data=d),t.searchResults&&m!==(m=e.searchResults.length)&&(l.data=m)},u:function(){o(s),o(a),o(c),o(u),o(l),o(h),o(f)},d:n}}function E(t,e){var s;return{c:function(){s=i("No matches")},m:function(t,e){r(s,t,e)},p:n,u:function(){o(s)},d:n}}function j(t,e){var n,s=V(t),a=s&&s(t,e);return{c:function(){n=c("div"),a&&a.c(),this.h()},h:function(){O(n),n.className="results"},m:function(t,e){r(n,t,e),a&&a.m(n,null)},p:function(t,r){s===(s=V(r))&&a?a.p(t,r):(a&&(a.u(),a.d()),(a=s&&s(r,e))&&a.c(),a&&a.m(n,null))},u:function(){o(n),a&&a.u()},d:function(){a&&a.d()}}}function A(t){return t.customColumn?L:t.columnFormat?F:M}function V(t){return t.searchResults.length>0?D:t.search?E:null}function q(t){g(this,t),this.refs={},this._state=s({search:"",chartData:"",transpose:!1,firstRowIsHeader:!0,searchIndex:0,activeColumn:!1,customColumn:!1,columnFormat:!1,formula:"",searchResults:[]},t.data),this._recompute({searchIndex:1,searchResults:1,activeColumn:1},this._state);var e=function(){var t=this;window.addEventListener("keypress",function(e){e.ctrlKey&&"f"==e.key&&(e.preventDefault(),t.refs.search!=window.document.activeElement?t.refs.search.focus():t.nextResult(1))});var e=function(e,n){t.observe(e,function(e){t.store.get("dw_chart").set("metadata."+n,e)})};e("transpose","data.transpose"),e("firstRowIsHeader","data.horizontal-header"),this.observe("customColumn",function(e,n){if(e&&e!=n){var s=t.store.get("dw_chart").get("metadata.describe.computed-columns",{});t.set({formula:s[e.name()]||""})}}),this.observe("formula",function(e){var n=t.get().customColumn,s=t.store.get("dw_chart");if(n){var a=s.get("metadata.describe.computed-columns",{});a[n.name()]=e,s.set("metadata.describe.computed-columns",a),s.saveSoon(),t.refs.hot.update()}})}.bind(this);t.root?this.root._oncreate.push(e):(this._oncreate=[e],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(t,e){var n,h,f,d,m,p,v,_,g,w,b,R,C,y,x,k,H,N,S,T,L,F,M,D,E,V,q,$,z,B,K,J,U,W,Z=!1,G={},Q=A(t),X=Q(t,e);function Y(t){e.toggleTranspose()}function tt(){Z=!0,e.set({search:k.value}),Z=!1}function et(t){e.keyPress(t)}var nt=t.searchResults.length>0&&P(0,e),st=t.search&&j(t,e),at={};"chartData"in t&&(at.data=t.chartData,G.data=!0),"transpose"in t&&(at.transpose=t.transpose,G.transpose=!0),"firstRowIsHeader"in t&&(at.firstRowIsHeader=t.firstRowIsHeader,G.firstRowIsHeader=!0),"activeColumn"in t&&(at.activeColumn=t.activeColumn,G.activeColumn=!0),"search"in t&&(at.search=t.search,G.search=!0),"searchResults"in t&&(at.searchResults=t.searchResults,G.searchResults=!0),"searchIndex"in t&&(at.searchIndex=t.searchIndex,G.searchIndex=!0);var rt=new I({root:e.root,data:at,_bind:function(t,n){e.get();var a={};!G.data&&t.data&&(a.chartData=n.data),!G.transpose&&t.transpose&&(a.transpose=n.transpose),!G.firstRowIsHeader&&t.firstRowIsHeader&&(a.firstRowIsHeader=n.firstRowIsHeader),!G.activeColumn&&t.activeColumn&&(a.activeColumn=n.activeColumn),!G.search&&t.search&&(a.search=n.search),!G.searchResults&&t.searchResults&&(a.searchResults=n.searchResults),!G.searchIndex&&t.searchIndex&&(a.searchIndex=n.searchIndex),G=s({},t),e._set(a),G={}}});function ot(t){e.revertChanges()}return e.root._beforecreate.push(function(){e.get();var t=rt.get(),n={};t&&(G.data||(n.chartData=t.data),G.transpose||(n.transpose=t.transpose),G.firstRowIsHeader||(n.firstRowIsHeader=t.firstRowIsHeader),G.activeColumn||(n.activeColumn=t.activeColumn),G.search||(n.search=t.search),G.searchResults||(n.searchResults=t.searchResults),G.searchIndex||(n.searchIndex=t.searchIndex),G={data:!0,transpose:!0,firstRowIsHeader:!0,activeColumn:!0,search:!0,searchResults:!0,searchIndex:!0},e._set(n),G={})}),e.refs.hot=rt,{c:function(){n=c("div"),h=c("div"),f=c("div"),d=c("div"),X.c(),m=i("\n        "),p=c("div"),v=c("button"),_=c("img"),g=i(" "),w=i("Swap rows and columns (transpose)"),b=i("\n\n            "),R=c("div"),C=c("i"),y=i("\n                "),x=c("div"),k=c("input"),N=i("\n                    "),nt&&nt.c(),S=i("\n\n                "),st&&st.c(),T=i("\n\n            "),rt._fragment.c(),L=i("\n\n            "),F=c("div"),M=c("button"),D=c("i"),E=i(" "),V=i("Add column"),q=i("..."),$=i("\n\n                "),z=c("button"),B=c("i"),K=i(" "),J=i("Revert changes"),U=i("..."),this.h()},h:function(){d.className="sidebar",f.className="span4",O(p),O(v),O(_),_.src="/static/css/chart-editor/transpose.png",v.className="btn transpose",u(v,"click",Y),O(R),O(C),C.className="fa fa-search",O(k),u(k,"input",tt),k.type="text",k.placeholder="Search data table",k.className=H=t.searchResults.length>0?"with-results":"",u(k,"keypress",et),x.className="input-append",R.className="search-box pull-right",O(F),D.className="fa fa-calculator",M.className="btn computed-columns",O(z),B.className="fa fa-undo",z.className=W="btn "+(t.has_changes?"":"disabled"),z.id="reset-data-changes",u(z,"click",ot),F.className="buttons below-table pull-right",p.className="span8",h.className="row",n.className="chart-editor"},m:function(s,o){r(n,s,o),a(h,n),a(f,h),a(d,f),X.m(d,null),a(m,h),a(p,h),a(v,p),a(_,v),a(g,v),a(w,v),a(b,p),a(R,p),a(C,R),a(y,R),a(x,R),a(k,x),e.refs.search=k,k.value=t.search,a(N,x),nt&&nt.m(x,null),a(S,R),st&&st.m(R,null),a(T,p),rt._mount(p,null),a(L,p),a(F,p),a(M,F),a(D,M),a(E,M),a(V,M),a(q,M),a($,F),a(z,F),a(B,z),a(K,z),a(J,z),a(U,z)},p:function(t,n){Q===(Q=A(n))&&X?X.p(t,n):(X.u(),X.d(),(X=Q(n,e)).c(),X.m(d,null)),Z||(k.value=n.search),t.searchResults&&H!==(H=n.searchResults.length>0?"with-results":"")&&(k.className=H),n.searchResults.length>0?nt||((nt=P(0,e)).c(),nt.m(x,null)):nt&&(nt.u(),nt.d(),nt=null),n.search?st?st.p(t,n):((st=j(n,e)).c(),st.m(R,null)):st&&(st.u(),st.d(),st=null);var s={};!G.data&&t.chartData&&(s.data=n.chartData,G.data=!0),!G.transpose&&t.transpose&&(s.transpose=n.transpose,G.transpose=!0),!G.firstRowIsHeader&&t.firstRowIsHeader&&(s.firstRowIsHeader=n.firstRowIsHeader,G.firstRowIsHeader=!0),!G.activeColumn&&t.activeColumn&&(s.activeColumn=n.activeColumn,G.activeColumn=!0),!G.search&&t.search&&(s.search=n.search,G.search=!0),!G.searchResults&&t.searchResults&&(s.searchResults=n.searchResults,G.searchResults=!0),!G.searchIndex&&t.searchIndex&&(s.searchIndex=n.searchIndex,G.searchIndex=!0),rt._set(s),G={},t.has_changes&&W!==(W="btn "+(n.has_changes?"":"disabled"))&&(z.className=W)},u:function(){o(n),X.u(),nt&&nt.u(),st&&st.u()},d:function(){X.d(),l(v,"click",Y),l(k,"input",tt),l(k,"keypress",et),e.refs.search===k&&(e.refs.search=null),nt&&nt.d(),st&&st.d(),rt.destroy(!1),e.refs.hot===rt&&(e.refs.hot=null),l(z,"click",ot)}}}(this._state,this),t.target&&(this._fragment.c(),this._fragment.m(t.target,t.anchor||null),this._lock=!0,b(this._beforecreate),b(this._oncreate),b(this._aftercreate),this._lock=!1)}function $(t){this._observers={pre:d(),post:d()},this._changeHandlers=[],this._dependents=[],this._computed=d(),this._sortedComputedProperties=[],this._state=s({},t)}s(q.prototype,T,R),q.prototype._recompute=function(t,e){var n,s,a;(t.searchIndex||t.searchResults)&&p(e.searchIndexSafe,e.searchIndexSafe=(n=e.searchIndex,s=e.searchResults,n<0&&(n+=s.length),n%=s.length))&&(t.searchIndexSafe=!0),t.activeColumn&&(p(e.customColumn,e.customColumn=!(!(a=e.activeColumn)||!a.isComputed)&&a)&&(t.customColumn=!0),p(e.columnFormat,e.columnFormat=function(t){return!(!t||t.isComputed)&&t}(e.activeColumn))&&(t.columnFormat=!0),p(e.columns,e.columns=function(t){if(!t)return[];try{return chart.dataset().columns().filter(function(t){return!t.isComputed})}catch(t){return[]}}(e.activeColumn))&&(t.columns=!0))},s($.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var s=t[n];e["$"+s]=this._state[s]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],s=d();function a(r){if(t[r])throw new Error("Cyclical dependency detected");if(!s[r]){s[r]=!0;var o=e[r];o&&(t[r]=!0,o.deps.forEach(a),n.push(o))}}for(var r in this._computed)t=d(),a(r)},compute:function(t,e,n){var s,a={deps:e,update:function(a,r,o){var c=e.map(function(t){return t in r&&(o=!0),a[t]});if(o){var i=n.apply(null,c);p(i,s)&&(s=i,r[t]=!0,a[t]=s)}}};a.update(this._state,{},!0),this._computed[t]=a,this._sortComputedProperties()},get:_,observe:w,onchange:function(t){return this._changeHandlers.push(t),{cancel:function(){var e=this._changeHandlers.indexOf(t);~e&&this._changeHandlers.splice(e,1)}}},set:function(t){var e=this._state,n=this._changed={},a=!1;for(var r in t){if(this._computed[r])throw new Error("'"+r+"' is a read-only property");p(t[r],e[r])&&(n[r]=a=!0)}if(a){this._state=s({},e,t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,n);for(o=0;o<this._changeHandlers.length;o+=1)this._changeHandlers[o](this._state,n);v(this,this._observers.pre,n,this._state,e);var c=this._dependents.slice();for(o=0;o<c.length;o+=1){var i=c[o],u={};a=!1;for(var l=0;l<i.props.length;l+=1){var h=i.props[l];h in n&&(u["$"+h]=this._state[h],a=!0)}a&&i.component.set(u)}v(this,this._observers.post,n,this._state,e)}}});return{App:q,store:new $({}),data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0}}});
