!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/publish/guest",e):(t=t||self)["publish/guest"]=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n(Object(o),!0).forEach((function(n){e(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function s(t,e,n){return(s=c()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}function u(t){var e="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return s(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),i(r,t)})(t)}function a(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function f(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(){}function p(t,e){for(var n in e)t[n]=e[n];return t}function d(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n)}function m(t){t.parentNode.removeChild(t)}function _(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function v(t){return document.createElement(t)}function b(t){return document.createTextNode(t)}function g(t,e,n,r){t.addEventListener(e,n,r)}function y(t,e,n,r){t.removeEventListener(e,n,r)}function w(t,e,n){t.style.setProperty(e,n)}function O(t,e,n){t.classList[n?"add":"remove"](e)}function j(){return Object.create(null)}function x(e,n){return e!=e?n==n:e!==n||e&&"object"===t(e)||"function"==typeof e}function P(t,e){return t!=t?e==e:t!==e}function T(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var o=n[r];if(!o.__calling)try{o.__calling=!0,o.call(this,e)}finally{o.__calling=!1}}}function E(t){t._lock=!0,L(t._beforecreate),L(t._oncreate),L(t._aftercreate),t._lock=!1}function N(){return this._state}function S(t,e){t._handlers=j(),t._slots=j(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function C(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function L(t){for(;t&&t.length;)t.shift()()}var H={destroy:function(t){this.destroy=l,this.fire("destroy"),this.set=l,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:N,fire:T,on:C,set:function(t){this._set(p({},t)),this.root._lock||E(this.root)},_recompute:l,_set:function(t){var e=this._state,n={},r=!1;for(var o in t=p(this._staged,t),this._staged={},t)this._differs(t[o],e[o])&&(n[o]=r=!0);r&&(this._state=p(p({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_stage:function(t){p(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:x},k={};function M(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"core";"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(k[t]=window.__dw.vis.meta.locale||{}):k[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function q(t){var e=arguments,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core";if(t=t.trim(),k[n]||M(n),!k[n][t])return"MISSING:"+t;var r=k[n][t];return"string"==typeof r&&arguments.length>2&&(r=r.replace(/\$(\d)/g,(function(t,n){return n=2+Number(n),void 0===e[n]?t:e[n]}))),r}function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r({payload:null,raw:!1,method:"GET",baseUrl:"//".concat(dw.backend.__api_domain),mode:"cors",credentials:"include"},e,{headers:r({"Content-Type":"application/json"},e.headers)}),o=n.payload,i=n.baseUrl,c=n.raw,s=a(n,["payload","baseUrl","raw"]),u="".concat(i.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));return o&&(s.body=JSON.stringify(o)),window.fetch(u,s).then((function(t){if(c)return t;if(!t.ok)throw new R(t);if(204!==t.status){var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}}))}A.get=D("GET"),A.patch=D("PATCH"),A.put=D("PUT");var U=A.post=D("POST");A.head=D("HEAD");function D(t){return function(e,n){if(n&&n.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return A(e,r({},n,{method:t}))}}A.delete=D("DELETE");var R=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=f(this,o(e).call(this))).name="HttpReqError",n.status=t.status,n.statusText=t.statusText,n.message="[".concat(t.status,"] ").concat(t.statusText),n.response=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(e,t),e}(u(Error));function I(t,e){var n;return{c:function(){(n=v("label")).className="control-label svelte-4hqcdn"},m:function(t,r){h(t,n,r),n.innerHTML=e.label},p:function(t,e){t.label&&(n.innerHTML=e.label)},d:function(t){t&&m(n)}}}function $(t,e){var n;return{c:function(){(n=v("div")).className="help success svelte-4hqcdn"},m:function(t,r){h(t,n,r),n.innerHTML=e.success},p:function(t,e){t.success&&(n.innerHTML=e.success)},d:function(t){t&&m(n)}}}function F(t,e){var n;return{c:function(){(n=v("div")).className="help error svelte-4hqcdn"},m:function(t,r){h(t,n,r),n.innerHTML=e.error},p:function(t,e){t.error&&(n.innerHTML=e.error)},d:function(t){t&&m(n)}}}function G(t,e){var n;return{c:function(){(n=v("div")).className="help svelte-4hqcdn"},m:function(t,r){h(t,n,r),n.innerHTML=e.help},p:function(t,e){t.help&&(n.innerHTML=e.help)},d:function(t){t&&m(n)}}}function B(t){var e,n,r,o,i,c,s,u,a,f,l,_,g;S(this,t),this._state=p({label:"",help:"",error:!1,success:!1,width:"auto"},t.data),this._intro=!0,this._slotted=t.slots||{},this._fragment=(e=this,n=this._state,a=e._slotted.default,f=n.label&&I(0,n),l=n.success&&$(0,n),_=n.error&&F(0,n),g=!n.success&&!n.error&&n.help&&G(0,n),{c:function(){r=v("div"),f&&f.c(),o=b("\n    "),i=v("div"),c=b("\n    "),l&&l.c(),s=b(" "),_&&_.c(),u=b(" "),g&&g.c(),i.className="form-controls svelte-4hqcdn",r.className="form-block svelte-4hqcdn",w(r,"width",n.width),O(r,"success",n.success),O(r,"error",n.error)},m:function(t,e){h(t,r,e),f&&f.m(r,null),d(r,o),d(r,i),a&&d(i,a),d(r,c),l&&l.m(r,null),d(r,s),_&&_.m(r,null),d(r,u),g&&g.m(r,null)},p:function(t,e){e.label?f?f.p(t,e):((f=I(0,e)).c(),f.m(r,o)):f&&(f.d(1),f=null),e.success?l?l.p(t,e):((l=$(0,e)).c(),l.m(r,s)):l&&(l.d(1),l=null),e.error?_?_.p(t,e):((_=F(0,e)).c(),_.m(r,u)):_&&(_.d(1),_=null),e.success||e.error||!e.help?g&&(g.d(1),g=null):g?g.p(t,e):((g=G(0,e)).c(),g.m(r,null)),t.width&&w(r,"width",e.width),t.success&&O(r,"success",e.success),t.error&&O(r,"error",e.error)},d:function(t){t&&m(r),f&&f.d(),a&&function(t,e){for(;t.firstChild;)e.appendChild(t.firstChild)}(i,a),l&&l.d(),_&&_.d(),g&&g.d()}}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function J(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function z(){}p(B.prototype,H);var K={createAccount:function(t){try{var e=this;return e.set({signedUp:!0}),n="Chart Editor",r="send-embed-code",window._paq&&window._paq.push(["trackEvent",n,r,o,i]),function(t){if(t&&t.then)return t.then(z)}(function(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}((function(){return J(U("/v3/auth/signup",{payload:{email:t,invitation:!0,chartId:e.store.get().id}}),(function(t){e.get().fromSvelte?(e.set({signedUp:!1,error:""}),e.store.set({user:t})):window.location.reload()}))}),(function(t){return function(t){var e=t();if(e&&e.then)return e.then(z)}((function(){if("HttpReqError"===t.name)return J(t.response.json(),(function(n){e.set({error:n.message||t})}));e.set({error:"Unknown error: ".concat(t)})}))})))}catch(t){return Promise.reject(t)}var n,r,o,i}};function Q(t,e,n){var r=Object.create(t);return r.text=e[n],r}function V(t,e){var n,r,o,i=q("publish / guest / h1"),c=q("publish / guest / p");return{c:function(){n=v("h2"),r=b("\n\n                "),o=v("p")},m:function(t,e){h(t,n,e),n.innerHTML=i,h(t,r,e),h(t,o,e),o.innerHTML=c},p:l,d:function(t){t&&(m(n),m(r),m(o))}}}function W(t,e){for(var n,r=e.custom_text,o=[],i=0;i<r.length;i+=1)o[i]=X(t,Q(e,r,i));return{c:function(){for(var t=0;t<o.length;t+=1)o[t].c();n=document.createComment("")},m:function(t,e){for(var r=0;r<o.length;r+=1)o[r].m(t,e);h(t,n,e)},p:function(e,i){if(e.custom_text){r=i.custom_text;for(var c=0;c<r.length;c+=1){var s=Q(i,r,c);o[c]?o[c].p(e,s):(o[c]=X(t,s),o[c].c(),o[c].m(n.parentNode,n))}for(;c<o.length;c+=1)o[c].d(1);o.length=r.length}},d:function(t){!function(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(o,t),t&&m(n)}}}function X(t,e){var n,r,o=e.text;return{c:function(){n=v("noscript"),r=v("noscript")},m:function(t,e){h(t,n,e),n.insertAdjacentHTML("afterend",o),h(t,r,e)},p:function(t,e){t.custom_text&&o!==(o=e.text)&&(_(n,r),n.insertAdjacentHTML("afterend",o))},d:function(t){t&&(_(n,r),m(n),m(r))}}}function Y(t,e){var n,r;return{c:function(){n=v("div"),r=b(e.error),n.className="alert alert-warning"},m:function(t,e){h(t,n,e),d(n,r)},p:function(t,e){t.error&&function(t,e){t.data=""+e}(r,e.error)},d:function(t){t&&m(n)}}}function Z(t){S(this,t),this._state=p({error:"",email:"",custom_text:[],signedUp:!1},t.data),this._intro=!0,this._fragment=function(t,e){var n,r,o,i,c,s,u,a,f,l,p,_,O,j,x,P,T,E,N=!1,S=q("publish / guest / back"),C=q("publish / guest / cta");function L(t){return t.custom_text?W:V}var H=L(e),k=H(t,e);function M(){N=!0,t.set({email:c.value}),N=!1}var A={label:q("publish / guest / e-mail"),help:q("publish / guest / example-email")},U=new B({root:t.root,store:t.store,slots:{default:document.createDocumentFragment()},data:A});function D(n){t.createAccount(e.email)}var R=e.error&&Y(t,e);return{c:function(){var t,d,h;n=v("div"),r=v("div"),o=v("div"),k.c(),i=b("\n\n        "),c=v("input"),U._fragment.c(),s=b("\n\n        "),u=v("div"),a=v("button"),f=v("i"),l=b("   "),p=v("noscript"),_=b("\n\n            "),O=v("button"),j=v("i"),P=b("   "),T=v("noscript"),E=b("\n\n            "),R&&R.c(),w(o,"margin-bottom","20px"),g(c,"input",M),t=c,d="type",null==(h="email")?t.removeAttribute(d):t.setAttribute(d,h),c.className="input-xlarge",f.className="fa fa-chevron-left",a.className="btn btn-save btn-default btn-back",j.className=x="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),g(O,"click",D),O.className="btn btn-save btn-primary",w(O,"float","right"),w(u,"margin-top","30px"),r.className="span5",n.className="row"},m:function(t,m){h(t,n,m),d(n,r),d(r,o),k.m(o,null),d(r,i),d(U._slotted.default,c),c.value=e.email,U._mount(r,null),d(r,s),d(r,u),d(u,a),d(a,f),d(a,l),d(a,p),p.insertAdjacentHTML("afterend",S),d(u,_),d(u,O),d(O,j),d(O,P),d(O,T),T.insertAdjacentHTML("afterend",C),d(u,E),R&&R.m(u,null)},p:function(n,r){H===(H=L(e=r))&&k?k.p(n,e):(k.d(1),(k=H(t,e)).c(),k.m(o,null)),!N&&n.email&&(c.value=e.email),n.signedUp&&x!==(x="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(j.className=x),e.error?R?R.p(n,e):((R=Y(t,e)).c(),R.m(u,null)):R&&(R.d(1),R=null)},d:function(t){t&&m(n),k.d(),y(c,"input",M),U.destroy(),y(O,"click",D),R&&R.d()}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),E(this))}function tt(t,e){this._handlers={},this._dependents=[],this._computed=j(),this._sortedComputedProperties=[],this._state=p({},t),this._differs=e&&e.immutable?P:x}return p(Z.prototype,H),p(Z.prototype,K),p(tt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var r=t[n];e["$"+r]=this._state[r]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,e){var n=this,r=this._state;this._state=p(p({},r),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,e);this.fire("state",{changed:e,previous:r,current:this._state}),this._dependents.filter((function(t){for(var r={},o=!1,i=0;i<t.props.length;i+=1){var c=t.props[i];c in e&&(r["$"+c]=n._state[c],o=!0)}if(o)return t.component._stage(r),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:e,previous:r,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],r=j();function o(i){var c=e[i];c&&(c.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between ".concat(e," <-> ").concat(i));o(e)})),r[i]||(r[i]=!0,n.push(c)))}for(var i in this._computed)o(t=i)},compute:function(t,e,n){var r,o=this,i={deps:e,update:function(i,c,s){var u=e.map((function(t){return t in c&&(s=!0),i[t]}));if(s){var a=n.apply(null,u);o._differs(a,r)&&(r=a,c[t]=!0,i[t]=r)}}};this._computed[t]=i,this._sortComputedProperties();var c=p({},this._state),s={};i.update(c,s,!0),this._set(c,s)},fire:T,get:N,on:C,set:function(t){var e=this._state,n=this._changed={},r=!1;for(var o in t){if(this._computed[o])throw new Error("'".concat(o,"' is a read-only computed property"));this._differs(t[o],e[o])&&(n[o]=r=!0)}r&&this._set(t,n)}}),{App:Z,store:new tt({})}}));
