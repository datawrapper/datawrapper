!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/publish/guest",e):(t=t||self)["publish/guest"]=e()}(this,(function(){"use strict";function t(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var e=t((function(t){function e(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(n)}t.exports=e}));function n(){}function r(t,e){for(var n in e)t[n]=e[n];return t}function o(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n)}function c(t){t.parentNode.removeChild(t)}function s(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function u(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function a(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function l(){return document.createComment("")}function p(t,e,n,r){t.addEventListener(e,n,r)}function d(t,e,n,r){t.removeEventListener(e,n,r)}function h(t,e,n){t.style.setProperty(e,n)}function m(t,e,n){t.classList[n?"add":"remove"](e)}function _(){return Object.create(null)}function v(t,n){return t!=t?n==n:t!==n||t&&"object"===e(t)||"function"==typeof t}function b(t,e){return t!=t?e==e:t!==e}function g(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var o=n[r];if(!o.__calling)try{o.__calling=!0,o.call(this,e)}finally{o.__calling=!1}}}function y(t){t._lock=!0,j(t._beforecreate),j(t._oncreate),j(t._aftercreate),t._lock=!1}function w(){return this._state}function x(t,e){t._handlers=_(),t._slots=_(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function O(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function j(t){for(;t&&t.length;)t.shift()()}var S={destroy:function(t){this.destroy=n,this.fire("destroy"),this.set=n,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:w,fire:g,on:O,set:function(t){this._set(r({},t)),this.root._lock||y(this.root)},_recompute:n,_set:function(t){var e=this._state,n={},o=!1;for(var i in t=r(this._staged,t),this._staged={},t)this._differs(t[i],e[i])&&(n[i]=o=!0);o&&(this._state=r(r({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_stage:function(t){r(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:v},T={};function P(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"core";"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(T[t]=window.__dw.vis.meta.locale||{}):T[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function E(t){var e=arguments,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core";if(t=t.trim(),T[n]||P(n),!T[n][t])return"MISSING:"+t;var r=T[n][t];return"string"==typeof r&&arguments.length>2&&(r=r.replace(/\$(\d)/g,(function(t,n){return n=2+Number(n),void 0===e[n]?t:e[n]}))),r}var N=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},L=t((function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"===L(Symbol.iterator)?function(t){return L(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":L(t)})(t)}function n(r){return"function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?t.exports=n=function(t){return e(t)}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},n(r)}t.exports=n}));var H=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var C=function(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?H(t):e},M=t((function(t){function e(n){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},e(n)}t.exports=e})),k=t((function(t){function e(n,r){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},e(n,r)}t.exports=e}));var q=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)};var A=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},U=t((function(t){function e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function n(r,o,i){return e()?t.exports=n=Reflect.construct:t.exports=n=function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&k(o,n.prototype),o},n.apply(null,arguments)}t.exports=n})),D=t((function(t){function e(n){var r="function"==typeof Map?new Map:void 0;return t.exports=e=function(t){if(null===t||!A(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return U(t,arguments,M(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),k(e,t)},e(n)}t.exports=e}));var R=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};var I=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o};var $=function(t,e){if(null==t)return{};var n,r,o=I(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o};function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(e){R(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function B(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=G({payload:null,raw:!1,method:"GET",baseUrl:"//".concat(dw.backend.__api_domain),mode:"cors",credentials:"include"},e,{headers:G({"Content-Type":"application/json"},e.headers)}),r=n.payload,o=n.baseUrl,i=n.raw,c=$(n,["payload","baseUrl","raw"]),s="".concat(o.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));return r&&(c.body=JSON.stringify(r)),window.fetch(s,c).then((function(t){if(i)return t;if(!t.ok)throw new K(t);if(204===t.status||!t.headers.get("content-type"))return t;var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}))}B.get=z("GET"),B.patch=z("PATCH"),B.put=z("PUT");var J=B.post=z("POST");B.head=z("HEAD");function z(t){return function(e,n){if(n&&n.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return B(e,G({},n,{method:t}))}}B.delete=z("DELETE");var K=function(t){function e(t){var n;return N(this,e),(n=C(this,M(e).call(this))).name="HttpReqError",n.status=t.status,n.statusText=t.statusText,n.message="[".concat(t.status,"] ").concat(t.statusText),n.response=t,n}return q(e,t),e}(D(Error));function Q(t,e){var n;return{c:function(){(n=a("label")).className="control-label svelte-4hqcdn"},m:function(t,r){i(t,n,r),n.innerHTML=e.label},p:function(t,e){t.label&&(n.innerHTML=e.label)},d:function(t){t&&c(n)}}}function V(t,e){var n;return{c:function(){(n=a("div")).className="help success svelte-4hqcdn"},m:function(t,r){i(t,n,r),n.innerHTML=e.success},p:function(t,e){t.success&&(n.innerHTML=e.success)},d:function(t){t&&c(n)}}}function W(t,e){var n;return{c:function(){(n=a("div")).className="help error svelte-4hqcdn"},m:function(t,r){i(t,n,r),n.innerHTML=e.error},p:function(t,e){t.error&&(n.innerHTML=e.error)},d:function(t){t&&c(n)}}}function X(t,e){var n;return{c:function(){(n=a("div")).className="help svelte-4hqcdn"},m:function(t,r){i(t,n,r),n.innerHTML=e.help},p:function(t,e){t.help&&(n.innerHTML=e.help)},d:function(t){t&&c(n)}}}function Y(t){var e,n,s,u,l,p,d,_,v,b,g,y,w;x(this,t),this._state=r({label:"",help:"",error:!1,success:!1,width:"auto"},t.data),this._intro=!0,this._slotted=t.slots||{},this._fragment=(e=this,n=this._state,v=e._slotted.default,b=n.label&&Q(0,n),g=n.success&&V(0,n),y=n.error&&W(0,n),w=!n.success&&!n.error&&n.help&&X(0,n),{c:function(){s=a("div"),b&&b.c(),u=f("\n    "),l=a("div"),p=f("\n    "),g&&g.c(),d=f(" "),y&&y.c(),_=f(" "),w&&w.c(),l.className="form-controls svelte-4hqcdn",s.className="form-block svelte-4hqcdn",h(s,"width",n.width),m(s,"success",n.success),m(s,"error",n.error)},m:function(t,e){i(t,s,e),b&&b.m(s,null),o(s,u),o(s,l),v&&o(l,v),o(s,p),g&&g.m(s,null),o(s,d),y&&y.m(s,null),o(s,_),w&&w.m(s,null)},p:function(t,e){e.label?b?b.p(t,e):((b=Q(0,e)).c(),b.m(s,u)):b&&(b.d(1),b=null),e.success?g?g.p(t,e):((g=V(0,e)).c(),g.m(s,d)):g&&(g.d(1),g=null),e.error?y?y.p(t,e):((y=W(0,e)).c(),y.m(s,_)):y&&(y.d(1),y=null),e.success||e.error||!e.help?w&&(w.d(1),w=null):w?w.p(t,e):((w=X(0,e)).c(),w.m(s,null)),t.width&&h(s,"width",e.width),t.success&&m(s,"success",e.success),t.error&&m(s,"error",e.error)},d:function(t){t&&c(s),b&&b.d(),v&&function(t,e){for(;t.firstChild;)e.appendChild(t.firstChild)}(l,v),g&&g.d(),y&&y.d(),w&&w.d()}}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function Z(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function tt(){}r(Y.prototype,S);var et={createAccount:function(t){try{var e=this;return e.set({signedUp:!0}),n="Chart Editor",r="send-embed-code",window._paq&&window._paq.push(["trackEvent",n,r,o,i]),function(t){if(t&&t.then)return t.then(tt)}(function(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}((function(){return Z(J("/v3/auth/signup",{payload:{email:t,invitation:!0,chartId:e.store.get().id}}),(function(t){e.get().fromSvelte?(e.set({signedUp:!1,error:""}),e.store.set({user:t})):window.location.reload()}))}),(function(t){return function(t){var e=t();if(e&&e.then)return e.then(tt)}((function(){if("HttpReqError"===t.name)return Z(t.response.json(),(function(n){e.set({error:n.message||t})}));e.set({error:"Unknown error: ".concat(t)})}))})))}catch(t){return Promise.reject(t)}var n,r,o,i}};function nt(t,e,n){var r=Object.create(t);return r.text=e[n],r}function rt(t,e,n){var r=Object.create(t);return r.text=e[n],r}function ot(t,e){var r,o,s,u=E("publish / guest / h1"),l=E("publish / guest / p");return{c:function(){r=a("h2"),o=f("\n\n            "),s=a("p")},m:function(t,e){i(t,r,e),r.innerHTML=u,i(t,o,e),i(t,s,e),s.innerHTML=l},p:n,d:function(t){t&&(c(r),c(o),c(s))}}}function it(t,e){for(var n,r=e.guest_text_above,o=[],s=0;s<r.length;s+=1)o[s]=ct(t,rt(e,r,s));return{c:function(){for(var t=0;t<o.length;t+=1)o[t].c();n=l()},m:function(t,e){for(var r=0;r<o.length;r+=1)o[r].m(t,e);i(t,n,e)},p:function(e,i){if(e.guest_text_above){r=i.guest_text_above;for(var c=0;c<r.length;c+=1){var s=rt(i,r,c);o[c]?o[c].p(e,s):(o[c]=ct(t,s),o[c].c(),o[c].m(n.parentNode,n))}for(;c<o.length;c+=1)o[c].d(1);o.length=r.length}},d:function(t){u(o,t),t&&c(n)}}}function ct(t,e){var n,r,o=e.text;return{c:function(){n=a("noscript"),r=a("noscript")},m:function(t,e){i(t,n,e),n.insertAdjacentHTML("afterend",o),i(t,r,e)},p:function(t,e){t.guest_text_above&&o!==(o=e.text)&&(s(n,r),n.insertAdjacentHTML("afterend",o))},d:function(t){t&&(s(n,r),c(n),c(r))}}}function st(t,e){for(var n,r=e.guest_text_below,o=[],s=0;s<r.length;s+=1)o[s]=ut(t,nt(e,r,s));return{c:function(){for(var t=0;t<o.length;t+=1)o[t].c();n=l()},m:function(t,e){for(var r=0;r<o.length;r+=1)o[r].m(t,e);i(t,n,e)},p:function(e,i){if(e.guest_text_below){r=i.guest_text_below;for(var c=0;c<r.length;c+=1){var s=nt(i,r,c);o[c]?o[c].p(e,s):(o[c]=ut(t,s),o[c].c(),o[c].m(n.parentNode,n))}for(;c<o.length;c+=1)o[c].d(1);o.length=r.length}},d:function(t){u(o,t),t&&c(n)}}}function ut(t,e){var n,r,o=e.text;return{c:function(){n=a("noscript"),r=a("noscript")},m:function(t,e){i(t,n,e),n.insertAdjacentHTML("afterend",o),i(t,r,e)},p:function(t,e){t.guest_text_below&&o!==(o=e.text)&&(s(n,r),n.insertAdjacentHTML("afterend",o))},d:function(t){t&&(s(n,r),c(n),c(r))}}}function at(t,e){var n,r;return{c:function(){n=a("div"),r=f(e.error),n.className="alert alert-warning"},m:function(t,e){i(t,n,e),o(n,r)},p:function(t,e){t.error&&function(t,e){t.data=""+e}(r,e.error)},d:function(t){t&&c(n)}}}function ft(t){x(this,t),this._state=r({error:"",email:"",guest_text_above:[],guest_text_below:[],signedUp:!1},t.data),this._intro=!0,this._fragment=function(t,e){var n,r,s,u,l,m,_,v,b,g,y,w,x,O,j,S,T,P,N,L,H=!1,C=E("publish / guest / cta"),M=E("publish / guest / back");function k(t){return t.guest_text_above?it:ot}var q=k(e),A=q(t,e);function U(){H=!0,t.set({email:m.value}),H=!1}function D(n){t.createAccount(e.email)}var R={label:E("publish / guest / e-mail"),help:E("publish / guest / example-email")},I=new Y({root:t.root,store:t.store,slots:{default:document.createDocumentFragment()},data:R}),$=e.guest_text_below&&st(t,e),F=e.error&&at(t,e);return{c:function(){var t,o,i;n=a("div"),r=a("div"),s=a("div"),A.c(),u=f("\n\n        "),l=a("div"),m=a("input"),_=f("\n\n                "),v=a("button"),b=a("i"),y=f("\n                      "),w=a("noscript"),I._fragment.c(),x=f("\n\n        "),$&&$.c(),O=f("\n\n        "),j=a("div"),S=a("button"),T=a("i"),P=f("   "),N=a("noscript"),L=f("\n\n            "),F&&F.c(),h(s,"margin-bottom","20px"),p(m,"input",U),t=m,o="type",null==(i="email")?t.removeAttribute(o):t.setAttribute(o,i),m.className="input-xlarge",b.className=g="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),p(v,"click",D),v.className="btn btn-save btn-primary",h(v,"white-space","nowrap"),h(v,"margin-left","10px"),h(l,"display","flex"),T.className="fa fa-chevron-left",S.className="btn btn-save btn-default btn-back",h(j,"margin-top","30px"),r.className="span5",n.className="row publish-signup"},m:function(t,c){i(t,n,c),o(n,r),o(r,s),A.m(s,null),o(r,u),o(I._slotted.default,l),o(l,m),m.value=e.email,o(l,_),o(l,v),o(v,b),o(v,y),o(v,w),w.insertAdjacentHTML("afterend",C),I._mount(r,null),o(r,x),$&&$.m(r,null),o(r,O),o(r,j),o(j,S),o(S,T),o(S,P),o(S,N),N.insertAdjacentHTML("afterend",M),o(j,L),F&&F.m(j,null)},p:function(n,o){q===(q=k(e=o))&&A?A.p(n,e):(A.d(1),(A=q(t,e)).c(),A.m(s,null)),!H&&n.email&&(m.value=e.email),n.signedUp&&g!==(g="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(b.className=g),e.guest_text_below?$?$.p(n,e):(($=st(t,e)).c(),$.m(r,O)):$&&($.d(1),$=null),e.error?F?F.p(n,e):((F=at(t,e)).c(),F.m(j,null)):F&&(F.d(1),F=null)},d:function(t){t&&c(n),A.d(),d(m,"input",U),d(v,"click",D),I.destroy(),$&&$.d(),F&&F.d()}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),y(this))}function lt(t,e){this._handlers={},this._dependents=[],this._computed=_(),this._sortedComputedProperties=[],this._state=r({},t),this._differs=e&&e.immutable?b:v}return r(ft.prototype,S),r(ft.prototype,et),r(lt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var r=t[n];e["$"+r]=this._state[r]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,e){var n=this,o=this._state;this._state=r(r({},o),t);for(var i=0;i<this._sortedComputedProperties.length;i+=1)this._sortedComputedProperties[i].update(this._state,e);this.fire("state",{changed:e,previous:o,current:this._state}),this._dependents.filter((function(t){for(var r={},o=!1,i=0;i<t.props.length;i+=1){var c=t.props[i];c in e&&(r["$"+c]=n._state[c],o=!0)}if(o)return t.component._stage(r),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:e,previous:o,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],r=_();function o(i){var c=e[i];c&&(c.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between ".concat(e," <-> ").concat(i));o(e)})),r[i]||(r[i]=!0,n.push(c)))}for(var i in this._computed)o(t=i)},compute:function(t,e,n){var o,i=this,c={deps:e,update:function(r,c,s){var u=e.map((function(t){return t in c&&(s=!0),r[t]}));if(s){var a=n.apply(null,u);i._differs(a,o)&&(o=a,c[t]=!0,r[t]=o)}}};this._computed[t]=c,this._sortComputedProperties();var s=r({},this._state),u={};c.update(s,u,!0),this._set(s,u)},fire:g,get:w,on:O,set:function(t){var e=this._state,n=this._changed={},r=!1;for(var o in t){if(this._computed[o])throw new Error("'".concat(o,"' is a read-only computed property"));this._differs(t[o],e[o])&&(n[o]=r=!0)}r&&this._set(t,n)}}),{App:ft,store:new lt({})}}));
