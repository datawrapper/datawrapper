!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("../../../../../../../../../../static/js/svelte/publish.js")):"function"==typeof define&&define.amd?define(["../../../../../../../../../../static/js/svelte/publish.js"],e):(t=t||self)["publish/sidebar"]=e(t.publish_js)}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function c(t,e,n){return(c=a()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function u(t){var e="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return c(t,arguments,o(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function f(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(){}function h(t,e){for(var n in e)t[n]=e[n];return t}function d(t,e){for(var n in e)t[n]=1;return t}function m(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n)}function _(t){t.parentNode.removeChild(t)}function g(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function y(t,e,n,r){t.addEventListener(e,n,r)}function w(t,e,n,r){t.removeEventListener(e,n,r)}function j(t,e,n){t.style.setProperty(e,n)}function O(){return Object.create(null)}function T(t){t._lock=!0,E(t._beforecreate),E(t._oncreate),E(t._aftercreate),t._lock=!1}function P(t,e){t._handlers=O(),t._slots=O(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function E(t){for(;t&&t.length;)t.shift()()}function x(){this.store._remove(this)}var N={destroy:function(t){this.destroy=p,this.fire("destroy"),this.set=p,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var i=n[r];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}},on:function(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(h({},t)),this.root._lock||T(this.root)},_recompute:p,_set:function(t){var e=this._state,n={},r=!1;for(var i in t=h(this._staged,t),this._staged={},t)this._differs(t[i],e[i])&&(n[i]=r=!0);r&&(this._state=h(h({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_stage:function(t){h(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,n){return t!=t?n==n:t!==n||t&&"object"===e(t)||"function"==typeof t}},S={};function L(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"core";"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(S[t]=window.__dw.vis.meta.locale||{}):S[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function k(t){var e=arguments,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core";if(t=t.trim(),S[n]||L(n),!S[n][t])return"MISSING:"+t;var r=S[n][t];return"string"==typeof r&&arguments.length>2&&(r=r.replace(/\$(\d)/g,(function(t,n){return n=2+Number(n),void 0===e[n]?t:e[n]}))),r}function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i({payload:null,raw:!1,method:"GET",baseUrl:"//".concat(dw.backend.__api_domain),mode:"cors",credentials:"include"},e,{headers:i({"Content-Type":"application/json"},e.headers)}),r=n.payload,o=n.baseUrl,s=n.raw,a=f(n,["payload","baseUrl","raw"]),c="".concat(o.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));return r&&(a.body=JSON.stringify(r)),window.fetch(c,a).then((function(t){if(s)return t;if(!t.ok)throw new U(t);if(204!==t.status){var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}}))}A.get=M("GET"),A.patch=M("PATCH"),A.put=M("PUT");var H=A.post=M("POST");A.head=M("HEAD");function M(t){return function(e,n){if(n&&n.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return A(e,i({},n,{method:t}))}}A.delete=M("DELETE");var U=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=l(this,o(e).call(this))).name="HttpReqError",n.status=t.status,n.statusText=t.statusText,n.message="[".concat(t.status,"] ").concat(t.statusText),n.response=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,t),e}(u(Error));function C(t,e,n){return n?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function R(){}var q={createAccount:function(t){try{var e=this;return e.set({signedUp:!0}),n="Chart Editor",r="send-embed-code",window._paq&&window._paq.push(["trackEvent",n,r,i,o]),function(t){if(t&&t.then)return t.then(R)}(function(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}((function(){return C(H("/v3/auth/signup",{payload:{email:t,invitation:!0,chartId:e.store.get().id}}),(function(t){e.get().fromSvelte?(e.set({signedUp:!1,error:""}),e.store.set({user:t})):window.location.reload()}))}),(function(t){return function(t){var e=t();if(e&&e.then)return e.then(R)}((function(){if("HttpReqError"===t.name)return C(t.response.json(),(function(n){e.set({error:n.message||t})}));e.set({error:"Unknown error: ".concat(t)})}))})))}catch(t){return Promise.reject(t)}var n,r,i,o}};function D(t,e){var n,r;return{c:function(){n=g("div"),r=v(e.error),n.className="alert alert-warning"},m:function(t,e){b(t,n,e),m(n,r)},p:function(t,e){t.error&&function(t,e){t.data=""+e}(r,e.error)},d:function(t){t&&_(n)}}}function G(t){P(this,t),this._state=h({error:"",email:"",signedUp:!1},t.data),this._intro=!0,this._fragment=function(t,e){var n,r,i,o,s,a,c,u,f,l,p,h,d,O,T,P,E,x,N,S,L,A,H,M,U,C,R,q,G,I,$,F,z,B,J,K,Q,V,W,X,Y=k("publish / guest / h1"),Z=k("publish / guest / p"),tt=k("publish / guest / li1"),et=k("publish / guest / li2"),nt=k("publish / guest / li3"),rt=k("publish / guest / e-mail"),it=!1,ot=k("publish / guest / back"),st=k("publish / guest / cta");function at(){it=!0,t.set({email:R.value}),it=!1}function ct(n){t.createAccount(e.email)}var ut=e.error&&D(t,e);return{c:function(){var t,m,b;n=g("div"),r=g("h2"),i=v("\n\n    "),o=g("p"),s=v("\n\n    "),a=g("ul"),c=g("li"),u=g("i"),f=v("  "),l=g("noscript"),p=v("\n        "),h=g("li"),d=g("i"),O=v("  "),T=g("noscript"),P=v("\n        "),E=g("li"),x=g("i"),N=v("  "),S=g("noscript"),L=v("\n\n    "),A=g("fieldset"),H=g("div"),M=g("label"),U=v("\n\n            "),C=g("div"),R=g("input"),q=v("\n        "),G=g("div"),I=g("button"),$=g("i"),F=v("   "),z=g("noscript"),B=v("\n\n            "),J=g("button"),K=g("i"),V=v("   "),W=g("noscript"),X=v("\n\n            "),ut&&ut.c(),u.className="fa fa-check",d.className="fa fa-check",x.className="fa fa-check",a.className="bullet-list",j(a,"list-style","none"),j(a,"margin-left","0px"),j(a,"font-weight","lighter"),j(a,"margin-top","20px"),M.className="control-label",j(M,"width","160px"),M.htmlFor="email",y(R,"input",at),t=R,m="type",null==(b="text")?t.removeAttribute(m):t.setAttribute(m,b),R.className="input-xlarge",R.placeholder=k("publish / guest / example-email"),C.className="controls",j(C,"margin-left","180px"),H.className="control-group",j(H,"margin-top","10px"),$.className="fa fa-chevron-left",I.className="btn btn-save btn-default btn-back",K.className=Q="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"),y(J,"click",ct),J.className="btn btn-save btn-primary",j(J,"float","right"),j(G,"margin-top","30px"),n.className="form-horizontal publish-form"},m:function(t,_){b(t,n,_),m(n,r),r.innerHTML=Y,m(n,i),m(n,o),o.innerHTML=Z,m(n,s),m(n,a),m(a,c),m(c,u),m(c,f),m(c,l),l.insertAdjacentHTML("afterend",tt),m(a,p),m(a,h),m(h,d),m(h,O),m(h,T),T.insertAdjacentHTML("afterend",et),m(a,P),m(a,E),m(E,x),m(E,N),m(E,S),S.insertAdjacentHTML("afterend",nt),m(n,L),m(n,A),m(A,H),m(H,M),M.innerHTML=rt,m(H,U),m(H,C),m(C,R),R.value=e.email,m(A,q),m(A,G),m(G,I),m(I,$),m(I,F),m(I,z),z.insertAdjacentHTML("afterend",ot),m(G,B),m(G,J),m(J,K),m(J,V),m(J,W),W.insertAdjacentHTML("afterend",st),m(G,X),ut&&ut.m(G,null)},p:function(n,r){e=r,!it&&n.email&&(R.value=e.email),n.signedUp&&Q!==(Q="fa "+(e.signedUp?"fa-circle-o-notch fa-spin":"fa-envelope"))&&(K.className=Q),e.error?ut?ut.p(n,e):((ut=D(t,e)).c(),ut.m(G,null)):ut&&(ut.d(1),ut=null)},d:function(t){t&&_(n),w(R,"input",at),w(J,"click",ct),ut&&ut.d()}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function I(){}h(G.prototype,N),h(G.prototype,q);var $={resendActivation:function(){try{var t=this;return t.set({status:"sending"}),function(t){if(t&&t.then)return t.then(I)}(function(t,e){try{var n=t()}catch(t){return e(t)}return n&&n.then?n.then(void 0,e):n}((function(){return e=H("/v3/auth/resend-activation"),n=function(){t.set({status:"success"})},r?n?n(e):e:(e&&e.then||(e=Promise.resolve(e)),n?e.then(n):e);var e,n,r}),(function(){t.set({status:"error"})})))}catch(t){return Promise.reject(t)}}};function F(t,e){var n,r,i,o,s,a=k("publish / pending-activation / resend");function c(e){t.resendActivation()}return{c:function(){n=g("button"),r=g("i"),o=v("  \n                "),s=g("noscript"),r.className=i="fa "+("sending"==e.status?"fa-spin fa-circle-o-notch":"fa-envelope"),y(n,"click",c),n.className="btn btn-primary"},m:function(t,e){b(t,n,e),m(n,r),m(n,o),m(n,s),s.insertAdjacentHTML("afterend",a)},p:function(t,e){t.status&&i!==(i="fa "+("sending"==e.status?"fa-spin fa-circle-o-notch":"fa-envelope"))&&(r.className=i)},d:function(t){t&&_(n),w(n,"click",c)}}}function z(t,e){var n,r=k("publish / pending-activation / resend-error");return{c:function(){n=g("p")},m:function(t,e){b(t,n,e),n.innerHTML=r},p:p,d:function(t){t&&_(n)}}}function B(t,e){var n,r=k("publish / pending-activation / resend-success");return{c:function(){n=g("p")},m:function(t,e){b(t,n,e),n.innerHTML=r},p:p,d:function(t){t&&_(n)}}}function J(t){P(this,t),this._state=h({status:""},t.data),this._intro=!0,this._fragment=function(t,e){var n,r,i,o,s,a,c=k("publish / pending-activation / h1"),u=k("publish / pending-activation / p");function f(t){return"success"==t.status?B:"error"==t.status?z:F}var l=f(e),p=l(t,e);return{c:function(){n=g("div"),r=g("h2"),i=v("\n\n    "),o=g("p"),s=v("\n\n    "),a=g("div"),p.c(),j(a,"margin-top","20px"),n.className="publish-form",n.id="step-2"},m:function(t,e){b(t,n,e),m(n,r),r.innerHTML=c,m(n,i),m(n,o),o.innerHTML=u,m(n,s),m(n,a),p.m(a,null)},p:function(e,n){l===(l=f(n))&&p?p.p(e,n):(p.d(1),(p=l(t,n)).c(),p.m(a,null))},d:function(t){t&&_(n),p.d()}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function K(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){var i=document.createElement("script");i.src=t,i.onload=function(){e&&e(),n()},i.onerror=r,document.body.appendChild(i)}))}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){var i=document.createElement("link");i.rel="stylesheet",i.href=t,i.onload=function(){e&&e(),n()},i.onerror=r,document.head.appendChild(i)}))}function V(t){var e=this,n=t.current;if(t.changed.afterEmbed){var r=n.afterEmbed[0];Promise.all([Q(r.css),K(r.js)]).then((function(){require([r.module],(function(t){e.set({beforeExport:t.App})}))}))}}function W(e,n){var r={beforeExport:n.beforeExport,embed_templates:n.embedTemplates,embed_type:n.embedType,plugin_shareurls:n.pluginShareurls,shareurl_type:n.shareurlType},i=new t.Publish({root:e.root,store:e.store,data:r});return{c:function(){i._fragment.c()},m:function(t,e){i._mount(t,e)},p:function(t,e){var n={};t.beforeExport&&(n.beforeExport=e.beforeExport),t.embedTemplates&&(n.embed_templates=e.embedTemplates),t.embedType&&(n.embed_type=e.embedType),t.pluginShareurls&&(n.plugin_shareurls=e.pluginShareurls),t.shareurlType&&(n.shareurl_type=e.shareurlType),i._set(n)},d:function(t){i.destroy(t)}}}function X(t,e){var n=new J({root:t.root,store:t.store});return{c:function(){n._fragment.c()},m:function(t,e){n._mount(t,e)},p:p,d:function(t){n.destroy(t)}}}function Y(t,e){var n=new G({root:t.root,store:t.store,data:{fromSvelte:"true"}});return{c:function(){n._fragment.c()},m:function(t,e){n._mount(t,e)},p:p,d:function(t){n.destroy(t)}}}function Z(t){var e=this;P(this,t),this._state=h(h(this.store._init(["user"]),{embedTemplates:[],embedType:"responsive",pluginShareurls:[],shareurlType:"default",beforeExport:null}),t.data),this.store._add(this,["user"]),this._intro=!0,this._handlers.state=[V],this._handlers.destroy=[x],V.call(this,{changed:d({},this._state),current:this._state}),this._fragment=function(t,e){var n;function r(t){return t.$user.isGuest?Y:t.$user.isActivated?W:X}var i=r(e),o=i(t,e);return{c:function(){n=g("div"),o.c()},m:function(t,e){b(t,n,e),o.m(n,null)},p:function(e,s){i===(i=r(s))&&o?o.p(e,s):(o.d(1),(o=i(t,s)).c(),o.m(n,null))},d:function(t){t&&_(n),o.d()}}}(this,this._state),this.root._oncreate.push((function(){e.fire("update",{changed:d({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),T(this))}function tt(t,e,n){var r=e.bind(this);return n&&!1===n.init||r(this.get()[t]),this.on(n&&n.defer?"update":"state",(function(e){var n=e.changed,i=e.current,o=e.previous;n[t]&&r(i[t],o&&o[t])}))}function et(){var t=this;this.store.observe=tt,this.store.observe("publishLogic",(function(e){e&&e.mod?(Q(e.css),K(e.src,(function(){require([e.mod],(function(n){t.set({PublishLogic:n.App}),t.refs.publish.set(e.data)}))}))):(t.set({PublishLogic:Z}),t.refs.publish.set(e.data))}))}function nt(t){var e=this;P(this,t),this.refs={},this._state=h({PublishLogic:Z},t.data),this._intro=!0,this._fragment=function(t,e){var n,r,i=e.PublishLogic;function o(e){return{root:t.root,store:t.store}}if(i)var s=new i(o());return{c:function(){n=g("div"),r=g("div"),s&&s._fragment.c(),r.className="publish-step is-published",n.className="dw-create-publish"},m:function(e,i){b(e,n,i),m(n,r),s&&(s._mount(r,null),t.refs.publish=s)},p:function(e,n){i!==(i=n.PublishLogic)&&(s&&s.destroy(),i?((s=new i(o()))._fragment.c(),s._mount(r,null),t.refs.publish=s):(s=null,t.refs.publish===s&&(t.refs.publish=null)))},d:function(t){t&&_(n),s&&s.destroy()}}}(this,this._state),this.root._oncreate.push((function(){et.call(e),e.fire("update",{changed:d({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),T(this))}return h(J.prototype,N),h(J.prototype,$),h(Z.prototype,N),h(nt.prototype,N),{PublishSidebar:nt}}));
