!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("svelte/highlight",e):t.highlight=e()}(this,function(){"use strict";function t(){}function e(t,e){for(var n in e)t[n]=e[n];return t}function n(t,e){t.appendChild(e)}function r(t,e,n){t.insertBefore(e,n)}function i(t){t.parentNode.removeChild(t)}function o(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function s(t){return document.createElement(t)}function a(t){return document.createTextNode(t)}function u(t,e,n,r){t.addEventListener(e,n,r)}function c(t,e,n,r){t.removeEventListener(e,n,r)}function h(t,e){t.data=""+e}function f(t,e,n){t.style.setProperty(e,n)}function l(t,e){for(var n=0;n<t.options.length;n+=1){var r=t.options[n];if(r.__value===e)return void(r.selected=!0)}}function d(){return Object.create(null)}function g(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function p(t,e){return t!=t?e==e:t!==e}function v(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var r=0;r<n.length;r+=1){var i=n[r];if(!i.__calling)try{i.__calling=!0,i.call(this,e)}finally{i.__calling=!1}}}function _(t){t._lock=!0,b(t._beforecreate),b(t._oncreate),b(t._aftercreate),t._lock=!1}function m(){return this._state}function y(t,e){var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}}function b(t){for(;t&&t.length;)t.shift()()}function k(){this.store._remove(this)}var w={destroy:function(e){this.destroy=t,this.fire("destroy"),this.set=t,this._fragment.d(!1!==e),this._fragment=null,this._state={}},get:m,fire:v,on:y,set:function(t){this._set(e({},t)),this.root._lock||_(this.root)},_recompute:t,_set:function(t){var n=this._state,r={},i=!1;for(var o in t=e(this._staged,t),this._staged={},t)this._differs(t[o],n[o])&&(r[o]=i=!0);i&&(this._state=e(e({},n),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:n}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:n})))},_stage:function(t){e(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:g};function E(t,e){var n=arguments;if(void 0===e&&(e="core"),t=t.trim(),!dw.backend.__messages[e])return"MISSING:"+t;var r=dw.backend.__messages[e][t]||dw.backend.__messages.core[t]||t;if(arguments.length>2)for(var i=2;i<arguments.length;i++){var o=i-1;r=r.replace("$"+o,n[i])}return r}function N(t){var e=typeof t;return"function"===e||"object"===e&&!!t}var O,j=Array.prototype,x=Object.prototype,S=j.slice,C=x.toString,P=x.hasOwnProperty,M=Object.keys;function L(t,e){return null!=t&&P.call(t,e)}function $(t){if(!N(t))return[];if(M)return M(t);var e=[];for(var n in t)L(t,n)&&e.push(n);return X&&function(t,e){var n=Y.length,r=t.constructor,i=J(r)&&r.prototype||x,o="constructor";L(t,o)&&!I(e,o)&&e.push(o);for(;n--;)(o=Y[n])in t&&t[o]!==i[o]&&!I(e,o)&&e.push(o)}(t,e),e}var A=function(t,e,n){return function(r,i,o){var s=0,a=V(r);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(r,i),r[o]===i?o:-1;if(i!=i)return(o=e(S.call(r,s,a),T))>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(r[o]===i)return o;return-1}}(1,(O=1,function(t,e,n){e=Q(e,n);for(var r=V(t),i=O>0?0:r-1;i>=0&&i<r;i+=O)if(e(t[i],i,t))return i;return-1}),function(t,e,n,r){for(var i=(n=Q(n,r,1))(e),o=0,s=V(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<i?o=a+1:s=a}return o});function I(t,e,n,r){return W(t)||(t=function(t){for(var e=$(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}(t)),("number"!=typeof n||r)&&(n=0),A(t,e,n)>=0}var J=("function"!=typeof/./&&"object"!=typeof Int8Array&&"undefined"!=typeof document&&"function"!=typeof document.childNodes?function(t){return"function"==typeof t||!1}:null)||function(t){return"[object Function]"===C.call(t)};!function(){C.call(arguments)}();function T(t){return function(t){return"[object Number]"===C.call(t)}(t)&&isNaN(t)}var H=K;function q(t){return t}var z,B,F=(z=$,function(t){var e=arguments,n=arguments.length;if(B&&(t=Object(t)),n<2||null==t)return t;for(var r=1;r<n;r++)for(var i=e[r],o=z(i),s=o.length,a=0;a<s;a++){var u=o[a];!N(t)||B&&void 0!==t[u]||(t[u]=i[u])}return t});function G(t){return t=F({},t),function(e){return function(t,e){var n=$(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0}(e,t)}}function D(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}}function K(t,e){return Q(t,e,1/0)}function Q(t,e,n){return H!==K?H(t,e):null==t?q:J(t)?D(t,e,n):N(t)?G(t):R(t)}function R(t){return function(e){return null==e?void 0:e[t]}}var U=Math.pow(2,53)-1,V=R("length"),W=function(t){var e=V(t);return"number"==typeof e&&e>=0&&e<=U};var X=!{toString:null}.propertyIsEnumerable("toString"),Y=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];!function(t){for(var e={},n=$(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r]}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"});var Z,tt,et=(Z=function(t,e,n){t[n]=e},function(t,e,n){var r=tt?[[],[]]:{};return e=Q(e,n),function(t,e,n){var r,i;if(e=D(e,n),W(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=$(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}}(t,function(n,i){var o=e(n,i,t);Z(r,n,o)}),r});var nt={add:function(t){var e=this,n=this.get().highlighted;n.indexOf(t)<0&&n.push(t),this.set({highlighted:n}),setTimeout(function(){return e.set({selected:"---"})},30)},remove:function(t){var e=this.get().highlighted;e.splice(e.indexOf(t),1),this.set({highlighted:e})}};function rt(t){return JSON.parse(JSON.stringify(t))}function it(t){var e=this._svelte,n=e.component,r=e.ctx;n.remove(r.el.key)}function ot(t,e,n){var r=Object.create(t);return r.el=e[n],r}function st(t,e,n){var r=Object.create(t);return r.element=e[n],r}function at(t,e){var o,u,c,f=e.element.label;return{c:function(){o=s("option"),u=a(f),o.__value=c=e.element.key,o.value=o.__value},m:function(t,e){r(t,o,e),n(o,u)},p:function(t,e){t.elements&&f!==(f=e.element.label)&&h(u,f),t.elements&&c!==(c=e.element.key)&&(o.__value=c),o.value=o.__value},d:function(t){t&&i(o)}}}function ut(t,e){var o,f,l,d,g,p,v,_=e.el.key;return{c:function(){o=s("span"),f=s("i"),l=a(" "),d=a(_),v=a("\n        Â "),f._svelte={component:t,ctx:e},u(f,"click",it),f.className="fa fa-remove",o.dataset.series=g=e.el.key,o.className=p="badge "+(e.el.valid?"badge-info":"")},m:function(t,e){r(t,o,e),n(o,f),n(o,l),n(o,d),r(t,v,e)},p:function(t,n){e=n,f._svelte.ctx=e,t.highlightedElements&&_!==(_=e.el.key)&&h(d,_),t.highlightedElements&&g!==(g=e.el.key)&&(o.dataset.series=g),t.highlightedElements&&p!==(p="badge "+(e.el.valid?"badge-info":""))&&(o.className=p)},d:function(t){t&&i(o),c(f,"click",it),t&&i(v)}}}function ct(t){var h=this;!function(t,e){t._handlers=d(),t._slots=d(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}(this,t),this._state=e(e(this.store._init(["vis"]),{selected:"---",highlighted:[]}),t.data),this.store._add(this,["vis"]),this._recompute({$vis:1,highlighted:1,elements:1},this._state),this._intro=!0,this._handlers.destroy=[k],this._fragment=function(t,e){for(var h,d,g,p,v,_,m,y,b,k,w,N,O=E("Highlight the most import elements (optional)"),j=E("select element"),x=!1,S=e.elements,C=[],P=0;P<S.length;P+=1)C[P]=at(0,st(e,S,P));function M(){x=!0,t.set({selected:function(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(v)}),x=!1}var L=e.highlightedElements,$=[];for(P=0;P<L.length;P+=1)$[P]=ut(t,ot(e,L,P));return{c:function(){h=s("div"),d=s("label"),g=a("\n    "),p=s("div"),v=s("select"),_=s("option"),m=a("- "),y=s("noscript"),b=s("noscript"),k=a(" -");for(var n=0;n<C.length;n+=1)C[n].c();for(w=a("\n    "),N=s("p"),n=0;n<$.length;n+=1)$[n].c();d.className="separator",_.__value="---",_.value=_.__value,u(v,"change",M),"selected"in e||t.root._beforecreate.push(M),v.id="highlight-series",v.className="span2",N.className="highlighted-series",f(N,"margin-top","5px"),h.className="story-highlight control-group",f(h,"clear","both")},m:function(t,i){r(t,h,i),n(h,d),d.innerHTML=O,n(h,g),n(h,p),n(p,v),n(v,_),n(_,m),n(_,y),y.insertAdjacentHTML("afterend",j),n(_,b),n(_,k);for(var o=0;o<C.length;o+=1)C[o].m(v,null);for(l(v,e.selected),n(h,w),n(h,N),o=0;o<$.length;o+=1)$[o].m(N,null)},p:function(e,n){if(e.elements){S=n.elements;for(var r=0;r<S.length;r+=1){var i=st(n,S,r);C[r]?C[r].p(e,i):(C[r]=at(0,i),C[r].c(),C[r].m(v,null))}for(;r<C.length;r+=1)C[r].d(1);C.length=S.length}if(!x&&e.selected&&l(v,n.selected),e.highlightedElements){for(L=n.highlightedElements,r=0;r<L.length;r+=1){var o=ot(n,L,r);$[r]?$[r].p(e,o):($[r]=ut(t,o),$[r].c(),$[r].m(N,null))}for(;r<$.length;r+=1)$[r].d(1);$.length=L.length}},d:function(t){t&&i(h),o(C,t),c(v,"change",M),o($,t)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this;this.store.observe("vis",function(e){e&&(t.set({highlighted:rt(e.get("highlighted-series"))}),e.chart().onChange(function(n,r){"metadata.visualize.highlighted-series"===r&&t.set({highlighted:rt(e.get("highlighted-series"))})}))}),this.observe("highlighted",function(e){var n=t.store.get().vis;n&&JSON.stringify(n.get("highlighted-series"))!==JSON.stringify(e)&&n&&n.chart().set("metadata.visualize.highlighted-series",rt(e))}),this.observe("selected",function(e){e&&"---"!==e&&t.add(e)})}).call(h),h.fire("update",{changed:function(t,e){for(var n in e)t[n]=1;return t}({},h._state),current:h._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this))}function ht(t,n){this._handlers={},this._dependents=[],this._computed=d(),this._sortedComputedProperties=[],this._state=e({},t),this._differs=n&&n.immutable?p:g}e(ct.prototype,w),e(ct.prototype,nt),ct.prototype._recompute=function(t,e){var n;t.$vis&&this._differs(e.elements,e.elements=(n=e.$vis)?n.keys().sort().map(function(t){var e=n.keyLabel(t);return{key:t,label:t+(t!==e?" ("+e+")":"")}}):[])&&(t.elements=!0),(t.highlighted||t.elements)&&this._differs(e.highlightedElements,e.highlightedElements=function(t){var e=t.highlighted,n=t.elements,r=et(n,"key");return e.map(function(t){return{key:t,valid:r[t]}})}(e))&&(t.highlightedElements=!0)},e(ht.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},n=0;n<t.length;n+=1){var r=t[n];e["$"+r]=this._state[r]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,n){var r=this,i=this._state;this._state=e(e({},i),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)r._sortedComputedProperties[o].update(r._state,n);this.fire("state",{changed:n,previous:i,current:this._state}),this._dependents.filter(function(t){for(var e={},i=!1,o=0;o<t.props.length;o+=1){var s=t.props[o];s in n&&(e["$"+s]=r._state[s],i=!0)}if(i)return t.component._stage(e),!0}).forEach(function(t){t.component.set({})}),this.fire("update",{changed:n,previous:i,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,n=this._sortedComputedProperties=[],r=d();function i(o){var s=e[o];s&&(s.deps.forEach(function(e){if(e===t)throw new Error("Cyclical dependency detected between "+e+" <-> "+o);i(e)}),r[o]||(r[o]=!0,n.push(s)))}for(var o in this._computed)i(t=o)},compute:function(t,n,r){var i,o=this,s={deps:n,update:function(e,s,a){var u=n.map(function(t){return t in s&&(a=!0),e[t]});if(a){var c=r.apply(null,u);o._differs(c,i)&&(i=c,s[t]=!0,e[t]=i)}}};this._computed[t]=s,this._sortComputedProperties();var a=e({},this._state),u={};s.update(a,u,!0),this._set(a,u)},fire:v,get:m,on:y,set:function(t){var e=this._state,n=this._changed={},r=!1;for(var i in t){if(this._computed[i])throw new Error("'"+i+"' is a read-only computed property");this._differs(t[i],e[i])&&(n[i]=r=!0)}r&&this._set(t,n)}});return{App:ct,data:{chart:{id:""}},store:new ht({}),init:function(t){window.dw.backend.on("dataset-loaded",function(){t.store.set({dataset:chart.dataset()})}).on("theme-changed-and-loaded",function(){t.store.set({theme:window.dw.theme(chart.get("theme"))})}).on("backend-vis-loaded",function(e){t.store.set({vis:e})})}}});
