!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chroma"),require("Handsontable")):"function"==typeof define&&define.amd?define(["chroma","Handsontable"],e):t.controls=e(t.chroma,t.HOT)}(this,function(t,e){"use strict";function n(){}function o(t){for(var e,n,o=arguments,i=1,r=arguments.length;i<r;i++)for(e in n=o[i])t[e]=n[e];return t}function i(t,e){e.appendChild(t)}function r(t,e,n){e.insertBefore(t,n)}function s(t){t.parentNode.removeChild(t)}function a(t,e){for(;t.nextSibling&&t.nextSibling!==e;)t.parentNode.removeChild(t.nextSibling)}function c(t){for(;t.nextSibling;)t.parentNode.removeChild(t.nextSibling)}function l(t){for(var e=0;e<t.length;e+=1)t[e]&&t[e].d()}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return document.createComment("")}function f(t,e,n){t.addEventListener(e,n,!1)}function p(t,e,n){t.removeEventListener(e,n,!1)}function m(t,e,n){t.setAttribute(e,n)}function v(t){return""===t?void 0:+t}function g(t,e,n){t.style.setProperty(e,n)}function b(t,e){for(var n=0;n<t.options.length;n+=1){var o=t.options[n];if(o.__value===e)return void(o.selected=!0)}}function x(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function y(){return Object.create(null)}function k(t){this.destroy=n,this.fire("destroy"),this.set=this.get=n,!1!==t&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function C(t,e,n,o,i){for(var r in e)if(n[r]){var s=o[r],a=i[r],c=e[r];if(c)for(var l=0;l<c.length;l+=1){var u=c[l];u.__calling||(u.__calling=!0,u.call(t,s,a),u.__calling=!1)}}}function N(t,e){t._observers={pre:y(),post:y()},t._handlers=y(),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=t.root.store||e.store}function w(t){for(;t&&t.length;)t.shift()()}function M(){this.store._remove(this)}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var L,H={destroy:k,get:function(t){return t?this._state[t]:this._state},fire:function(t,e){var n=t in this._handlers&&this._handlers[t].slice();if(n)for(var o=0;o<n.length;o+=1)n[o].call(this,e)},observe:function(t,e,n){var o=n&&n.defer?this._observers.post:this._observers.pre;return(o[t]||(o[t]=[])).push(e),n&&!1===n.init||(e.__calling=!0,e.call(this,this._state[t]),e.__calling=!1),{cancel:function(){var n=o[t].indexOf(e);~n&&o[t].splice(n,1)}}},on:function(t,e){if("teardown"===t)return this.on("destroy",e);var n=this._handlers[t]||(this._handlers[t]=[]);return n.push(e),{cancel:function(){var t=n.indexOf(e);~t&&n.splice(t,1)}}},set:function(t){this._set(o({},t)),this.root._lock||(this.root._lock=!0,w(this.root._beforecreate),w(this.root._oncreate),w(this.root._aftercreate),this.root._lock=!1)},teardown:k,_recompute:n,_set:function(t){var e=this._state,n={},i=!1;for(var r in t)this._differs(t[r],e[r])&&(n[r]=i=!0);i&&(this._state=o({},e,t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(C(this,this._observers.pre,n,this._state,e),this._fragment.p(n,this._state),C(this,this._observers.post,n,this._state,e)))},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};function T(t){N(this,t),this._state=o({disabled:!1},t.data),this._fragment=function(t,e){var n,o,a,c,l,h;function m(){t.set({value:a.checked})}return{c:function(){n=u("div"),o=u("label"),a=u("input"),c=d(" "),l=d(e.label),this.h()},h:function(){f(a,"change",m),a.type="checkbox",a.disabled=e.disabled,a.className="svelte-llolt7",o.className=h="checkbox "+(e.disabled?"disabled":"")+" svelte-llolt7",n.className="control-group vis-option-group vis-option-type-checkbox"},m:function(t,s){r(n,t,s),i(o,n),i(a,o),a.checked=e.value,i(c,o),i(l,o)},p:function(t,e){a.checked=e.value,t.disabled&&(a.disabled=e.disabled),t.label&&(l.data=e.label),t.disabled&&h!==(h="checkbox "+(e.disabled?"disabled":"")+" svelte-llolt7")&&(o.className=h)},u:function(){s(n)},d:function(){p(a,"change",m)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}o(T.prototype,H);var R={bodyClick:function(t){if(L.get){var e=L.get().visible,n=t.target;if(e){for(;!n.classList.contains("color-picker-cont")&&"body"!=n.nodeName.toLowerCase();)n=n.parentNode;L.set({visible:n!=window.document.body})}}}};function S(){window.document.body.removeEventListener("click",this.bodyClick)}function I(e,n){var o=-1,i=999999;return e[0]==e[1]?"-":(e.forEach(function(e,r){var s=t.distance(e,n,"lab");s<i&&(i=s,o=r)}),e[o])}function E(t,e,n,o,i){var r=[t],s=e/n,a=0;for(o=_.isUndefined(o)?n:o,i=i||1;n-- >0;)a+=s,r.unshift(t-a),o-- >0&&r.push(t+a);return r}function O(t,e){var n,o,i=e.c;e.c_index;return{c:function(){n=u("div"),this.h()},h:function(){n.className="color",n.dataset.color=o=i,g(n,"background",i),f(n,"click",F),f(n,"dblclick",j),n._svelte={component:t,palette:e.palette,c_index:e.c_index}},m:function(t,e){r(n,t,e)},p:function(t,e){i=e.c,e.c_index,t.palette&&o!==(o=i)&&(n.dataset.color=o),t.palette&&g(n,"background",i),n._svelte.palette=e.palette,n._svelte.c_index=e.c_index},u:function(){s(n)},d:function(){p(n,"click",F),p(n,"dblclick",j)}}}function Y(t,e){var n,o,i,a=e.c;e.c_index;return{c:function(){n=u("div"),this.h()},h:function(){n.className=o="color "+(a==e.nearest_l?"selected":"")+" svelte-sffwrd",n.dataset.color=i=a,g(n,"background",a),f(n,"click",z),n._svelte={component:t,gradient_l:e.gradient_l,c_index:e.c_index}},m:function(t,e){r(n,t,e)},p:function(t,e){a=e.c,e.c_index,(t.gradient_l||t.nearest_l)&&o!==(o="color "+(a==e.nearest_l?"selected":"")+" svelte-sffwrd")&&(n.className=o),t.gradient_l&&i!==(i=a)&&(n.dataset.color=i),t.gradient_l&&g(n,"background",a),n._svelte.gradient_l=e.gradient_l,n._svelte.c_index=e.c_index},u:function(){s(n)},d:function(){p(n,"click",z)}}}function K(t,e){var n,o,i,a=e.c;e.c_index;return{c:function(){n=u("div"),this.h()},h:function(){n.className=o="color "+(a==e.nearest_c?"selected":"")+" svelte-sffwrd",n.dataset.color=i=a,g(n,"background",a),f(n,"click",D),n._svelte={component:t,gradient_c:e.gradient_c,c_index:e.c_index}},m:function(t,e){r(n,t,e)},p:function(t,e){a=e.c,e.c_index,(t.gradient_c||t.nearest_c)&&o!==(o="color "+(a==e.nearest_c?"selected":"")+" svelte-sffwrd")&&(n.className=o),t.gradient_c&&i!==(i=a)&&(n.dataset.color=i),t.gradient_c&&g(n,"background",a),n._svelte.gradient_c=e.gradient_c,n._svelte.c_index=e.c_index},u:function(){s(n)},d:function(){p(n,"click",D)}}}function A(t,e){var n,o,i,a=e.c;e.c_index;return{c:function(){n=u("div"),this.h()},h:function(){n.className=o="color "+(a==e.nearest_h?"selected":"")+" svelte-sffwrd",n.dataset.color=i=a,g(n,"background",a),f(n,"click",P),n._svelte={component:t,gradient_h:e.gradient_h,c_index:e.c_index}},m:function(t,e){r(n,t,e)},p:function(t,e){a=e.c,e.c_index,(t.gradient_h||t.nearest_h)&&o!==(o="color "+(a==e.nearest_h?"selected":"")+" svelte-sffwrd")&&(n.className=o),t.gradient_h&&i!==(i=a)&&(n.dataset.color=i),t.gradient_h&&g(n,"background",a),n._svelte.gradient_h=e.gradient_h,n._svelte.c_index=e.c_index},u:function(){s(n)},d:function(){p(n,"click",P)}}}function $(t,e){for(var n,a,c,h,m,v,_,b,x,y,k,C,N,w,M,L=!1,H=e.palette,T=[],R=0;R<H.length;R+=1)T[R]=O(t,o({},e,{palette:H,c:H[R],c_index:R}));var S=e.gradient_l,I=[];for(R=0;R<S.length;R+=1)I[R]=Y(t,o({},e,{gradient_l:S,c:S[R],c_index:R}));var E=e.gradient_c,$=[];for(R=0;R<E.length;R+=1)$[R]=K(t,o({},e,{gradient_c:E,c:E[R],c_index:R}));var F=e.gradient_h,j=[];for(R=0;R<F.length;R+=1)j[R]=A(t,o({},e,{gradient_h:F,c:F[R],c_index:R}));function z(){L=!0,t.set({color:k.value}),L=!1}function D(e){t.set({visible:!1})}return{c:function(){n=u("div"),a=u("div");for(var t=0;t<T.length;t+=1)T[t].c();c=d("\n\n        "),h=u("div");for(t=0;t<I.length;t+=1)I[t].c();m=d("\n        "),v=u("div");for(t=0;t<$.length;t+=1)$[t].c();_=d("\n        "),b=u("div");for(t=0;t<j.length;t+=1)j[t].c();x=d("\n\n        "),y=u("div"),k=u("input"),C=d("\n            "),(N=u("button")).innerHTML='<i class="icon-ok"></i>',w=d("\n            "),M=u("div"),this.h()},h:function(){a.className="palette",h.className="color-axis lightness",v.className="color-axis saturation",b.className="color-axis hue",f(k,"input",z),k.type="text",g(k,"background",e.color),g(k,"border-color",e.borderColor),g(k,"color",e.textColor),k.className="hex svelte-sffwrd",N.className="btn btn-small ok",f(N,"click",D),M.className="color selected",g(M,"background",e.color),y.className="footer",n.className="color-selector"},m:function(t,o){r(n,t,o),i(a,n);for(var s=0;s<T.length;s+=1)T[s].m(a,null);i(c,n),i(h,n);for(s=0;s<I.length;s+=1)I[s].m(h,null);i(m,n),i(v,n);for(s=0;s<$.length;s+=1)$[s].m(v,null);i(_,n),i(b,n);for(s=0;s<j.length;s+=1)j[s].m(b,null);i(x,n),i(y,n),i(k,y),k.value=e.color,i(C,y),i(N,y),i(w,y),i(M,y)},p:function(e,n){var i=n.palette;if(e.palette){for(var r=0;r<i.length;r+=1){var s=o({},n,{palette:i,c:i[r],c_index:r});T[r]?T[r].p(e,s):(T[r]=O(t,s),T[r].c(),T[r].m(a,null))}for(;r<T.length;r+=1)T[r].u(),T[r].d();T.length=i.length}var c=n.gradient_l;if(e.gradient_l||e.nearest_l){for(r=0;r<c.length;r+=1){var l=o({},n,{gradient_l:c,c:c[r],c_index:r});I[r]?I[r].p(e,l):(I[r]=Y(t,l),I[r].c(),I[r].m(h,null))}for(;r<I.length;r+=1)I[r].u(),I[r].d();I.length=c.length}var u=n.gradient_c;if(e.gradient_c||e.nearest_c){for(r=0;r<u.length;r+=1){var d=o({},n,{gradient_c:u,c:u[r],c_index:r});$[r]?$[r].p(e,d):($[r]=K(t,d),$[r].c(),$[r].m(v,null))}for(;r<$.length;r+=1)$[r].u(),$[r].d();$.length=u.length}var f=n.gradient_h;if(e.gradient_h||e.nearest_h){for(r=0;r<f.length;r+=1){var p=o({},n,{gradient_h:f,c:f[r],c_index:r});j[r]?j[r].p(e,p):(j[r]=A(t,p),j[r].c(),j[r].m(b,null))}for(;r<j.length;r+=1)j[r].u(),j[r].d();j.length=f.length}L||(k.value=n.color),e.color&&g(k,"background",n.color),e.borderColor&&g(k,"border-color",n.borderColor),e.textColor&&g(k,"color",n.textColor),e.color&&g(M,"background",n.color)},u:function(){s(n);for(var t=0;t<T.length;t+=1)T[t].u();for(t=0;t<I.length;t+=1)I[t].u();for(t=0;t<$.length;t+=1)$[t].u();for(t=0;t<j.length;t+=1)j[t].u()},d:function(){l(T),l(I),l($),l(j),p(k,"input",z),p(N,"click",D)}}}function F(t){var e=this._svelte.component,n=this._svelte.palette[this._svelte.c_index];e.set({color:n})}function j(t){var e=this._svelte.component,n=this._svelte.palette[this._svelte.c_index];e.set({color:n,visible:!1})}function z(t){var e=this._svelte.component,n=this._svelte.gradient_l[this._svelte.c_index];e.set({color:n})}function D(t){var e=this._svelte.component,n=this._svelte.gradient_c[this._svelte.c_index];e.set({color:n})}function P(t){var e=this._svelte.component,n=this._svelte.gradient_h[this._svelte.c_index];e.set({color:n})}function q(t){N(this,t),this._state=o({palette:[],color:"#63c0de",visible:!1},t.data),this._recompute({color:1,palette:1,gradient_l:1,gradient_c:1,gradient_h:1},this._state),this._handlers.destroy=[S];var e=function(){var t=this;t.observe("color",function(e,n){t.get().visible&&e!=n&&t.fire("change",e)}),L=this,window.document.body.addEventListener("click",this.bodyClick)}.bind(this);t.root||(this._oncreate=[]),this._fragment=function(t,e){var n,o,a;function c(e){t.set({visible:!0})}var l=e.visible&&e.color&&$(t,e);return{c:function(){n=u("div"),(o=u("div")).innerHTML='<div class="arrow"></div>',a=d("\n    "),l&&l.c(),this.h()},h:function(){o.className="base-color-picker color-picker",g(o,"background",e.color+" none repeat scroll 0% 0%"),f(o,"click",c),n.className="color-picker-cont svelte-sffwrd"},m:function(t,e){r(n,t,e),i(o,n),i(a,n),l&&l.m(n,null)},p:function(e,i){e.color&&g(o,"background",i.color+" none repeat scroll 0% 0%"),i.visible&&i.color?l?l.p(e,i):((l=$(t,i)).c(),l.m(n,null)):l&&(l.u(),l.d(),l=null)},u:function(){s(n),l&&l.u()},d:function(){p(o,"click",c),l&&l.d()}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),w(this._oncreate))}function G(t,e,n,o,i){return t&&e?(n?_.unique(t.axes(!0)[n].values()):t.colorKeys?t.colorKeys():t.keys()).map(function(t){var e;return e=t,{key:t=dw.utils.purifyHtml(e,""),defined:void 0!==o[t],color:void 0!==o[t]?B(o[t],i):"#cccccc"}}):[]}o(q.prototype,R,H),q.prototype._recompute=function(e,n){var o,i,r;e.color&&this._differs(n.gradient_l,n.gradient_l=(o=n.color,i=t(o).lch(),r=E(70,55,7,6).map(function(e){return t.lch(e,i[1],i[2]).hex()}),t.scale(["#000000"].concat(r).concat("#ffffff")).mode("lch").gamma(.8).padding(.1).colors(14)))&&(e.gradient_l=!0),(e.color||e.palette)&&this._differs(n.gradient_c,n.gradient_c=function(e,n){var o=t(e).set("lch.c",120);isNaN(o.get("lch.h"))&&(o=t.lch(o.get("lch.l"),50,t(n[0]).get("lch.h")));var i=t(e).set("lch.c",3);return t.scale([i,o]).mode("lch").gamma(1.2).colors(14)}(n.color,n.palette))&&(e.gradient_c=!0),e.color&&this._differs(n.gradient_h,n.gradient_h=function(e){var n=t(e).lch(),o=E(n[2],75,7,6).map(function(e){return t.lch(n[0],n[1],e).hex()});return t.scale(o).mode("lch").colors(14)}(n.color))&&(e.gradient_h=!0),(e.color||e.gradient_l)&&this._differs(n.nearest_l,n.nearest_l=function(t,e){return I(e,t)}(n.color,n.gradient_l))&&(e.nearest_l=!0),(e.color||e.gradient_c)&&this._differs(n.nearest_c,n.nearest_c=function(t,e){return I(e,t)}(n.color,n.gradient_c))&&(e.nearest_c=!0),(e.color||e.gradient_h)&&this._differs(n.nearest_h,n.nearest_h=function(t,e){return I(e,t)}(n.color,n.gradient_h))&&(e.nearest_h=!0),e.color&&(this._differs(n.textColor,n.textColor=function(e){return t(e).get("lab.l")>60?"black":"white"}(n.color))&&(e.textColor=!0),this._differs(n.borderColor,n.borderColor=function(e){return t(e).darker().hex()}(n.color))&&(e.borderColor=!0))};var Q={update:function(t){var e=this.get().palette;this.set({value:V(t,e)})},updateCustom:function(t){var e=this.get(),n=e.selected,o=e.palette,i=e.custom;n.forEach(function(e){return i[e]=V(t,o)}),this.set({custom:i})},toggle:function(t){t.preventDefault(),this.set({expanded:!this.get("expanded")})},toggleSelect:function(t,e){e.preventDefault();var n=this.get().selected,o=n.indexOf(t);e.shiftKey?o>-1?n.splice(o,1):n.push(t):(n.length=1,n[0]=t),this.set({selected:n})},getColor:function(t){return B(t,this.get().palette)},reset:function(){var t=this.get(),e=t.selected,n=t.custom;e.forEach(function(t){return delete n[t]}),this.set({custom:n})},resetAll:function(){var t=this.get().custom;Object.keys(t).forEach(function(e){return delete t[e]}),this.set({custom:t})},selectAll:function(t){t.preventDefault();var e=this.get(),n=e.selected;e.colorKeys.forEach(function(t){n.indexOf(t.key)<0&&n.push(t.key)}),this.set({selected:n})},selectNone:function(t){t.preventDefault();var e=this.get().selected;e.length=0,this.set({selected:e})},selectInvert:function(t){t.preventDefault();var e=this.get(),n=e.selected,o=e.colorKeys;console.log(n),o.forEach(function(t){var e=n.indexOf(t.key);e<0?n.push(t.key):n.splice(e,1)}),console.log(n),this.set({selected:n})}};function V(t,e){var n=e.indexOf(t);return n>-1?n:t}function B(t,e){return"number"==typeof t?e[t%e.length]:t}function U(t,e){var n={},o={color:e.hexColor,palette:e.palette};"open"in e&&(o.visible=e.open,n.visible=!0);var i=new q({root:t.root,data:o,_bind:function(e,o){t.get();var i={};!n.visible&&e.visible&&(i.open=o.visible),t._set(i),n={}}});return t.root._beforecreate.push(function(){i._bind({visible:1},i.get())}),i.on("change",function(e){t.update(e)}),{c:function(){i._fragment.c()},m:function(t,e){i._mount(t,e)},p:function(t,e){var o={};t.hexColor&&(o.color=e.hexColor),t.palette&&(o.palette=e.palette),!n.visible&&t.open&&(o.visible=e.open,n.visible=!0),i._set(o),n={}},u:function(){i._unmount()},d:function(){i.destroy(!1)}}}function J(t,e){var n,o,a;function c(e){t.toggle(e)}return{c:function(){n=u("span"),(o=u("a")).textContent="customize colors...",this.h()},h:function(){o.href="#customize",o.className=a="btn btn-small custom "+(e.expanded?"btn-primary":""),m(o,"role","button"),f(o,"click",c),n.className="custom-color-selector-head"},m:function(t,e){r(n,t,e),i(o,n)},p:function(t,e){t.expanded&&a!==(a="btn btn-small custom "+(e.expanded?"btn-primary":""))&&(o.className=a)},u:function(){s(n)},d:function(){p(o,"click",c)}}}function W(t,e){var n,o,a,c,l,h,m,v,_=e.k,b=(e.k_index,_.defined?"":"×"),x=_.key;return{c:function(){n=u("li"),o=u("div"),a=d(b),c=d("\n                    "),l=u("label"),h=d(x),this.h()},h:function(){o.className="color",g(o,"background",_.color),n.className=m=e.selected.indexOf(_.key)>-1?"selected":"",n.dataset.series=v=_.key,f(n,"click",et),n._svelte={component:t,colorKeys:e.colorKeys,k_index:e.k_index}},m:function(t,e){r(n,t,e),i(o,n),i(a,o),i(c,n),i(l,n),i(h,l)},p:function(t,e){_=e.k,e.k_index,t.colorKeys&&b!==(b=_.defined?"":"×")&&(a.data=b),t.colorKeys&&g(o,"background",_.color),t.colorKeys&&x!==(x=_.key)&&(h.data=x),(t.selected||t.colorKeys)&&m!==(m=e.selected.indexOf(_.key)>-1?"selected":"")&&(n.className=m),t.colorKeys&&v!==(v=_.key)&&(n.dataset.series=v),n._svelte.colorKeys=e.colorKeys,n._svelte.k_index=e.k_index},u:function(){s(n)},d:function(){p(n,"click",et)}}}function X(t,e){var n,o,a,c={},l={color:e.customColor,palette:e.palette};"openCustom"in e&&(l.visible=e.openCustom,c.visible=!0);var h=new q({root:t.root,data:l,_bind:function(e,n){t.get();var o={};!c.visible&&e.visible&&(o.openCustom=n.visible),t._set(o),c={}}});function m(e){t.reset()}return t.root._beforecreate.push(function(){h._bind({visible:1},h.get())}),h.on("change",function(e){t.updateCustom(e)}),{c:function(){n=u("div"),h._fragment.c(),o=d("\n                "),(a=u("button")).textContent="Reset",this.h()},h:function(){a.className="btn",f(a,"click",m),n.className="select"},m:function(t,e){r(n,t,e),h._mount(n,null),i(o,n),i(a,n)},p:function(t,e){var n={};t.customColor&&(n.color=e.customColor),t.palette&&(n.palette=e.palette),!c.visible&&t.openCustom&&(n.visible=e.openCustom,c.visible=!0),h._set(n),c={}},u:function(){s(n)},d:function(){h.destroy(!1),p(a,"click",m)}}}function Z(t,e){var o;return{c:function(){(o=u("div")).textContent="Please select an element on the left to change colors for individual elements...",this.h()},h:function(){o.className="info"},m:function(t,e){r(o,t,e)},p:n,u:function(){s(o)},d:n}}function tt(t,e){for(var n,a,c,h,m,v,_,b,x,y,k,C,N,w,M,L,H,T,R,S,I=e.colorKeys,E=[],O=0;O<I.length;O+=1)E[O]=W(t,o({},e,{colorKeys:I,k:I[O],k_index:O}));function Y(e){t.selectAll(e)}function K(e){t.selectNone(e)}function A(e){t.selectInvert(e)}function $(t){return t.selected.length?X:Z}var F=$(e),j=F(t,e);function z(e){t.resetAll()}return{c:function(){n=u("div"),a=u("div"),c=u("div"),(h=u("h4")).textContent="Select element(s):",m=d("\n            "),v=u("ul");for(var t=0;t<E.length;t+=1)E[t].c();_=d("\n            "),b=u("div"),x=d("Select:  \n                "),(y=u("a")).textContent="all",k=d("  \n                "),(C=u("a")).textContent="none",N=d("  \n                "),(w=u("a")).textContent="invert",M=d("\n        "),L=u("div"),(H=u("h4")).textContent="Choose a color:",T=d("\n            "),j.c(),R=d("\n            "),(S=u("button")).textContent="Reset all colors",this.h()},h:function(){v.className="dataseries unstyled",y.href="#/select-all",f(y,"click",Y),C.href="#/select-none",f(C,"click",K),w.href="#/select-invert",f(w,"click",A),g(b,"font-size","12px"),g(b,"text-align","center"),g(b,"margin-bottom","10px"),c.className="span2",g(c,"width","43%"),g(S,"margin-top","20px"),S.className="btn",f(S,"click",z),L.className="span2",g(L,"width","42%"),a.className="row",n.className="custom-color-selector-body",g(n,"display","block")},m:function(t,e){r(n,t,e),i(a,n),i(c,a),i(h,c),i(m,c),i(v,c);for(var o=0;o<E.length;o+=1)E[o].m(v,null);i(_,c),i(b,c),i(x,b),i(y,b),i(k,b),i(C,b),i(N,b),i(w,b),i(M,a),i(L,a),i(H,L),i(T,L),j.m(L,null),i(R,L),i(S,L)},p:function(e,n){var i=n.colorKeys;if(e.colorKeys||e.selected){for(var r=0;r<i.length;r+=1){var s=o({},n,{colorKeys:i,k:i[r],k_index:r});E[r]?E[r].p(e,s):(E[r]=W(t,s),E[r].c(),E[r].m(v,null))}for(;r<E.length;r+=1)E[r].u(),E[r].d();E.length=i.length}F===(F=$(n))&&j?j.p(e,n):(j.u(),j.d(),(j=F(t,n)).c(),j.m(L,R))},u:function(){s(n);for(var t=0;t<E.length;t+=1)E[t].u();j.u()},d:function(){l(E),p(y,"click",Y),p(C,"click",K),p(w,"click",A),j.d(),p(S,"click",z)}}}function et(t){var e=this._svelte.component,n=this._svelte.colorKeys[this._svelte.k_index];e.toggleSelect(n.key,t)}function nt(t){N(this,t),this._state=o(this.store._init(["vis","theme"]),{open:!1,openCustom:!1,customizable:!1,expanded:!1,selected:[],custom:{}},t.data),this.store._add(this,["vis","theme"]),this._recompute({$theme:1,$vis:1,customizable:1,axis:1,custom:1,palette:1,value:1,selected:1},this._state),this._handlers.destroy=[M];var e,n,a,c,l,f,p,m,v,_,b,x,y=function(){var t=this;this.observe("custom",function(e){e&&0===e.length&&(e={}),t.set({custom:e})})}.bind(this);t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=(e=this,n=this._state,_=n.hexColor&&U(e,n),b=n.customizable&&J(e,n),x=n.customizable&&n.expanded&&tt(e,n),{c:function(){a=u("div"),c=u("label"),l=d("\n    "),f=u("div"),_&&_.c(),p=d("\n\n        "),b&&b.c(),m=d("\n\n"),x&&x.c(),v=h(),this.h()},h:function(){c.className="control-label",g(c,"width","100px"),f.className="controls",a.className="control-group vis-option-type-color"},m:function(t,e){r(a,t,e),i(c,a),c.innerHTML=n.label,i(l,a),i(f,a),_&&_.m(f,null),i(p,f),b&&b.m(f,null),r(m,t,e),x&&x.m(t,e),r(v,t,e)},p:function(t,n){t.label&&(c.innerHTML=n.label),n.hexColor?_?_.p(t,n):((_=U(e,n)).c(),_.m(f,p)):_&&(_.u(),_.d(),_=null),n.customizable?b?b.p(t,n):((b=J(e,n)).c(),b.m(f,null)):b&&(b.u(),b.d(),b=null),n.customizable&&n.expanded?x?x.p(t,n):((x=tt(e,n)).c(),x.m(v.parentNode,v)):x&&(x.u(),x.d(),x=null)},u:function(){c.innerHTML="",s(a),_&&_.u(),b&&b.u(),s(m),x&&x.u(),s(v)},d:function(){_&&_.d(),b&&b.d(),x&&x.d()}}),this.root._oncreate.push(y),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,w(this._beforecreate),w(this._oncreate),w(this._aftercreate),this._lock=!1)}function ot(t,e){var o,c,l,h,f;return{c:function(){o=u("div"),c=d("For help on custom formats, check the "),l=u("noscript"),h=u("noscript"),f=d("."),this.h()},h:function(){o.className="small svelte-h47p2z"},m:function(t,n){r(o,t,n),i(c,o),i(l,o),l.insertAdjacentHTML("afterend",e.customFormatHelp),i(h,o),i(f,o)},p:function(t,e){t.customFormatHelp&&(a(l,h),l.insertAdjacentHTML("afterend",e.customFormatHelp))},u:function(){a(l,h),s(o)},d:n}}function it(t,e){var o,a,c,l=e.opt,h=(e.opt_index,l.l);return{c:function(){o=u("option"),a=d(h),this.h()},h:function(){o.__value=c=l.f,o.value=o.__value},m:function(t,e){r(o,t,e),i(a,o)},p:function(t,e){l=e.opt,e.opt_index,t.options&&h!==(h=l.l)&&(a.data=h),t.options&&c!==(c=l.f)&&(o.__value=c),o.value=o.__value},u:function(){s(o)},d:n}}function rt(t,e){var n,o=!1;function i(){o=!0,t.set({custom:n.value}),o=!1}return{c:function(){n=u("input"),this.h()},h:function(){f(n,"input",i),n.type="text",n.className="svelte-h47p2z"},m:function(t,o){r(n,t,o),n.value=e.custom},p:function(t,e){o||(n.value=e.custom)},u:function(){s(n)},d:function(){p(n,"input",i)}}}function st(t){N(this,t),this._state=o(this.store._init(["vis","dataset"]),{axis:!1,value:"",custom:"",selected:null},t.data),this.store._add(this,["vis","dataset"]),this._recompute({$vis:1,$dataset:1,axis:1,axisCol:1},this._state),this._handlers.destroy=[M];var e=function(){var t=this;this.observe("selected",function(e,n){e!=n&&t.set({value:"custom"!=e?e:t.get("custom")+" "})}),this.observe("value",function(e,n){if(e!=n){for(var o=0,i=t.get().options;o<i.length;o+=1)if(i[o].f==e)return t.set({selected:e});t.set({selected:"custom",custom:e})}}),this.observe("custom",function(e,n){e!=n&&"custom"==t.get().selected&&t.set({value:e})})}.bind(this);t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){for(var n,a,c,h,m,v,_,g,y,k=!1,C="custom"==e.selected&&ot(0,e),N=e.options,w=[],M=0;M<N.length;M+=1)w[M]=it(0,o({},e,{options:N,opt:N[M],opt_index:M}));function L(){k=!0,t.set({selected:x(v)}),k=!1}var H="custom"==e.selected&&rt(t,e);return{c:function(){n=u("div"),a=u("label"),c=d("\n\n    "),h=u("div"),C&&C.c(),m=d("\n\n        "),v=u("select");for(var t=0;t<w.length;t+=1)w[t].c();_=u("option"),g=d("(custom)"),y=d("\n        "),H&&H.c(),this.h()},h:function(){a.className="control-label svelte-h47p2z",_.__value="custom",_.value=_.__value,f(v,"change",L),"selected"in e||t.root._beforecreate.push(L),v.className="svelte-h47p2z",h.className="controls form-inline",n.className="control-group vis-option-custom-format"},m:function(t,o){r(n,t,o),i(a,n),a.innerHTML=e.label,i(c,n),i(h,n),C&&C.m(h,null),i(m,h),i(v,h);for(var s=0;s<w.length;s+=1)w[s].m(v,null);i(_,v),i(g,_),b(v,e.selected),i(y,h),H&&H.m(h,null)},p:function(e,n){e.label&&(a.innerHTML=n.label),"custom"==n.selected?C?C.p(e,n):((C=ot(0,n)).c(),C.m(h,m)):C&&(C.u(),C.d(),C=null);var i=n.options;if(e.options){for(var r=0;r<i.length;r+=1){var s=o({},n,{options:i,opt:i[r],opt_index:r});w[r]?w[r].p(e,s):(w[r]=it(0,s),w[r].c(),w[r].m(v,_))}for(;r<w.length;r+=1)w[r].u(),w[r].d();w.length=i.length}k||b(v,n.selected),"custom"==n.selected?H?H.p(e,n):((H=rt(t,n)).c(),H.m(h,null)):H&&(H.u(),H.d(),H=null)},u:function(){a.innerHTML="",s(n),C&&C.u();for(var t=0;t<w.length;t+=1)w[t].u();H&&H.u()},d:function(){C&&C.d(),l(w),p(v,"change",L),H&&H.d()}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),w(this._beforecreate),w(this._oncreate))}function at(t){var e,a,l,h,f,p,m,v,_,g,b,x;N(this,t),this._state=o({},t.data),this._slotted=t.slots||{},this.slots={},this._fragment=(e=this,a=this._state,x=e._slotted.default,{c:function(){l=u("div"),h=u("label"),f=u("i"),p=d("\n        "),m=u("i"),v=d("\n        "),_=u("noscript"),g=d("\n\n    "),b=u("div"),this.h()},h:function(){f.className="fa fa-chevron-up expand-group pull-right",m.className="fa fa-chevron-down collapse-group pull-right",h.className="group-title",b.className="option-group-content vis-option-type-chart-description",l.className="vis-option-type-group group-open"},m:function(t,e){r(l,t,e),i(h,l),i(f,h),i(p,h),i(m,h),i(v,h),i(_,h),_.insertAdjacentHTML("afterend",a.label),i(g,l),i(b,l),x&&i(x,b)},p:function(t,e){t.label&&(c(_),_.insertAdjacentHTML("afterend",e.label))},u:function(){c(_),s(l),x&&function(t,e){for(;t.firstChild;)e.appendChild(t.firstChild)}(b,x)},d:n}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function ct(t){N(this,t),this._state=o({unit:"",width:"100px"},t.data),this._fragment=function(t,e){var n,o,a,c,l,h,m,_,b,x,y=!1;function k(){t.set({value:v(l.value)})}function C(){t.set({value:v(l.value)})}function N(){y=!0,t.set({value:v(m.value)}),y=!1}return{c:function(){n=u("div"),o=u("label"),a=d("\n    "),c=u("div"),l=u("input"),h=d("  "),m=u("input"),_=d(" "),b=u("span"),x=d(e.unit),this.h()},h:function(){g(o,"width",e.width),o.className="control-label",f(l,"input",k),f(l,"change",C),l.type="range",l.min=e.min,l.max=e.max,l.step=e.step,l.className="svelte-l16hlj",f(m,"input",N),m.type="number",m.min=e.min,m.max=e.max,m.step=e.step,m.className="svelte-l16hlj",b.className="unit svelte-l16hlj",c.className="controls",n.className="control-group vis-option-group vis-option-type-number"},m:function(t,s){r(n,t,s),i(o,n),o.innerHTML=e.label,i(a,n),i(c,n),i(l,c),l.value=e.value,i(h,c),i(m,c),m.value=e.value,i(_,c),i(b,c),i(x,b)},p:function(t,e){t.label&&(o.innerHTML=e.label),t.width&&g(o,"width",e.width),l.value=e.value,l.value=e.value,t.min&&(l.min=e.min),t.max&&(l.max=e.max),t.step&&(l.step=e.step),y||(m.value=e.value),t.min&&(m.min=e.min),t.max&&(m.max=e.max),t.step&&(m.step=e.step),t.unit&&(x.data=e.unit)},u:function(){o.innerHTML="",s(n)},d:function(){p(l,"input",k),p(l,"change",C),p(m,"input",N)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function lt(t,e){var n,o,a,c,l,h=e.opt,m=(e.opt_index,h.label);function v(){t.set({value:o.__value})}return{c:function(){n=u("label"),o=u("input"),c=d(" "),l=d(m),this.h()},h:function(){t._bindingGroups[0].push(o),f(o,"change",v),o.type="radio",o.__value=a=h.value,o.value=o.__value,n.className="radio"},m:function(t,s){r(n,t,s),i(o,n),o.checked=o.__value===e.value,i(c,n),i(l,n)},p:function(t,e){h=e.opt,e.opt_index,o.checked=o.__value===e.value,t.options&&a!==(a=h.value)&&(o.__value=a),o.value=o.__value,t.options&&m!==(m=h.label)&&(l.data=m)},u:function(){s(n)},d:function(){t._bindingGroups[0].splice(t._bindingGroups[0].indexOf(o),1),p(o,"change",v)}}}function ut(t){N(this,t),this._state=o({},t.data),this._bindingGroups=[[]],this._fragment=function(t,e){for(var n,a,c,h,f=e.options,p=[],m=0;m<f.length;m+=1)p[m]=lt(t,o({},e,{options:f,opt:f[m],opt_index:m}));return{c:function(){n=u("div"),a=u("label"),c=d("\n\n    "),h=u("div");for(var t=0;t<p.length;t+=1)p[t].c();this.h()},h:function(){a.className="control-label",h.className="controls form-inline",n.className="control-group vis-option-group vis-option-type-radio"},m:function(t,o){r(n,t,o),i(a,n),a.innerHTML=e.label,i(c,n),i(h,n);for(var s=0;s<p.length;s+=1)p[s].m(h,null)},p:function(e,n){e.label&&(a.innerHTML=n.label);var i=n.options;if(e.options||e.value){for(var r=0;r<i.length;r+=1){var s=o({},n,{options:i,opt:i[r],opt_index:r});p[r]?p[r].p(e,s):(p[r]=lt(t,s),p[r].c(),p[r].m(h,null))}for(;r<p.length;r+=1)p[r].u(),p[r].d();p.length=i.length}},u:function(){a.innerHTML="",s(n);for(var t=0;t<p.length;t+=1)p[t].u()},d:function(){l(p)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor))}function dt(t,e){var o,a,c,l=e.opt,h=(e.opt_index,l.label);return{c:function(){o=u("option"),a=d(h),this.h()},h:function(){o.__value=c=l.value,o.value=o.__value},m:function(t,e){r(o,t,e),i(a,o)},p:function(t,e){l=e.opt,e.opt_index,t.options&&h!==(h=l.label)&&(a.data=h),t.options&&c!==(c=l.value)&&(o.__value=c),o.value=o.__value},u:function(){s(o)},d:n}}function ht(t,e){for(var n,i=e.options,a=[],c=0;c<i.length;c+=1)a[c]=dt(0,o({},e,{options:i,opt:i[c],opt_index:c}));return{c:function(){for(var t=0;t<a.length;t+=1)a[t].c();n=h()},m:function(t,e){for(var o=0;o<a.length;o+=1)a[o].m(t,e);r(n,t,e)},p:function(t,e){var i=e.options;if(t.options){for(var r=0;r<i.length;r+=1){var s=o({},e,{options:i,opt:i[r],opt_index:r});a[r]?a[r].p(t,s):(a[r]=dt(0,s),a[r].c(),a[r].m(n.parentNode,n))}for(;r<a.length;r+=1)a[r].u(),a[r].d();a.length=i.length}},u:function(){for(var t=0;t<a.length;t+=1)a[t].u();s(n)},d:function(){l(a)}}}function ft(t,e){for(var n,i,a=e.optgroup,c=(e.optgroup_index,a.options),d=[],h=0;h<c.length;h+=1)d[h]=pt(t,o({},e,{options:c,opt:c[h],opt_index:h}));return{c:function(){n=u("optgroup");for(var t=0;t<d.length;t+=1)d[t].c();this.h()},h:function(){m(n,"label",i=a.label)},m:function(t,e){r(n,t,e);for(var o=0;o<d.length;o+=1)d[o].m(n,null)},p:function(e,r){a=r.optgroup,r.optgroup_index;var s=a.options;if(e.optgroups){for(var c=0;c<s.length;c+=1){var l=o({},r,{options:s,opt:s[c],opt_index:c});d[c]?d[c].p(e,l):(d[c]=pt(t,l),d[c].c(),d[c].m(n,null))}for(;c<d.length;c+=1)d[c].u(),d[c].d();d.length=s.length}e.optgroups&&i!==(i=a.label)&&m(n,"label",i)},u:function(){s(n);for(var t=0;t<d.length;t+=1)d[t].u()},d:function(){l(d)}}}function pt(t,e){e.optgroup;var o,a,c,l=e.opt,h=(e.optgroup_index,e.opt_index,l.label);return{c:function(){o=u("option"),a=d(h),this.h()},h:function(){o.__value=c=l.value,o.value=o.__value},m:function(t,e){r(o,t,e),i(a,o)},p:function(t,e){e.optgroup,l=e.opt,e.optgroup_index,e.opt_index,t.optgroups&&h!==(h=l.label)&&(a.data=h),t.optgroups&&c!==(c=l.value)&&(o.__value=c),o.value=o.__value},u:function(){s(o)},d:n}}function mt(t,e){for(var n,i=e.optgroups,a=[],c=0;c<i.length;c+=1)a[c]=ft(t,o({},e,{optgroups:i,optgroup:i[c],optgroup_index:c}));return{c:function(){for(var t=0;t<a.length;t+=1)a[t].c();n=h()},m:function(t,e){for(var o=0;o<a.length;o+=1)a[o].m(t,e);r(n,t,e)},p:function(e,i){var r=i.optgroups;if(e.optgroups){for(var s=0;s<r.length;s+=1){var c=o({},i,{optgroups:r,optgroup:r[s],optgroup_index:s});a[s]?a[s].p(e,c):(a[s]=ft(t,c),a[s].c(),a[s].m(n.parentNode,n))}for(;s<a.length;s+=1)a[s].u(),a[s].d();a.length=r.length}},u:function(){for(var t=0;t<a.length;t+=1)a[t].u();s(n)},d:function(){l(a)}}}function vt(t){N(this,t),this._state=o({disabled:!1,width:"auto",options:[],optgroups:[]},t.data),t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){var n,o,a,c,l,m,v,_=!1,y=e.options.length&&ht(0,e),k=e.optgroups.length&&mt(t,e);function C(){_=!0,t.set({value:x(l)}),_=!1}return{c:function(){n=u("div"),o=u("label"),a=d("\n\n    "),c=u("div"),l=u("select"),y&&y.c(),m=h(),k&&k.c(),this.h()},h:function(){o.className="control-label",f(l,"change",C),"value"in e||t.root._beforecreate.push(C),l.disabled=e.disabled,g(l,"width",e.width),c.className=v="controls form-inline "+(e.disabled?"disabled":""),n.className="control-group vis-option-type-select"},m:function(t,s){r(n,t,s),i(o,n),o.innerHTML=e.label,i(a,n),i(c,n),i(l,c),y&&y.m(l,null),i(m,l),k&&k.m(l,null),b(l,e.value)},p:function(e,n){e.label&&(o.innerHTML=n.label),n.options.length?y?y.p(e,n):((y=ht(0,n)).c(),y.m(l,m)):y&&(y.u(),y.d(),y=null),n.optgroups.length?k?k.p(e,n):((k=mt(t,n)).c(),k.m(l,null)):k&&(k.u(),k.d(),k=null),_||b(l,n.value),e.disabled&&(l.disabled=n.disabled),e.width&&g(l,"width",n.width),e.disabled&&v!==(v="controls form-inline "+(n.disabled?"disabled":""))&&(c.className=v)},u:function(){o.innerHTML="",s(n),y&&y.u(),k&&k.u()},d:function(){y&&y.d(),k&&k.d(),p(l,"change",C)}}}(this,this._state),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),w(this._beforecreate))}function _t(t,e){var o,a,c=e.axis["na-label"]||"--";return{c:function(){o=u("option"),a=d(c),this.h()},h:function(){o.__value="-",o.value=o.__value},m:function(t,e){r(o,t,e),i(a,o)},p:function(t,e){t.axis&&c!==(c=e.axis["na-label"]||"--")&&(a.data=c)},u:function(){s(o)},d:n}}function gt(t,e){var o,a,c,l=e.column,h=(e.column_index,l.name);return{c:function(){o=u("option"),a=d(h),this.h()},h:function(){o.__value=c=l.name,o.value=o.__value},m:function(t,e){r(o,t,e),i(a,o)},p:function(t,e){l=e.column,e.column_index,t.columns&&h!==(h=l.name)&&(a.data=h),t.columns&&c!==(c=l.name)&&(o.__value=c),o.value=o.__value},u:function(){s(o)},d:n}}function bt(t){N(this,t),this._state=o(this.store._init(["visMeta","dataset"]),{selected:!1},t.data),this.store._add(this,["visMeta","dataset"]),this._recompute({axis:1,$visMeta:1,$dataset:1},this._state),this._handlers.destroy=[M];var e=function(){var t=this;t.observe("selected",function(e){if(e){var n=t.get().axis,o=_.clone(window.chart.get("metadata.axes",{}));"-"==e?delete o[n]:o[n]=e,window.chart.set("metadata.axes",o)}}),t.store.observe("visMeta",function(e){var n=t.get(),o=n.selected,i=n.axis;!o&&e&&(o=window.chart.get("metadata.axes")[i],t.set({selected:o}))})}.bind(this);t.root||(this._oncreate=[],this._beforecreate=[]),this._fragment=function(t,e){for(var n,a,c,m,v,_,g=!1,y=e.$visMeta&&e.$visMeta.axes[e.axis].optional&&_t(0,e),k=e.columns,C=[],N=0;N<k.length;N+=1)C[N]=gt(0,o({},e,{columns:k,column:k[N],column_index:N}));function w(){g=!0,t.set({selected:x(v)}),g=!1}return{c:function(){n=u("div"),a=u("label"),c=d("\n\n    "),m=u("div"),v=u("select"),y&&y.c(),_=h();for(var t=0;t<C.length;t+=1)C[t].c();this.h()},h:function(){a.className="control-label svelte-7khi8i",f(v,"change",w),"selected"in e||t.root._beforecreate.push(w),v.className="svelte-7khi8i",m.className="controls form-inline",n.className="control-group vis-option-group"},m:function(t,o){r(n,t,o),i(a,n),a.innerHTML=e.label,i(c,n),i(m,n),i(v,m),y&&y.m(v,null),i(_,v);for(var s=0;s<C.length;s+=1)C[s].m(v,null);b(v,e.selected)},p:function(t,e){t.label&&(a.innerHTML=e.label),e.$visMeta&&e.$visMeta.axes[e.axis].optional?y?y.p(t,e):((y=_t(0,e)).c(),y.m(v,_)):y&&(y.u(),y.d(),y=null);var n=e.columns;if(t.columns){for(var i=0;i<n.length;i+=1){var r=o({},e,{columns:n,column:n[i],column_index:i});C[i]?C[i].p(t,r):(C[i]=gt(0,r),C[i].c(),C[i].m(v,null))}for(;i<C.length;i+=1)C[i].u(),C[i].d();C.length=n.length}g||b(v,e.selected)},u:function(){a.innerHTML="",s(n),y&&y.u();for(var t=0;t<C.length;t+=1)C[t].u()},d:function(){y&&y.d(),l(C),p(v,"change",w)}}}(this,this._state),this.root._oncreate.push(e),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),w(this._beforecreate),w(this._oncreate))}o(nt.prototype,Q,H),nt.prototype._recompute=function(e,n){var o,i;e.$theme&&this._differs(n.palette,n.palette=n.$theme.colors.palette)&&(e.palette=!0),(e.$vis||e.customizable||e.axis||e.custom||e.palette)&&this._differs(n.colorKeys,n.colorKeys=G(n.$vis,n.customizable,n.axis,n.custom,n.palette))&&(e.colorKeys=!0),(e.value||e.palette)&&this._differs(n.hexColor,n.hexColor=(o=n.value,i=n.palette,B(o,i)))&&(e.hexColor=!0),(e.selected||e.palette||e.custom)&&this._differs(n.customColor,n.customColor=function(e,n,o){if(void 0===o[e[0]])return"#ccc";var i=e.filter(function(t){return void 0!==o[t]}).map(function(t){return B(o[t],n)});return i.length?t.average(i,"lab"):"#ccc"}(n.selected,n.palette,n.custom))&&(e.customColor=!0)},o(st.prototype,H),st.prototype._recompute=function(t,e){(t.$vis||t.$dataset||t.axis)&&this._differs(e.axisCol,e.axisCol=function(t,e,n){if(!t||!n)return null;var o=t.axes()[n];return e.column("object"==typeof o?o[0]:o)}(e.$vis,e.$dataset,e.axis))&&(t.axisCol=!0),t.axisCol&&(this._differs(e.customFormatHelp,e.customFormatHelp=function(t){if(t)return"date"==t.type()?'<a href="http://momentjs.com/docs/#/displaying/format/" target="_blank">moment.js documentation</a>':"number"==t.type()?'<a href="http://numeraljs.com/#format" target="_blank">numeral.js documentation</a>':""}(e.axisCol))&&(t.customFormatHelp=!0),this._differs(e.options,e.options=function(t){return t?"number"==t.type()?[{l:"1,000[.00]",f:"0,0.[00]"},{l:"0",f:"0"},{l:"0.0",f:"0.0"},{l:"0.00",f:"0.00"},{l:"0.000",f:"0.000"},{l:"0.[0]",f:"0.[0]"},{l:"0.[00]",f:"0.[00]"},{l:"0%",f:"0%"},{l:"0.0%",f:"0.0%"},{l:"0.00%",f:"0.00%"},{l:"0.[0]%",f:"0.[0]%"},{l:"0.[00]%",f:"0.[00]%"},{l:"10,000",f:"0,0"},{l:"1st",f:"0o"},{l:"123k",f:"0a"},{l:"123.4k",f:"0.[0]a"},{l:"123.45k",f:"0.[00]a"}]:"date"==t.type()?[{l:"2015, 2016",f:"YYYY"},{l:"2015 Q1, 2015 Q2",f:"YYYY [Q]Q"},{l:"2015, Q2, Q3",f:"YYYY|\\QQ"},{l:"2015, Feb, Mar",f:"YYYY|MMM"},{l:"’15, ’16",f:"’YY"},{l:"April, May",f:"MMMM"},{l:"Apr, May",f:"MMM"},{l:"Apr ’15, May ’15",f:"MMM ’YY"},{l:"April, 2, 3",f:"MMM|DD"}]:void 0:[]}(e.axisCol))&&(t.options=!0))},o(at.prototype,H),o(ct.prototype,H),o(ut.prototype,H),o(vt.prototype,H),o(bt.prototype,H),bt.prototype._recompute=function(t,e){(t.axis||t.$visMeta||t.$dataset)&&this._differs(e.columns,e.columns=function(t,e,n){var o=[];return n&&e&&t?(n.eachColumn(function(n){_.indexOf(e.axes[t].accepts,n.type())>-1&&o.push({name:n.name()})}),o):[]}(e.axis,e.$visMeta,e.$dataset))&&(t.columns=!0)};var xt=null;var yt={render:function(){this.get("hot").render()},update:function(){var t=this,n=this.get(),o=n.data,i=n.transpose,r=n.firstRowIsHeader,s=n.skipRows,a=n.hot;if(o){var c=this.store.get("dw_chart"),l=c.dataset(dw.datasource.delimited({csv:o,transpose:i,firstRowIsHeader:r,skipRows:s}).parse()).dataset();this.set({columnOrder:l.columnOrder()});var u=[[]];l.eachColumn(function(t){return u[0].push(t.title())}),l.eachRow(function(t){var e=[];l.eachColumn(function(n){return e.push(n.raw(t))}),u.push(e)}),a.loadData(u);var d=kt(this,l,e);a.updateSettings({cells:function(e,n){return{readOnly:t.get().readonly||l.hasColumn(n)&&l.column(n).isComputed&&0===e,renderer:d}},manualColumnMove:[]}),this.set({ds:l}),this.set({has_changes:c.get("metadata.data.changes",[]).length>0}),e.hooks.once("afterRender",function(){return t.initCustomEvents()}),a.render()}},dataChanged:function(t){var e=this,n=this.get().hot,o=!1;t.forEach(function(t){var i=t[0],r=t[1],s=t[2],a=t[3];if(s!=a){var c=e.store.get("dw_chart"),l=e.get().transpose,u=c.get("metadata.data.changes",[]);if(i=n.toPhysicalRow(i),r=c.dataset().columnOrder()[r],l){var d=i;i=r,r=d}u.push({column:r,row:i,value:a,time:(new Date).getTime()}),c.set("metadata.data.changes",u),o=!0}}),o&&setTimeout(function(){e.update(),chart.save()},100)},columnMoved:function(t,n){var o=this,i=this.get().hot;if(t.length){var r=this.get().columnOrder,s=r.slice(0),a=r[n],c=s.splice(t[0],t.length),l=void 0===a?s.length:a?s.indexOf(a):0;s.splice.apply(s,[l,0].concat(c)),this.store.get("dw_chart").set("metadata.data.column-order",s.slice(0)),this.set({columnOrder:s}),e.hooks.once("afterRender",function(){setTimeout(function(){o.fire("resetSort"),i.selectCell(0,l,i.countRows()-1,l+c.length-1)},10)}),this.update()}},updateHeight:function(){var t=document.querySelector(".ht_master.handsontable .wtHolder .wtHider").getBoundingClientRect().height;this.refs.hot.style.height=Math.min(500,t+10)+"px"},checkRange:function(t,e,n,o){var i=this.get().hot,r=this.get().ds;this.refs;if(e!=o||0!==t||n!=i.countRows()-1)if(e==o||0!==t||n!=i.countRows()-1)this.set({activeColumn:null,multiSelection:!1});else{for(var s=[],a=Math.min(e,o);a<=Math.max(e,o);a++)s.push(+document.querySelector("#data-preview .htCore tbody tr:first-child td:nth-child("+(a+2)+")").dataset.column);this.set({multiSelection:s.map(function(t){return r.column(t)}),activeColumn:null})}},initCustomEvents:function(){var t=this;setTimeout(function(){t.refs.hot.querySelectorAll(".htCore thead th:first-child").forEach(function(t){t.removeEventListener("click",Ct),t.addEventListener("click",Ct)}),t.refs.hot.querySelectorAll(".htCore thead th+th").forEach(function(t){t.removeEventListener("click",Nt),t.addEventListener("click",Nt)})},500)},getColumnFormat:function(t){return this.store.get("dw_chart").get("metadata.data.column-format",{})[t]||{type:"auto",ignore:!1}}};function kt(t,e,n){var o={date:"fa fa-clock-o"};return function(i,r,s,a,c,l,u){if(!(e.numColumns()<=a)&&e.hasColumn(a)){var d=e.column(a),h=t.get(),f=h.searchResults,p=h.currentResult,m=h.activeColumn,v=t.getColumnFormat(d.name());if((s=i.toPhysicalRow(s))>0)l=chart.columnFormatter(d)(d.val(s-1),!0);parseInt(l)<0&&r.classList.add("negative"),r.classList.add(d.type()+"Type"),r.dataset.column=a,"text"==d.type()&&l&&l.length>70&&(l=l.substr(0,60)+"…"),0===s?(r.classList.add("firstRow"),o[d.type()]&&(l='<i class="'+o[d.type()]+'"></i> '+l)):r.classList.add(s%2?"oddRow":"evenRow"),v.ignore&&r.classList.add("ignored"),m&&m.name()==d.name()&&r.classList.add("active");var _=i.getPlugin("columnSorting").untranslateRow(s);f.forEach(function(t){t.row==_&&t.col==a&&r.classList.add("htSearchResult")}),p&&p.row==_&&p.col==a&&r.classList.add("htCurrentSearchResult"),s>0&&!d.type(!0).isValid(d.val(s-1))&&r.classList.add("parsingError"),u.readOnly&&r.classList.add("readOnly"),chart.dataCellChanged(a,s)&&r.classList.add("changed"),function(t,e,o,i,r,s,a){var c=dw.utils.purifyHtml(n.helper.stringify(s));e.innerHTML=c}(0,r,0,0,0,l)}}}function Ct(t){t.preventDefault();var e=xt.get().transpose;xt.set({transpose:!e}),xt.update()}function Nt(t){for(var e=this.parentNode.children.length,n=-1,o=0;o<e;o++)if(this.parentNode.children.item(o)==this){n=o;break}var i=+xt.refs.hot.querySelector(".htCore tbody tr:first-child td:nth-child("+(n+1)+")").dataset.column,r=xt.store.get("dw_chart"),s=xt.get(),a=s.activeColumn,c=s.hot;if(r.dataset().hasColumn(i)){var l=r.dataset().column(+i);a&&a.name()==l.name()?(t.target.parentNode.classList.remove("selected"),xt.set({activeColumn:!1}),c.deselectCell()):(t.target.parentNode.classList.add("selected"),xt.set({activeColumn:l}))}}function wt(t){N(this,t),this.refs={},this._state=o({data:"",readonly:!1,skipRows:0,firstRowIsHeader:!0,searchIndex:0,sortBy:"-",transpose:!1,activeColumn:null,search:"",searchResults:[]},t.data),this._recompute({searchResults:1,searchIndex:1},this._state);var i,a,c=function(){var t=this;xt=this,e.hooks.once("afterRender",function(){return t.initCustomEvents()}),window.addEventListener("keyup",function(e){var n=t.get(),o=n.activeColumn,i=n.ds;if(o&&("ArrowRight"==e.key||"ArrowLeft"==e.key)){e.preventDefault(),e.stopPropagation();var r=i.indexOf(o.name());"ArrowRight"==e.key?t.set({activeColumn:i.column((r+1)%i.numColumns())}):t.set({activeColumn:i.column((r-1+i.numColumns())%i.numColumns())})}});var n=this.store.get("dw_chart"),o=new e(this.refs.hot,{data:[],rowHeaders:function(t){return o.getPlugin("ColumnSorting").translateRow(t)+1},colHeaders:!0,fixedRowsTop:1,filters:!0,dropdownMenu:!0,startRows:13,startCols:8,fillHandle:!1,stretchH:"all",height:500,manualColumnMove:!0,selectionMode:"range",autoColumnSize:{useHeaders:!0,syncLimit:5},columnSorting:!0,sortIndicator:!0,sortFunction:function(t,e){if(e.col>-1){var i=n.dataset().column(e.col),r=i.type(),s=o.getPlugin("columnSorting");return function(n,o){var a;if(0===n[0])return-1;switch(n[1]=i.val(n[0]-1),o[1]=i.val(o[0]-1),"number"==r&&(isNaN(n[1])&&(n[1]=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),isNaN(o[1])&&(o[1]=t?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY)),"date"==r&&("string"==typeof n[1]&&(n[1]=new Date(110,0,1)),"string"==typeof o[1]&&(o[1]=new Date(110,0,1))),r){case"date":a=s.dateSort;break;case"number":a=s.numericSort;break;default:a=s.defaultSort}return a(t,e)(n,o)}}return function(t,e){return t[0]-e[0]}},afterGetColHeader:function(e,n){var o=t.get(),i=o.activeColumn,r=o.ds;r&&r.hasColumn(e)&&((0===e||e)&&i&&r.column(e).name()==i.name()&&n.classList.add("selected"),(0===e||e)&&(t.getColumnFormat(r.column(e).name()).ignore?n.classList.add("ignored"):n.classList.remove("ignored")))},search:"search"});window.HT=o,this.set({hot:o}),e.hooks.add("afterSetDataAtCell",function(e){return t.dataChanged(e)}),e.hooks.add("afterColumnMove",function(e,n){return t.columnMoved(e,n)}),e.hooks.add("afterRender",function(){return t.updateHeight()}),e.hooks.add("afterSelection",function(e,n,o,i){return t.checkRange(e,n,o,i)}),this.observe("data",function(){return t.update()}),this.observe("firstRowIsHeader",function(e,n){e!=n&&void 0!==n&&t.update()}),this.observe("search",function(e,n){e!=n&&t.set({searchIndex:0});var i=o.search.query(e);t.set({searchResults:i}),o.render()}),this.observe("currentResult",function(t){t&&o&&(o.render(),o.scrollViewportTo(t.row,t.col),setTimeout(function(){o.scrollViewportTo(t.row,t.col)},100))}),this.observe("activeColumn",function(){setTimeout(function(){return o.render()},10)}),this.observe("sorting",function(t){o.sort(n.dataset().indexOf(t.sortBy),t.sortDir)})}.bind(this);t.root||(this._oncreate=[]),this._fragment=(i=this,this._state,{c:function(){a=u("div"),this.h()},h:function(){a.id="data-preview"},m:function(t,e){r(a,t,e),i.refs.hot=a},p:n,u:function(){s(a)},d:function(){i.refs.hot===a&&(i.refs.hot=null)}}),this.root._oncreate.push(c),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),w(this._oncreate))}return o(wt.prototype,yt,H),wt.prototype._recompute=function(t,e){(t.searchResults||t.searchIndex)&&this._differs(e.currentResult,e.currentResult=function(t,e){if(!t||!t.length)return null;var n=t.length;if(e<0||e>=n){for(;e<0;)e+=n;e>n&&(e%=n)}return t[e]}(e.searchResults,e.searchIndex))&&(t.currentResult=!0)},{Checkbox:T,Color:nt,ColorPicker:q,Group:at,NumberInput:ct,Radio:ut,Select:vt,SelectAxisColumn:bt,CustomFormat:st,Handsontable:wt}});
