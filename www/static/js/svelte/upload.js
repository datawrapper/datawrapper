!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("../../../../../../../../../static/vendor/jschardet/jschardet.min.js"),require("../../../../../../../../../static/vendor/xlsx/xlsx.full.min.js")):"function"==typeof define&&define.amd?define("svelte/upload",["../../../../../../../../../static/vendor/jschardet/jschardet.min.js","../../../../../../../../../static/vendor/xlsx/xlsx.full.min.js"],e):(t=t||self).upload=e(t.jschardet)}(this,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function r(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n=r((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=e=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),e(r)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),o=e(n),a=r((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.default=t.exports,t.exports.__esModule=!0}));e(a);var s=r((function(t){t.exports=function(t){if(Array.isArray(t))return a(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));e(s);var i=r((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0}));e(i);var c=r((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0}));e(c);var u=r((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0}));e(u),e(r((function(t){t.exports=function(t){return s(t)||i(t)||c(t)||u()},t.exports.default=t.exports,t.exports.__esModule=!0})));var l=e(r((function(t){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},t.exports.default=t.exports,t.exports.__esModule=!0})));function d(){}function f(t,e){for(var r in e)t[r]=e[r];return t}function p(t,e){for(var r in e)t[r]=1;return t}function h(t,e){t.appendChild(e)}function v(t,e,r){t.insertBefore(e,r)}function _(t){t.parentNode.removeChild(t)}function y(t,e){for(var r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function m(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function b(t,e,r,n){t.addEventListener(e,r,n)}function x(t,e,r,n){t.removeEventListener(e,r,n)}function w(t,e,r){null==r?t.removeAttribute(e):t.setAttribute(e,r)}function D(t,e){t.data=""+e}function O(t,e){for(var r=0;r<t.options.length;r+=1){var n=t.options[r];if(n.__value===e)return void(n.selected=!0)}}function j(t){var e=t.querySelector(":checked")||t.options[0];return e&&e.__value}function S(){return Object.create(null)}function T(t,e){return t!=t?e==e:t!==e||t&&"object"===o(t)||"function"==typeof t}function P(t,e){return t!=t?e==e:t!==e}function M(t,e){var r=t in this._handlers&&this._handlers[t].slice();if(r)for(var n=0;n<r.length;n+=1){var o=r[n];if(!o.__calling)try{o.__calling=!0,o.call(this,e)}finally{o.__calling=!1}}}function C(t){t._lock=!0,E(t._beforecreate),E(t._oncreate),E(t._aftercreate),t._lock=!1}function N(){return this._state}function A(t,e){t._handlers=S(),t._slots=S(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function k(t,e){var r=this._handlers[t]||(this._handlers[t]=[]);return r.push(e),{cancel:function(){var t=r.indexOf(e);~t&&r.splice(t,1)}}}function E(t){for(;t&&t.length;)t.shift()()}var R={destroy:function(t){this.destroy=d,this.fire("destroy"),this.set=d,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:N,fire:M,on:k,set:function(t){this._set(f({},t)),this.root._lock||C(this.root)},_recompute:d,_set:function(t){var e=this._state,r={},n=!1;for(var o in t=f(this._staged,t),this._staged={},t)this._differs(t[o],e[o])&&(r[o]=n=!0);n&&(this._state=f(f({},e),t),this._recompute(r,this._state),this._bind&&this._bind(r,this._state),this._fragment&&(this.fire("state",{changed:r,current:this._state,previous:e}),this._fragment.p(r,this._state),this.fire("update",{changed:r,current:this._state,previous:e})))},_stage:function(t){f(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:T},U=e(r((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0}))),F=r((function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,e(r,n)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}));e(F);var I=e(r((function(t){t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0}))),L=r((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0}));e(L);var B=e(r((function(t){var e=n.default;t.exports=function(t,r){return!r||"object"!==e(r)&&"function"!=typeof r?L(t):r},t.exports.default=t.exports,t.exports.__esModule=!0}))),H=r((function(t){function e(r){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.default=t.exports,t.exports.__esModule=!0,e(r)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),q=e(H),X=r((function(t){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.default=t.exports,t.exports.__esModule=!0}));e(X);var $=r((function(t){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0}));e($);var J=r((function(t){function e(r,n,o){return $()?(t.exports=e=Reflect.construct,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=e=function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&F(o,r.prototype),o},t.exports.default=t.exports,t.exports.__esModule=!0),e.apply(null,arguments)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}));e(J);var G=e(r((function(t){function e(r){var n="function"==typeof Map?new Map:void 0;return t.exports=e=function(t){if(null===t||!X(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return J(t,arguments,H(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),F(e,t)},t.exports.default=t.exports,t.exports.__esModule=!0,e(r)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}))),z=r((function(t){t.exports=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||(o[r]=t[r]);return o},t.exports.default=t.exports,t.exports.__esModule=!0}));e(z);var Z=e(r((function(t){t.exports=function(t,e){if(null==t)return{};var r,n,o=z(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o},t.exports.default=t.exports,t.exports.__esModule=!0}))),K=r((function(t,e){var r;r=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function o(){}function a(e,r,a){if("undefined"!=typeof document){"number"==typeof(a=t({path:"/"},o.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var s=JSON.stringify(r);/^[\{\[]/.test(s)&&(r=s)}catch(t){}r=n.write?n.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i="";for(var c in a)a[c]&&(i+="; "+c,!0!==a[c]&&(i+="="+a[c].split(";")[0]));return document.cookie=e+"="+r+i}}function s(t,r){if("undefined"!=typeof document){for(var o={},a=document.cookie?document.cookie.split("; "):[],s=0;s<a.length;s++){var i=a[s].split("="),c=i.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=e(i[0]);if(c=(n.read||n)(c,u)||e(c),r)try{c=JSON.parse(c)}catch(t){}if(o[u]=c,t===u)break}catch(t){}}return t?o[t]:o}}return o.set=a,o.get=function(t){return s(t,!1)},o.getJSON=function(t){return s(t,!0)},o.remove=function(e,r){a(e,"",t(r,{expires:-1}))},o.defaults={},o.withConverter=r,o}((function(){}))},t.exports=r()}));function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=q(t);if(e){var o=q(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return B(this,r)}}function V(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function W(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?V(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Y=new Set(["get","head","options","trace"]);function tt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.fetch)try{e.fetch=window.fetch}catch(t){throw new Error("Neither options.fetch nor window.fetch is defined.")}if(!e.baseUrl)try{e.baseUrl="//".concat(window.dw.backend.__api_domain)}catch(t){throw new Error("Neither options.baseUrl nor window.dw is defined.")}var r,n=W(W({payload:null,raw:!1,method:"GET",mode:"cors",credentials:"include"},e),{},{headers:W({"Content-Type":"application/json"},e.headers)}),o=n.payload,a=n.baseUrl,s=n.fetch,i=n.raw,c=Z(n,["payload","baseUrl","fetch","raw"]),u="".concat(a.replace(/\/$/,""),"/").concat(t.replace(/^\//,""));if(o&&(c.body=JSON.stringify(o)),Y.has(c.method.toLowerCase()))r=s(u,c);else{var l=K.get("crumb");l?(c.headers["X-CSRF-Token"]=l,r=s(u,c)):r=tt("/v3/me",{fetch:s,baseUrl:a}).then((function(){var t=K.get("crumb");t&&(c.headers["X-CSRF-Token"]=t)})).catch((function(){})).then((function(){return s(u,c)}))}return r.then((function(t){if(i)return t;if(!t.ok)throw new rt(t);if(204===t.status||!t.headers.get("content-type"))return t;var e=t.headers.get("content-type").split(";")[0];return"application/json"===e?t.json():"image/png"===e||"application/pdf"===e?t.blob():t.text()}))}tt.get=et("GET"),tt.patch=et("PATCH"),tt.put=et("PUT"),tt.post=et("POST"),tt.head=et("HEAD");function et(t){return function(e,r){if(r&&r.method)throw new Error("Setting option.method is not allowed in httpReq.".concat(t.toLowerCase(),"()"));return tt(e,W(W({},r),{},{method:t}))}}tt.delete=et("DELETE");var rt=function(t){I(r,t);var e=Q(r);function r(t){var n;return U(this,r),(n=e.call(this)).name="HttpReqError",n.status=t.status,n.statusText=t.statusText,n.message="[".concat(t.status,"] ").concat(t.statusText),n.response=t,n}return r}(G(Error)),nt=Date.now||function(){return(new Date).getTime()};var ot,at={};function st(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"core";"chart"===t?window.__dw&&window.__dw.vis&&window.__dw.vis.meta&&(at[t]=window.__dw.vis.meta.locale||{}):at[t]="core"===t?dw.backend.__messages.core:Object.assign({},dw.backend.__messages.core,dw.backend.__messages[t])}function it(t){var e=arguments,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"core";if(t=t.trim(),at[r]||st(r),!at[r][t])return"MISSING:"+t;var n=at[r][t];return"string"==typeof n&&arguments.length>2&&(n=n.replace(/\$(\d)/g,(function(t,r){return r=2+Number(r),void 0===e[r]?t:e[r]}))),n}var ct=dw.backend.currentChart,ut=function(t,e,r){var n,o,a,s,i=0;r||(r={});var c=function(){i=!1===r.leading?0:nt(),n=null,s=t.apply(o,a),n||(o=a=null)},u=function(){var u=nt();i||!1!==r.leading||(i=u);var l=e-(u-i);return o=this,a=arguments,l<=0||l>e?(n&&(clearTimeout(n),n=null),i=u,s=t.apply(o,a),n||(o=a=null)):n||!1===r.trailing||(n=setTimeout(c,l)),s};return u.cancel=function(){clearTimeout(n),i=0,n=o=a=null},u}((function(){var t=ot.get().chartData;tt.put("/v3/charts/".concat(ct.get("id"),"/data"),{body:t,headers:{"Content-Type":"text/csv"}})}),1e3);function lt(){ot=this}function dt(t){var e=t.changed,r=t.current,n=t.previous;e.chartData&&r.chartData&&n&&n.chartData!==r.chartData&&ut()}function ft(t){var e=this;A(this,t),this._state=f({placeholder:it("upload / paste here")},t.data),this._intro=!0,this._handlers.update=[dt],this._fragment=function(t,e){var r,n,o,a=!1;function s(){a=!0,t.set({chartData:o.value}),a=!1}return{c:function(){var t,a;r=m("form"),n=m("div"),b(o=m("textarea"),"input",s),o.readOnly=e.readonly,o.id="upload-data-text",t="resize",a="none",o.style.setProperty(t,a),o.placeholder=e.placeholder,o.className="svelte-kl1kny",n.className="control-group",r.className="upload-form"},m:function(t,a){v(t,r,a),h(r,n),h(n,o),o.value=e.chartData},p:function(t,e){!a&&t.chartData&&(o.value=e.chartData),t.readonly&&(o.readOnly=e.readonly),t.placeholder&&(o.placeholder=e.placeholder)},d:function(t){t&&_(r),x(o,"input",s)}}}(this,this._state),this.root._oncreate.push((function(){lt.call(e),e.fire("update",{changed:p({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),C(this))}function pt(t){var e=t.changed,r=t.current;if(e.selectedDataset&&"--"!==r.selectedDataset){var n=r.selectedDataset;this.set({chartData:n.data}),n.presets&&Object.keys(n.presets).forEach((function(t){dw.backend.currentChart.set(t,n.presets[t])}))}}function ht(t,e,r){var n=Object.create(t);return n.dataset=e[r],n}function vt(t,e,r){var n=Object.create(t);return n.group=e[r],n}function _t(t,e){var r,n,o,a=e.dataset.title;return{c:function(){r=m("option"),n=g(a),r.__value=o=e.dataset,r.value=r.__value,r.className="demo-dataset"},m:function(t,e){v(t,r,e),h(r,n)},p:function(t,e){t.datasetsArray&&a!==(a=e.dataset.title)&&D(n,a),t.datasetsArray&&o!==(o=e.dataset)&&(r.__value=o),r.value=r.__value},d:function(t){t&&_(r)}}}function yt(t,e){for(var r,n,o=e.group.datasets,a=[],s=0;s<o.length;s+=1)a[s]=_t(0,ht(e,o,s));return{c:function(){r=m("optgroup");for(var t=0;t<a.length;t+=1)a[t].c();w(r,"label",n=e.group.type)},m:function(t,e){v(t,r,e);for(var n=0;n<a.length;n+=1)a[n].m(r,null)},p:function(t,e){if(t.datasetsArray){o=e.group.datasets;for(var s=0;s<o.length;s+=1){var i=ht(e,o,s);a[s]?a[s].p(t,i):(a[s]=_t(0,i),a[s].c(),a[s].m(r,null))}for(;s<a.length;s+=1)a[s].d(1);a.length=o.length}t.datasetsArray&&n!==(n=e.group.type)&&w(r,"label",n)},d:function(t){t&&_(r),y(a,t)}}}function mt(t){var e=this;A(this,t),this._state=f({selectedDataset:"--"},t.data),this._recompute({datasets:1},this._state),this._intro=!0,this._handlers.update=[pt],this._fragment=function(t,e){for(var r,n,o,a,s,i,c,u,l,d,f=it("upload / quick help"),p=it("upload / try a dataset"),w=it("upload / sample dataset"),D=!1,S=e.datasetsArray,T=[],P=0;P<S.length;P+=1)T[P]=yt(t,vt(e,S,P));function M(){D=!0,t.set({selectedDataset:j(u)}),D=!1}return{c:function(){r=m("p"),n=g(f),o=g("\n\n"),a=m("div"),s=m("p"),i=g(p),c=g("\n    "),u=m("select"),l=m("option"),d=g(w);for(var h=0;h<T.length;h+=1)T[h].c();l.__value="--",l.value=l.__value,b(u,"change",M),"selectedDataset"in e||t.root._beforecreate.push(M),u.disabled=e.readonly,u.id="demo-datasets",u.className="svelte-16u58l0",a.className="demo-datasets"},m:function(t,f){v(t,r,f),h(r,n),v(t,o,f),v(t,a,f),h(a,s),h(s,i),h(a,c),h(a,u),h(u,l),h(l,d);for(var p=0;p<T.length;p+=1)T[p].m(u,null);O(u,e.selectedDataset)},p:function(e,r){if(e.datasetsArray){S=r.datasetsArray;for(var n=0;n<S.length;n+=1){var o=vt(r,S,n);T[n]?T[n].p(e,o):(T[n]=yt(t,o),T[n].c(),T[n].m(u,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=S.length}!D&&e.selectedDataset&&O(u,r.selectedDataset),e.readonly&&(u.disabled=r.readonly)},d:function(t){t&&(_(r),_(o),_(a)),y(T,t),x(u,"change",M)}}}(this,this._state),this.root._oncreate.push((function(){e.fire("update",{changed:p({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),C(this))}function gt(){}f(ft.prototype,R),f(mt.prototype,R),mt.prototype._recompute=function(t,e){var r;t.datasets&&this._differs(e.datasetsArray,e.datasetsArray=(r=e.datasets,Object.keys(r).map((function(t){return r[t]}))))&&(t.datasetsArray=!0)};var bt,xt,wt=(bt=function(t){var e,r,n,o=this,a=t.changed,s=t.current;return e=function(){if(!(a.sheets&&s.sheets.length>1))return function(t){var e=t();if(e&&e.then)return e.then(gt)}((function(){if(a.sheets&&1===s.sheets.length)return t=tt.put("/v3/charts/".concat(dw.backend.currentChart.get("id"),"/data"),{body:s.sheets[0].csv,headers:{"Content-Type":"text/csv"}}),e=function(){window.location.href="describe"},r?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t);var t,e,r}));setTimeout((function(){o.set({selected:s.sheets[0]})}),300)},r=function(){a.selected&&s.selected.csv&&o.set({chartData:s.selected.csv})},(n=e())&&n.then?n.then(r):r(n)},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return Promise.resolve(bt.apply(this,t))}catch(t){return Promise.reject(t)}});function Dt(t,e,r){var n=Object.create(t);return n.sheet=e[r],n}function Ot(t,e){var r,n=it("upload / xls / uploading data");return{c:function(){r=m("p")},m:function(t,e){v(t,r,e),r.innerHTML=n},p:d,d:function(t){t&&_(r)}}}function jt(t,e){for(var r,n,o,a,s,i=it("upload / select sheet"),c=!1,u=e.sheets,l=[],d=0;d<u.length;d+=1)l[d]=Tt(t,Dt(e,u,d));function f(){c=!0,t.set({selected:j(a)}),c=!1}return{c:function(){r=m("p"),n=g(i),o=g("\n    "),a=m("select");for(var c=0;c<l.length;c+=1)l[c].c();b(a,"change",f),"selected"in e||t.root._beforecreate.push(f),a.disabled=s=!e.sheets.length,a.className="svelte-16u58l0"},m:function(t,s){v(t,r,s),h(r,n),v(t,o,s),v(t,a,s);for(var i=0;i<l.length;i+=1)l[i].m(a,null);O(a,e.selected)},p:function(e,r){if(e.sheets){u=r.sheets;for(var n=0;n<u.length;n+=1){var o=Dt(r,u,n);l[n]?l[n].p(e,o):(l[n]=Tt(t,o),l[n].c(),l[n].m(a,null))}for(;n<l.length;n+=1)l[n].d(1);l.length=u.length}!c&&e.selected&&O(a,r.selected),e.sheets&&s!==(s=!r.sheets.length)&&(a.disabled=s)},d:function(t){t&&(_(r),_(o),_(a)),y(l,t),x(a,"change",f)}}}function St(t,e){var r,n=it("upload / parsing-xls");return{c:function(){(r=m("div")).className="alert alert-info"},m:function(t,e){v(t,r,e),r.innerHTML=n},p:d,d:function(t){t&&_(r)}}}function Tt(t,e){var r,n,o,a=e.sheet.name;return{c:function(){r=m("option"),n=g(a),r.__value=o=e.sheet,r.value=r.__value},m:function(t,e){v(t,r,e),h(r,n)},p:function(t,e){t.sheets&&a!==(a=e.sheet.name)&&D(n,a),t.sheets&&o!==(o=e.sheet)&&(r.__value=o),r.value=r.__value},d:function(t){t&&_(r)}}}function Pt(t){var e=this;A(this,t),this._state=f({selected:!1,sheets:[]},t.data),this._intro=!0,this._handlers.update=[wt],this._fragment=function(t,e){var r;function n(t){return t.sheets.length?t.sheets.length>1?jt:Ot:St}var o=n(e),a=o(t,e);return{c:function(){r=m("div"),a.c()},m:function(t,e){v(t,r,e),a.m(r,null)},p:function(e,s){o===(o=n(s))&&a?a.p(e,s):(a.d(1),(a=o(t,s)).c(),a.m(r,null))},d:function(t){t&&_(r),a.d()}}}(this,this._state),this.root._oncreate.push((function(){e.fire("update",{changed:p({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),C(this))}function Mt(e,r){var n=new FileReader;n.onload=function(){try{for(var o=new Uint8Array(n.result),a="",s=0,i=0;i<o.length;++i)o[i]>122&&s++,a+=String.fromCharCode(o[i]);var c=t.detect(a);c.confidence<=.95&&s<10&&(c.encoding="utf-8"),(n=new FileReader).onload=function(){return r(null,n.result)},n.readAsText(e,c.encoding)}catch(t){console.warn(t),r(null,n.result)}},n.readAsArrayBuffer(e)}function Ct(t,e,r){return r?e?e(t):t:(t&&t.then||(t=Promise.resolve(t)),e?t.then(e):t)}function Nt(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{return Promise.resolve(t.apply(this,e))}catch(t){return Promise.reject(t)}}}f(Pt.prototype,R);var At=[{id:"copy",title:it("upload / copy-paste"),longTitle:it("upload / copy-paste / long"),icon:"fa fa-clipboard",mainPanel:ft,sidebar:mt,action:function(){}},{id:"upload",title:it("upload / upload-csv"),longTitle:it("upload / upload-csv / long"),icon:"fa-file-excel-o fa",mainPanel:ft,sidebar:mt,isFileUpload:!0,onFileUpload:function(t){try{var e=t.target.files[0];return"text/"===e.type.substr(0,5)||".csv"===e.name.substr(e.name.length-4)?(xt.set({Sidebar:mt}),Mt(e,Nt((function(t,e){return t?console.error("could not read file",t):Ct(tt.put("/v3/charts/".concat(dw.backend.currentChart.get("id"),"/data"),{body:e,headers:{"Content-Type":"text/csv"}}),(function(){window.location.href="describe"}))})))):"application/"===e.type.substr(0,12)?(xt.set({Sidebar:Pt,sheets:[]}),function(t,e){var r="undefined"!=typeof FileReader&&(FileReader.prototype||{}).readAsBinaryString,n=new FileReader;n.onload=function(){try{var t=r?n.result:new Uint8Array(n.result),o=XLSX.read(t,{type:r?"binary":"array"});e(null,o.SheetNames.map((function(t){return{name:t,sheet:o.Sheets[t],csv:XLSX.utils.sheet_to_csv(o.Sheets[t])}})))}catch(t){console.error(t),e(null,n.result)}},n.readAsBinaryString(t)}(e,(function(t,e){if(t)return xt.set({error:t});xt.set({sheets:e})}))):(console.error(e.type),console.error(e),xt.set({error:it("upload / csv-required")})),Ct()}catch(t){return Promise.reject(t)}},action:function(){}}];var kt={addButton:function(t){At.push(t),this.set({buttons:At});var e=this.get().defaultMethod;t.id===e&&this.btnAction(t)},btnAction:function(t){if(this.set({active:t}),"copy"===t.id){var e=this.store.get().dw_chart;e.get("externalData")&&(e.set("externalData",""),setTimeout((function(){dw.backend.currentChart.save()}),1e3))}var r=t.id;"upload"===t.id&&(r="copy",setTimeout((function(){}),1e3)),this.store.get().dw_chart.set("metadata.data.upload-method",r),t.action&&t.action(),t.mainPanel&&this.set({MainPanel:t.mainPanel}),t.sidebar&&this.set({Sidebar:t.sidebar})},btnUpload:function(t,e){t.onFileUpload&&t.onFileUpload(e)},dragStart:function(t){"copy"===this.get().active.id&&(t.preventDefault(),this.set({dragover:!0}))},resetDrag:function(){this.set({dragover:!1})},onFileDrop:function(t){if("copy"===this.get().active.id){this.resetDrag(),t.preventDefault();var e=[];if(t.dataTransfer.items){for(var r=0;r<t.dataTransfer.items.length;r++)"file"===t.dataTransfer.items[r].kind&&e.push(t.dataTransfer.items[r].getAsFile());t.dataTransfer.items.clear()}else{for(var n=0;n<t.dataTransfer.files.length;n++)e.push(t.dataTransfer.files[n]);t.dataTransfer.items.clear()}for(var o=0;o<e.length;o++)if("text/"===e[o].type.substr(0,5))return Mt(e[o],Nt((function(t,e){return t?console.error("could not read file",t):Ct(tt.put("/v3/charts/".concat(dw.backend.currentChart.get("id"),"/data"),{body:e,headers:{"Content-Type":"text/csv"}}),(function(){window.location.href="describe"}))})))}}};function Et(){var t=this;xt=this;var e=this.store.get().dw_chart.get("metadata.data.upload-method","copy");this.set({defaultMethod:e}),At.forEach((function(r){r.id===e&&t.set({active:r})}))}function Rt(t){var e=this._svelte,r=e.component,n=e.ctx;r.btnAction(n.btn)}function Ut(t){var e=this._svelte,r=e.component,n=e.ctx;r.btnUpload(n.btn,t)}function Ft(t,e,r){var n=Object.create(t);return n.btn=e[r],n}function It(t,e){var r,n=it("upload / drag-csv-here");return{c:function(){(r=m("div")).className="draginfo svelte-oe6wy4"},m:function(t,e){v(t,r,e),r.innerHTML=n},d:function(t){t&&_(r)}}}function Lt(t,e){var r;return{c:function(){(r=m("input"))._svelte={component:t,ctx:e},b(r,"change",Ut),r.accept=".csv, .tsv, .txt, .xlsx, .xls, .ods, .dbf",r.className="file-upload svelte-oe6wy4",w(r,"type","file")},m:function(t,e){v(t,r,e)},p:function(t,n){e=n,r._svelte.ctx=e},d:function(t){t&&_(r),x(r,"change",Ut)}}}function Bt(t,e){var r,n,o,a,s,i,c,u,l,d=e.btn.title,f=e.btn.isFileUpload&&Lt(t,e);return{c:function(){r=m("li"),n=m("label"),f&&f.c(),o=g("\n                            "),a=m("i"),i=g("\n                            "),c=m("span"),u=g(d),a.className=s=e.btn.icon+" svelte-oe6wy4",c.className="svelte-oe6wy4",n.className="svelte-oe6wy4",r._svelte={component:t,ctx:e},b(r,"click",Rt),r.className=l="action "+(e.active==e.btn?"active":"")+" svelte-oe6wy4"},m:function(t,e){v(t,r,e),h(r,n),f&&f.m(n,null),h(n,o),h(n,a),h(n,i),h(n,c),h(c,u)},p:function(i,c){(e=c).btn.isFileUpload?f?f.p(i,e):((f=Lt(t,e)).c(),f.m(n,o)):f&&(f.d(1),f=null),i.buttons&&s!==(s=e.btn.icon+" svelte-oe6wy4")&&(a.className=s),i.buttons&&d!==(d=e.btn.title)&&D(u,d),r._svelte.ctx=e,(i.active||i.buttons)&&l!==(l="action "+(e.active==e.btn?"active":"")+" svelte-oe6wy4")&&(r.className=l)},d:function(t){t&&_(r),f&&f.d(),x(r,"click",Rt)}}}function Ht(t,e){var r,n,o,a;function s(e){t.set({error:!1})}return{c:function(){r=m("div"),(n=m("div")).textContent="✕",o=g("\n                    "),a=m("noscript"),b(n,"click",s),n.className="action close",r.className="alert alert-error"},m:function(t,s){v(t,r,s),h(r,n),h(r,o),h(r,a),a.insertAdjacentHTML("afterend",e.error)},p:function(t,e){t.error&&(!function(t){for(;t.nextSibling;)t.parentNode.removeChild(t.nextSibling)}(a),a.insertAdjacentHTML("afterend",e.error))},d:function(t){t&&_(r),x(n,"click",s)}}}function qt(t){var e=this;A(this,t),this._state=f({dragover:!1,MainPanel:ft,Sidebar:mt,active:At[0],buttons:At,sheets:[],chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0},t.data),this._intro=!0,this._fragment=function(t,e){for(var r,n,o,a,s,i,c,u,l,d,f,p,w,O,j,S,T,P,M,C,N,A,k=it("upload / title"),E=e.active.longTitle||e.active.title,R={},U={},F=it("Proceed"),I=e.dragover&&It(),L=e.buttons,B=[],H=0;H<L.length;H+=1)B[H]=Bt(t,Ft(e,L,H));var q=e.error&&Ht(t,e),X=e.Sidebar;function $(e){var r={};return void 0!==e.chartData&&(r.chartData=e.chartData,R.chartData=!0),void 0!==e.readonly&&(r.readonly=e.readonly,R.readonly=!0),void 0!==e.sheets&&(r.sheets=e.sheets,R.sheets=!0),void 0!==e.datasets&&(r.datasets=e.datasets,R.datasets=!0),{root:t.root,store:t.store,data:r,_bind:function(e,r){var n={};!R.chartData&&e.chartData&&(n.chartData=r.chartData),!R.readonly&&e.readonly&&(n.readonly=r.readonly),!R.sheets&&e.sheets&&(n.sheets=r.sheets),!R.datasets&&e.datasets&&(n.datasets=r.datasets),t._set(n),R={}}}}if(X){var J=new X($(e));t.root._beforecreate.push((function(){J._bind({chartData:1,readonly:1,sheets:1,datasets:1},J.get())}))}var G=e.MainPanel;function z(e){var r={};return void 0!==e.chartData&&(r.chartData=e.chartData,U.chartData=!0),void 0!==e.readonly&&(r.readonly=e.readonly,U.readonly=!0),{root:t.root,store:t.store,data:r,_bind:function(e,r){var n={};!U.chartData&&e.chartData&&(n.chartData=r.chartData),!U.readonly&&e.readonly&&(n.readonly=r.readonly),t._set(n),U={}}}}if(G){var Z=new G(z(e));t.root._beforecreate.push((function(){Z._bind({chartData:1,readonly:1},Z.get())}))}function K(e){t.onFileDrop(e)}function Q(e){t.dragStart(e)}function V(e){t.dragStart(e)}function W(e){t.resetDrag()}function Y(e){t.resetDrag()}return{c:function(){r=m("div"),I&&I.c(),n=g("\n\n    \n    "),o=m("div"),a=m("div"),s=m("div"),i=m("h3"),c=g("\n\n                "),u=m("ul");for(var t=0;t<B.length;t+=1)B[t].c();l=g("\n\n                "),q&&q.c(),d=g("\n\n                "),f=m("h4"),p=g(E),w=g("\n\n                "),J&&J._fragment.c(),O=g("\n        "),j=m("div"),Z&&Z._fragment.c(),S=g("\n\n            "),T=m("div"),P=m("a"),M=g(F),C=g(" "),N=m("i"),u.className="import-methods svelte-oe6wy4",f.className="svelte-oe6wy4",s.className="sidebar",a.className="span5",N.className="icon-chevron-right icon-white",P.href="describe",P.className="submit btn btn-primary svelte-oe6wy4",P.id="describe-proceed",T.className="buttons pull-right",j.className="span7",o.className="row",o.style.cssText=A=e.dragover?"opacity: 0.5;filter:blur(6px);background:white;pointer-events:none":"",b(r,"drop",K),b(r,"dragover",Q),b(r,"dragenter",V),b(r,"dragend",W),b(r,"dragleave",Y),r.className="chart-editor dw-create-upload upload-data"},m:function(t,e){v(t,r,e),I&&I.m(r,null),h(r,n),h(r,o),h(o,a),h(a,s),h(s,i),i.innerHTML=k,h(s,c),h(s,u);for(var _=0;_<B.length;_+=1)B[_].m(u,null);h(s,l),q&&q.m(s,null),h(s,d),h(s,f),h(f,p),h(s,w),J&&J._mount(s,null),h(o,O),h(o,j),Z&&Z._mount(j,null),h(j,S),h(j,T),h(T,P),h(P,M),h(P,C),h(P,N)},p:function(a,i){if((e=i).dragover?I||((I=It()).c(),I.m(r,n)):I&&(I.d(1),I=null),a.active||a.buttons){L=e.buttons;for(var c=0;c<L.length;c+=1){var l=Ft(e,L,c);B[c]?B[c].p(a,l):(B[c]=Bt(t,l),B[c].c(),B[c].m(u,null))}for(;c<B.length;c+=1)B[c].d(1);B.length=L.length}e.error?q?q.p(a,e):((q=Ht(t,e)).c(),q.m(s,d)):q&&(q.d(1),q=null),a.active&&E!==(E=e.active.longTitle||e.active.title)&&D(p,E);var f={};!R.chartData&&a.chartData&&(f.chartData=e.chartData,R.chartData=void 0!==e.chartData),!R.readonly&&a.readonly&&(f.readonly=e.readonly,R.readonly=void 0!==e.readonly),!R.sheets&&a.sheets&&(f.sheets=e.sheets,R.sheets=void 0!==e.sheets),!R.datasets&&a.datasets&&(f.datasets=e.datasets,R.datasets=void 0!==e.datasets),X!==(X=e.Sidebar)?(J&&J.destroy(),X?(J=new X($(e)),t.root._beforecreate.push((function(){var t={};void 0===e.chartData&&(t.chartData=1),void 0===e.readonly&&(t.readonly=1),void 0===e.sheets&&(t.sheets=1),void 0===e.datasets&&(t.datasets=1),J._bind(t,J.get())})),J._fragment.c(),J._mount(s,null)):J=null):X&&(J._set(f),R={});var h={};!U.chartData&&a.chartData&&(h.chartData=e.chartData,U.chartData=void 0!==e.chartData),!U.readonly&&a.readonly&&(h.readonly=e.readonly,U.readonly=void 0!==e.readonly),G!==(G=e.MainPanel)?(Z&&Z.destroy(),G?(Z=new G(z(e)),t.root._beforecreate.push((function(){var t={};void 0===e.chartData&&(t.chartData=1),void 0===e.readonly&&(t.readonly=1),Z._bind(t,Z.get())})),Z._fragment.c(),Z._mount(j,S)):Z=null):G&&(Z._set(h),U={}),a.dragover&&A!==(A=e.dragover?"opacity: 0.5;filter:blur(6px);background:white;pointer-events:none":"")&&(o.style.cssText=A)},d:function(t){t&&_(r),I&&I.d(),y(B,t),q&&q.d(),J&&J.destroy(),Z&&Z.destroy(),x(r,"drop",K),x(r,"dragover",Q),x(r,"dragenter",V),x(r,"dragend",W),x(r,"dragleave",Y)}}}(this,this._state),this.root._oncreate.push((function(){Et.call(e),e.fire("update",{changed:p({},e._state),current:e._state})})),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),C(this))}function Xt(t,e){this._handlers={},this._dependents=[],this._computed=S(),this._sortedComputedProperties=[],this._state=f({},t),this._differs=e&&e.immutable?P:T}f(qt.prototype,R),f(qt.prototype,kt),f(Xt.prototype,{_add:function(t,e){this._dependents.push({component:t,props:e})},_init:function(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r];e["$"+n]=this._state[n]}return e},_remove:function(t){for(var e=this._dependents.length;e--;)if(this._dependents[e].component===t)return void this._dependents.splice(e,1)},_set:function(t,e){var r=this,n=this._state;this._state=f(f({},n),t);for(var o=0;o<this._sortedComputedProperties.length;o+=1)this._sortedComputedProperties[o].update(this._state,e);this.fire("state",{changed:e,previous:n,current:this._state}),this._dependents.filter((function(t){for(var n={},o=!1,a=0;a<t.props.length;a+=1){var s=t.props[a];s in e&&(n["$"+s]=r._state[s],o=!0)}if(o)return t.component._stage(n),!0})).forEach((function(t){t.component.set({})})),this.fire("update",{changed:e,previous:n,current:this._state})},_sortComputedProperties:function(){var t,e=this._computed,r=this._sortedComputedProperties=[],n=S();function o(a){var s=e[a];s&&(s.deps.forEach((function(e){if(e===t)throw new Error("Cyclical dependency detected between ".concat(e," <-> ").concat(a));o(e)})),n[a]||(n[a]=!0,r.push(s)))}for(var a in this._computed)o(t=a)},compute:function(t,e,r){var n,o=this,a={deps:e,update:function(a,s,i){var c=e.map((function(t){return t in s&&(i=!0),a[t]}));if(i){var u=r.apply(null,c);o._differs(u,n)&&(n=u,s[t]=!0,a[t]=n)}}};this._computed[t]=a,this._sortComputedProperties();var s=f({},this._state),i={};a.update(s,i,!0),this._set(s,i)},fire:M,get:N,on:k,set:function(t){var e=this._state,r=this._changed={},n=!1;for(var o in t){if(this._computed[o])throw new Error("'".concat(o,"' is a read-only computed property"));this._differs(t[o],e[o])&&(r[o]=n=!0)}n&&this._set(t,r)}});return{App:qt,data:{chart:{id:""},readonly:!1,chartData:"",transpose:!1,firstRowIsHeader:!0,skipRows:0},store:new Xt({})}}));
