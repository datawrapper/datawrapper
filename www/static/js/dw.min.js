//      Datawrapper
(function(){var a=this,b;typeof exports!="undefined"?b=exports:b=a.Datawrapper={Parsers:{}},b.VERSION="0.7.1";var c=b.Core=function(){};_.extend(c,{initialize:function(){this.initLanguageLinks()},initLanguageLinks:function(){$("a[href|=#lang]").click(function(a){a.preventDefault(),$.ajax({url:"/api/account/lang",type:"PUT",data:JSON.stringify({lang:$(a.target).attr("href").substr(6)}),processData:!1,success:function(a){location.reload()}})})}})}).call(this),function(){var a=Datawrapper.Dataset=function(a){_.extend(a,{type:"delimited"}),this.__options=a};_.extend(a.prototype,{_initialize:function(){var a=this,b=a.__options},_fetchDelimited:function(a){var b=this,c=b.__options;c.url!==undefined&&(b.__lastUrl==c.url?loaded(b.__rawData):$.ajax({url:c.url,method:"GET",success:function(c){b._delimtedLoaded(c),_.isFunction(a.success)&&a.success()}}))},_delimtedLoaded:function(a,b){var c=this,d=c.__options;c.__rawData=a;var e=new Datawrapper.Parsers.Delimited(d),f=e.parse(a);c._processData(f),c.__data=f,c.__loaded=!0},_processData:function(a){var c=this,d=new b;c.__seriesByName={},_.each(a.series,function(a){c.__seriesByName[a.name]=a,a._min=function(){return a.min},a._max=function(){return a.max},_.each(a.data,function(a){d.learn(a)})}),_.each(a.series,function(a){a.min=Number.MAX_VALUE,a.max=-Number.MAX_VALUE,a.total=0,_.each(a.data,function(b,c){a.data[c]=d.parse(b),isNaN(a.data[c])||(a.min=Math.min(a.min,a.data[c]),a.max=Math.max(a.max,a.data[c]),a.total+=a.data[c])})})},fetch:function(a){var b=this,c=b.__options;c.type=="delimited"&&b._fetchDelimited(a)},fetchRaw:function(){var a=this,b=a.__options;b.type=="delimited"&&a._delimtedLoaded(b.rawData)},series:function(a){var b=this;if(_.isString(a)){if(b.__seriesByName[a]!==undefined)return b.__seriesByName[a];throw'No series found with that name: "'+a+'"'}if(a!==undefined){if(b.__data.series[a]!==undefined)return b.__data.series[a];throw"No series found with that index: "+a}return this.__data.series},hasRowNames:function(){return this.__data.rowNames!==undefined},numRows:function(){return this.__data.series[0].data.length},eachRow:function(a){var b;for(b=0;b<this.numRows();b++)a(b)},eachSeries:function(a){_.each(this.series(),a)},rowNames:function(){return this.__data.rowNames},rowName:function(a){return this.__data.rowNames[a]},rowNameLabel:function(){return this.__data.rowNameLabel!==undefined?this.__data.rowNameLabel:""},filterRows:function(a){this.eachSeries(function(b){var c=[];b.total=0,b.min=Number.MAX_VALUE,b.max=Number.MAX_VALUE*-1,_.each(a,function(a){c.push(b.data[a]),b.total+=b.data[a],b.min=Math.min(b.min,b.data[a]),b.max=Math.max(b.max,b.data[a])}),b.data=c})}});var b=function(){this.__numbers=[],this.__knownFormats={"-.":/^[\-\.]?[0-9]+(\.[0-9]+)?$/,"-,":/^[\-,]?[0-9]+(,[0-9]+)?$/,",.":/^[0-9]{1,3}(,[0-9]{3})(\.[0-9]+)?$/,".,":/^[0-9]{1,3}(\.[0-9]{3})(,[0-9]+)?$/," .":/^[0-9]{1,3}( [0-9]{3})(\.[0-9]+)?$/," ,":/^[0-9]{1,3}( [0-9]{3})(,[0-9]+)?$/}};_.extend(b.prototype,{learn:function(a){this.__numbers.push(a)},_getFormat:function(){var a=this,b={},c=["",0];_.each(a.__numbers,function(d){_.each(a.__knownFormats,function(a,e){b[e]===undefined&&(b[e]=0),a.test(d)&&(b[e]+=1,b[e]>c[1]&&(c[0]=e,c[1]=b[e]))})});return c[0]},parse:function(a){var b=this,c=a,d=this.__format;d===undefined&&(d=this.__format=this._getFormat());if(d[0]==","||d[0]=="."||d[0]==" ")c=c.replace(d[0],"");d[1]!="."&&(c=c.replace(d[1],".")),c=Number(c);return isNaN(c)?a:c}})}.call(this),function(){var a=Datawrapper.Chart=function(a){this.__attributes=a};_.extend(a.prototype,{get:function(a,b){var c=a.split("."),d=this.__attributes;_.each(c,function(a){if(d===undefined)return b;d=d[a]});return _.isUndefined(d)||_.isNull(d)?b:d},dataset:function(a,b){var c=this,d,e={delimiter:"auto",url:"data",transpose:b?!1:this.get("metadata.data.transpose",!1),firstRowIsHeader:this.get("metadata.data.horizontal-header",!0),firstColumnIsHeader:this.get("metadata.data.vertical-header",!0)};c.__dataset=d=new Datawrapper.Dataset(e),d.fetch({success:function(){a(d);if(c.__datasetLoadedCallbacks)for(var b=0;b<c.__datasetLoadedCallbacks.length;b++)c.__datasetLoadedCallbacks[b](c)}});return d},rawData:function(a){var b=this,c={rawData:a,delimiter:"auto",transpose:this.get("metadata.data.transpose",!1),firstRowIsHeader:this.get("metadata.data.horizontal-header",!0),firstColumnIsHeader:this.get("metadata.data.vertical-header",!0)};b.__dataset=ds=new Datawrapper.Dataset(c),ds.fetchRaw()},datasetLoaded:function(a){var b=this;b.__dataset.__loaded?a(b):(b.__datasetLoadedCallbacks||(b.__datasetLoadedCallbacks=[]),b.__datasetLoadedCallbacks.push(a))},dataSeries:function(a,b){var c=this;ds=[],c.__dataset.eachSeries(function(a,b){ds.push(a)}),a&&(ds=ds.sort(function(a,b){return b.data[0]>a.data[0]?1:-1})),b&&ds.reverse();return ds},seriesByName:function(a){return this.__dataset.series(a)},numRows:function(){return this.__dataset.numRows()},hasColHeader:function(a){var b=this.get("metadata.data.transpose");return(a?!b:b)?this.get("metadata.data.vertical-header"):this.get("metadata.data.horizontal-header")},hasRowHeader:function(){return this.hasColHeader(!0)},rowHeader:function(){var a=this.__dataset;return this.hasRowHeader()?{data:a.rowNames()}:!1},rowLabels:function(){return this.hasRowHeader()?this.rowHeader().data:null},rowLabel:function(a){return this.hasRowHeader()?this.rowHeader().data[a]:a},hasHighlight:function(){var a=this.get("metadata.visualize.highlighted-series");return _.isArray(a)&&a.length>0},isHighlighted:function(a){if(a===undefined)return!1;var b=this.get("metadata.visualize.highlighted-series");return!_.isArray(b)||b.length===0||_.indexOf(b,a.name)>=0},setLocale:function(a,b){this.locale=a,this.metric_prefix=b},formatValue:function(a,b,c){var d=this,e=d.get("metadata.describe.number-format"),f=Number(d.get("metadata.describe.number-divisor")),g=d.get("metadata.describe.number-append","").replace(" ","&nbsp;"),h=d.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");if(e!="-"){var i=Globalize.culture(d.locale);a=Number(a)/Math.pow(10,f);if(c||a==Math.round(a))e=e.substr(0,1)+"0";a=Globalize.format(a,e)}return b?h+a+g:a},filterRow:function(a){this.__dataset.filterRows([a])},filterRows:function(a){this.__dataset.filterRows(a)}})}.call(this),function(){Datawrapper.Themes={},Datawrapper.Themes.Base=_.extend({},{colors:{palette:["#6E7DA1","#64A4C4","#53CCDD","#4EF4E8"],positive:"#85B4D4",negative:"#E31A1C",background:"#ffffff",text:"#000000"},locale:"de_DE",lineChart:{strokeWidth:{highlight:3,normal:1},hoverDotRadius:3,maxLabelWidth:80},barChart:{},horizontalGrid:{stroke:"#e9e9e9"},yTicks:!1,yAxis:{"stroke-width":1},padding:{left:0,right:20,bottom:30,top:10},leftPadding:20,rightPadding:20,lineLabelWidth:20,yLabelOffset:8,bottomPadding:40,xLabelOffset:20,hover:!0,tooltip:!0,hpadding:0,vpadding:10})}.call(this),function(){Datawrapper.Parsers.Delimited=function(a){a=a||{},this.delimiter=a.delimiter||",",this.quoteChar=a.quoteChar||'"',this.skipRows=a.skipRows||0,this.emptyValue=a.emptyValue||null,this.transpose=a.transpose||!1,this.firstRowIsHeader=a.firstRowIsHeader!==undefined?a.firstRowIsHeader:!0,this.firstColumnIsHeader=a.firstRowIsHeader!==undefined?a.firstColumnIsHeader:!0,this.getDelimiterPatterns=function(a,b){return new RegExp("(\\"+a+"|\\r?\\n|\\r|^)"+"(?:"+b+"([^"+b+"]*(?:"+b+'"[^'+b+"]*)*)"+b+"|"+"([^"+b+"\\"+a+"\\r\\n]*))","gi")},this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar)},_.extend(Datawrapper.Parsers.Delimited.prototype,Datawrapper.Parsers.prototype,{parse:function(a){this.__rawData=a,this.delimiter=="auto"&&(this.delimiter=this.guessDelimiter(a,this.skipRows),this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar));var b=[],c=this.delimiter!="|"?"|":"#",d;a=c+a.replace(/\s+$/g,"")+c;var e=function(a,b,d){d=d||",";var e=[[]],f=null,g;while(f=a.exec(b)){var h=f[1];h.length&&h!=d&&e.push([]),f[2]?g=f[2].replace(new RegExp('""',"g"),'"'):g=f[3],e[e.length-1].push(g)}e[0][0].substr(0,1)==c&&(e[0][0]=e[0][0].substr(1));var i=e.length-1,j=e[i].length-1,k=e[i][j].length-1;e[i][j].substr(k)==c&&(e[i][j]=e[i][j].substr(0,k));return e},f=function(a){var b=a,c=b.length?b.length:0,d=b[0]instanceof Array?b[0].length:0;if(d===0||c===0)return[];var e,f,g=[];for(e=0;e<d;e++){g[e]=[];for(f=0;f<c;f++)g[e][f]=b[f][e]}return g};parseDataArray=function(a,b,c,d,e){var f=[],g={},h=a.length,i=a[0].length,j=b,k=[];d&&(k=a[j],j++);for(var l=0;l<i;l++){var m=_.isString(k[l])?k[l].replace(/^\s+|\s+$/g,""):"",n=m!==""?"":1;m=m!==""?m:"X.";while(g[m+n]!==undefined)n=n===""?1:n+1;f.push({name:m+n,data:[]}),g[m+n]=!0}for(;j<h;j++)_.each(f,function(b,d){b.data.push(a[j][d]!==""?a[j][d]:c)});var o;e&&(o=f[0],f=f.slice(1));return{series:f,rowNames:o?o.data:undefined,rowNameLabels:o?o.name:undefined}},d=e(this.__delimiterPatterns,a,this.delimiter);if(this.transpose){d=f(d);var g=this.firstRowIsHeader;this.firstRowIsHeader=this.firstColumnIsHeader,this.firstColumnIsHeader=g}return parseDataArray(d,this.skipRows,this.emptyValue,this.firstRowIsHeader,this.firstColumnIsHeader)},guessDelimiter:function(a){var b=0,c=-1,d=this,e=["\t",",",";","|"];_.each(e,function(e,f){var g=d.getDelimiterPatterns(e,d.quoteChar),h=a.match(g).length;h>b&&(b=h,c=f)});return e[c]}})}(this,_),function(){Datawrapper.Visualizations={};var a=function(){};_.extend(a.prototype,{render:function(a){$(a).html("implement me!")},setTheme:function(a){this.theme=a},load:function(a,b){var c=this;this.chart=a,a.dataset(function(a){c.dataset=a,b.call(c,c)})},getMaxChartHeight:function(a){var b=0;$("body > *").each(function(a,c){var d=c.tagName.toLowerCase();d!="script"&&c.id!="chart"&&!$(c).hasClass("tooltip")&&(b+=$(c).outerHeight(!0))});var c=$("#chart").css("margin-top"),d=$(window).height()-b-Number(c.substr(0,c.length-2));$.browser.msie&&(d-=10);return d},get:function(a,b){return this.chart.get("metadata.visualize."+a,b)},warn:function(a){var b=$("<div>"+a+"</div>");b.css({"background-color":"#FCF8E3",border:"1px solid #FBEED5","border-radius":"4px 4px 4px 4px",color:"#a07833","margin-bottom":"18px",padding:"8px 35px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)",left:"10%",right:"10%","text-align":"center",position:"absolute"}),$("body").prepend(b),b.hide(),b.fadeIn()}}),Datawrapper.Visualizations.Base=a.prototype}.call(this)